var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){var f,y,t,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},g=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return g.next=verb(0),g.throw=verb(1),g.return=verb(2),"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!((t=(t=_.trys).length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}"function"==typeof SuppressedError&&SuppressedError;var UniversalPolyfills=function(){function UniversalPolyfills(){}return UniversalPolyfills.init=function(){this.initialized||(this.polyfillPromise(),this.polyfillFetch(),this.polyfillIntersectionObserver(),this.polyfillPerformanceObserver(),this.polyfillRequestIdleCallback(),this.polyfillCustomEvent(),this.polyfillAssign(),this.polyfillArrayIncludes(),this.polyfillStringIncludes(),this.polyfillConsole(),this.initialized=!0)},UniversalPolyfills.polyfillPromise=function(){var _a,_b;"undefined"==typeof Promise&&(window.Promise=(_b=function(){function PromisePolyfill(executor){this.state="pending",this.handlers=[],this[_a]="Promise";try{executor(this.resolve.bind(this),this.reject.bind(this))}catch(error){this.reject(error)}}return PromisePolyfill.prototype.resolve=function(value){var _this=this;"pending"===this.state&&(this.state="fulfilled",this.value=value,this.handlers.forEach(function(handler){return _this.handle(handler)}),this.handlers=[])},PromisePolyfill.prototype.reject=function(error){var _this=this;"pending"===this.state&&(this.state="rejected",this.value=error,this.handlers.forEach(function(handler){return _this.handle(handler)}),this.handlers=[])},PromisePolyfill.prototype.handle=function(handler){if("pending"===this.state)this.handlers.push(handler);else if("fulfilled"===this.state&&handler.onFulfilled)try{var result=handler.onFulfilled(this.value);handler.resolve(result)}catch(error){handler.reject(error)}else if("rejected"===this.state&&handler.onRejected)try{result=handler.onRejected(this.value),handler.resolve(result)}catch(error){handler.reject(error)}else"fulfilled"===this.state?handler.resolve(this.value):handler.reject(this.value)},PromisePolyfill.prototype.then=function(onFulfilled,onRejected){var _this=this;return new _b(function(resolve,reject){_this.handle({onFulfilled:onFulfilled,onRejected:onRejected,resolve:resolve,reject:reject})})},PromisePolyfill.prototype.catch=function(onRejected){return this.then(void 0,onRejected)},PromisePolyfill.prototype.finally=function(onFinally){return this.then(function(value){return onFinally&&onFinally(),value},function(reason){throw onFinally&&onFinally(),reason})},PromisePolyfill.resolve=function(value){return new _b(function(resolve){return resolve(value)})},PromisePolyfill.reject=function(error){return new _b(function(_,reject){return reject(error)})},PromisePolyfill.all=function(promises){return new _b(function(resolve,reject){if(0!==promises.length){var resolvedCount=0,results=new Array(promises.length);promises.forEach(function(promise,index){promise.then(function(value){results[index]=value,++resolvedCount===promises.length&&resolve(results)},reject)})}else resolve([])})},PromisePolyfill}(),_a=Symbol.toStringTag,_b))},UniversalPolyfills.polyfillFetch=function(){"undefined"==typeof fetch&&(window.fetch=function(url,options){return void 0===options&&(options={}),new Promise(function(resolve,reject){var xhr=new XMLHttpRequest,method=options.method||"GET";xhr.open(method,url),options.headers&&Object.keys(options.headers).forEach(function(key){xhr.setRequestHeader(key,options.headers[key])}),xhr.onload=function(){var response={ok:xhr.status>=200&&xhr.status<300,status:xhr.status,statusText:xhr.statusText,headers:new Map,json:function(){return Promise.resolve(JSON.parse(xhr.responseText))},text:function(){return Promise.resolve(xhr.responseText)}};resolve(response)},xhr.onerror=function(){return reject(new Error("Network Error"))},xhr.send(options.body||null)})})},UniversalPolyfills.polyfillIntersectionObserver=function(){"undefined"==typeof IntersectionObserver&&(window.IntersectionObserver=function(){function IntersectionObserverPolyfill(callback){this.elements=new Set,this.callback=callback}return IntersectionObserverPolyfill.prototype.observe=function(element){var _this=this;this.elements.add(element),setTimeout(function(){_this.callback([{target:element,isIntersecting:!0,intersectionRatio:1}])},0)},IntersectionObserverPolyfill.prototype.unobserve=function(element){this.elements.delete(element)},IntersectionObserverPolyfill.prototype.disconnect=function(){this.elements.clear()},IntersectionObserverPolyfill}())},UniversalPolyfills.polyfillPerformanceObserver=function(){"undefined"==typeof PerformanceObserver&&(window.PerformanceObserver=function(){function PerformanceObserverPolyfill(callback){this.callback=callback}return PerformanceObserverPolyfill.prototype.observe=function(){var _this=this;setTimeout(function(){_this.callback({getEntries:function(){return[]}})},0)},PerformanceObserverPolyfill.prototype.disconnect=function(){},PerformanceObserverPolyfill}())},UniversalPolyfills.polyfillRequestIdleCallback=function(){"undefined"==typeof window||window.requestIdleCallback||(window.requestIdleCallback=function(callback,options){var start=Date.now(),timeout=(null==options?void 0:options.timeout)||0;return setTimeout(function(){var timeRemaining=Math.max(0,50-(Date.now()-start)),deadline={didTimeout:timeout>0&&Date.now()-start>=timeout,timeRemaining:function(){return timeRemaining}};callback(deadline)},1)},window.cancelIdleCallback=function(id){clearTimeout(id)})},UniversalPolyfills.polyfillCustomEvent=function(){"undefined"==typeof CustomEvent&&(window.CustomEvent=function(event,params){void 0===params&&(params={});var evt=document.createEvent("CustomEvent");return evt.initCustomEvent(event,params.bubbles||!1,params.cancelable||!1,params.detail),evt})},UniversalPolyfills.polyfillAssign=function(){Object.assign||(Object.assign=function(target){for(var sources=[],_i=1;_i<arguments.length;_i++)sources[_i-1]=arguments[_i];if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var to=Object(target),index=0;index<sources.length;index++){var nextSource=sources[index];if(null!=nextSource)for(var nextKey in nextSource)Object.prototype.hasOwnProperty.call(nextSource,nextKey)&&(to[nextKey]=nextSource[nextKey])}return to})},UniversalPolyfills.polyfillArrayIncludes=function(){Array.prototype.includes||(Array.prototype.includes=function(searchElement,fromIndex){var n=parseInt(String(fromIndex||0))||0;if(n>=this.length)return!1;for(var i=n>=0?n:Math.max(0,this.length+n);i<this.length;i++)if(this[i]===searchElement)return!0;return!1})},UniversalPolyfills.polyfillStringIncludes=function(){String.prototype.includes||(String.prototype.includes=function(search,start){return"number"!=typeof start&&(start=0),!(start+search.length>this.length)&&-1!==this.indexOf(search,start)})},UniversalPolyfills.polyfillConsole=function(){"undefined"==typeof console&&(window.console={log:function(){},warn:function(){},error:function(){},info:function(){},debug:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){}})},UniversalPolyfills.isModernBrowser=function(){return!("undefined"==typeof Promise||"undefined"==typeof fetch||"undefined"==typeof IntersectionObserver||"undefined"==typeof PerformanceObserver||"undefined"==typeof CustomEvent||"function"!=typeof Object.assign||"function"!=typeof Array.prototype.includes||"function"!=typeof String.prototype.includes)},UniversalPolyfills.getCompatibilityReport=function(){var features={Promise:"undefined"!=typeof Promise,fetch:"undefined"!=typeof fetch,IntersectionObserver:"undefined"!=typeof IntersectionObserver,PerformanceObserver:"undefined"!=typeof PerformanceObserver,requestIdleCallback:"undefined"!=typeof window&&void 0!==window.requestIdleCallback,CustomEvent:"undefined"!=typeof CustomEvent,ObjectAssign:!!Object.assign,ArrayIncludes:!!Array.prototype.includes,StringIncludes:!!String.prototype.includes,localStorage:"undefined"!=typeof Storage,sessionStorage:"undefined"!=typeof Storage},polyfillsNeeded=Object.keys(features).filter(function(key){return!features[key]});return{isModern:this.isModernBrowser(),features:features,polyfillsNeeded:polyfillsNeeded}},UniversalPolyfills.initialized=!1,UniversalPolyfills}();function generateVisitorId(){return"v_"+generateRandomId(16)}function generateSessionId(){return"s_"+generateRandomId(12)+"_"+Date.now()}function generateRandomId(length){for(var result="",i=0;i<length;i++)result+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return result}function generateId$1(){if(isBrowser()&&window.crypto&&window.crypto.getRandomValues){var array=new Uint8Array(16);return window.crypto.getRandomValues(array),Array.from(array,function(byte){return byte.toString(16).padStart(2,"0")}).join("")}return Math.random().toString(36).substring(2)+Date.now().toString(36)}function now$1(){return Date.now()}function debounce(func,wait,immediate){void 0===immediate&&(immediate=!1);var timeout=null;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var callNow=immediate&&!timeout;timeout&&clearTimeout(timeout),timeout=setTimeout(function(){timeout=null,immediate||func.apply(void 0,__spreadArray([],__read(args),!1))},wait),callNow&&func.apply(void 0,__spreadArray([],__read(args),!1))}}function throttle(func,limit){var inThrottle;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];inThrottle||(func.apply(void 0,__spreadArray([],__read(args),!1)),inThrottle=!0,setTimeout(function(){return inThrottle=!1},limit))}}function isBrowser(){return"undefined"!=typeof window&&"undefined"!=typeof document}function isProduction(){return"production"===process.env.NODE_ENV}function safeJsonParse(json,fallback){void 0===fallback&&(fallback=null);try{return JSON.parse(json)}catch(_a){return fallback}}function safeJsonStringify(obj,fallback){void 0===fallback&&(fallback="{}");try{return JSON.stringify(obj)}catch(_a){return fallback}}function getCurrentUrl(){return isBrowser()?window.location.href.split("#")[0].split("?")[0]:""}function getCurrentTitle(){return isBrowser()&&document.title||""}function getReferrer(){return isBrowser()&&document.referrer||""}function getUserAgent(){return isBrowser()?navigator.userAgent||"":"server"}function detectPlatform(){if(!isBrowser())return"server";var userAgent=getUserAgent().toLowerCase();return/android/.test(userAgent)?"android":/iphone|ipad|ipod/.test(userAgent)?"ios":/windows/.test(userAgent)?"windows":/mac/.test(userAgent)?"mac":/linux/.test(userAgent)?"linux":"unknown"}function detectBrowser(){if(!isBrowser())return"unknown";var userAgent=getUserAgent().toLowerCase();return/chrome/.test(userAgent)&&!/edge/.test(userAgent)?"chrome":/firefox/.test(userAgent)?"firefox":/safari/.test(userAgent)&&!/chrome/.test(userAgent)?"safari":/edge/.test(userAgent)?"edge":/opera/.test(userAgent)?"opera":"unknown"}function isElementVisible(element){if(!isBrowser())return!1;var rect=element.getBoundingClientRect(),windowHeight=window.innerHeight||document.documentElement.clientHeight,windowWidth=window.innerWidth||document.documentElement.clientWidth;return rect.top>=0&&rect.left>=0&&rect.bottom<=windowHeight&&rect.right<=windowWidth}function getScrollDepth(){if(!isBrowser())return 0;var scrollTop=window.pageYOffset||document.documentElement.scrollTop,documentHeight=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),windowHeight=window.innerHeight||document.documentElement.clientHeight;return documentHeight<=windowHeight?100:Math.round((scrollTop+windowHeight)/documentHeight*100)}function domReady(callback){isBrowser()&&"loading"===document.readyState?document.addEventListener("DOMContentLoaded",callback):callback()}function addEventListener(element,event,handler,options){return element.addEventListener(event,handler,options),function(){return element.removeEventListener(event,handler,options)}}function simpleHash(str){var hash=0;if(0===str.length)return hash;for(var i=0;i<str.length;i++)hash=(hash<<5)-hash+str.charCodeAt(i),hash&=hash;return Math.abs(hash)}function deepMerge(target,source){var result=__assign({},target);for(var key in source)if(source.hasOwnProperty(key)){var sourceValue=source[key],targetValue=result[key];sourceValue&&"object"==typeof sourceValue&&!Array.isArray(sourceValue)&&targetValue&&"object"==typeof targetValue&&!Array.isArray(targetValue)?result[key]=deepMerge(targetValue,sourceValue):result[key]=sourceValue}return result}function getPlatform(){return isBrowser()?navigator.platform:"server"}function getLanguage(){return isBrowser()&&(navigator.language||navigator.userLanguage)||"en"}function getTimezoneOffset(){return isBrowser()?(new Date).getTimezoneOffset():0}function shouldAnonymizeIP(ip,settings){return settings.anonymizeIPs&&Boolean(ip)&&"127.0.0.1"!==ip&&"::1"!==ip}function anonymizeIPv4(ip){var parts=ip.split(".");return 4===parts.length?"".concat(parts[0],".").concat(parts[1],".").concat(parts[2],".0"):ip}function anonymizeIPv6(ip){var parts=ip.split(":");return parts.length>=4?"".concat(parts.slice(0,4).join(":"),"::"):ip}function anonymizeIP(ip){return ip?ip.includes(":")?anonymizeIPv6(ip):anonymizeIPv4(ip):ip}function shouldMinimizeData(settings){return settings.dataMinimization}function removePII(data){if(!data||"object"!=typeof data)return data;var cleaned=__assign({},data);return["email","phone","name","firstName","lastName","fullName","address","street","city","zipCode","postalCode","ssn","socialSecurityNumber","creditCard","bankAccount","passport","driverLicense","taxId"].forEach(function(field){cleaned[field]&&delete cleaned[field]}),cleaned}function hashSensitiveData(data){if(!data)return data;for(var hash=0,i=0;i<data.length;i++)hash=(hash<<5)-hash+data.charCodeAt(i),hash&=hash;return Math.abs(hash).toString(36)}function isConsentRequired(){if(!isBrowser())return!0;var timezone=Intl.DateTimeFormat().resolvedOptions().timeZone;return["Europe/","Atlantic/Azores","Atlantic/Madeira","Atlantic/Canary"].some(function(tz){return timezone.startsWith(tz)})}function getDoNotTrackStatus(){return!!isBrowser()&&("1"===navigator.doNotTrack||"1"===window.doNotTrack||"1"===navigator.msDoNotTrack)}function areCookiesEnabled(){if(!isBrowser())return!1;try{document.cookie="test_cookie=1";var enabled=-1!==document.cookie.indexOf("test_cookie=");return document.cookie="test_cookie=1; expires=Thu, 01-Jan-1970 00:00:01 GMT",enabled}catch(_a){return!1}}function clearAllCookies(domain){isBrowser()&&document.cookie.split(";").forEach(function(cookie){var eqPos=cookie.indexOf("="),name=eqPos>-1?cookie.substr(0,eqPos).trim():cookie.trim();if(name){document.cookie="".concat(name,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"),domain&&(document.cookie="".concat(name,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=").concat(domain));var hostname=window.location.hostname;if(hostname.includes(".")){var parentDomain="."+hostname.split(".").slice(-2).join(".");document.cookie="".concat(name,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=").concat(parentDomain)}}})}function isValidEmail(email){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)}function formatGDPRDate(timestamp){return new Date(timestamp).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function calculateRetentionExpiry(timestamp,retentionDays){return timestamp+24*retentionDays*60*60*1e3}function isDataExpired(timestamp,retentionDays){var expiry=calculateRetentionExpiry(timestamp,retentionDays);return now$1()>expiry}function isBot(){if(!isBrowser())return!1;var userAgent=navigator.userAgent.toLowerCase();return["bot","crawler","spider","crawling","facebook","google","yahoo","bing","duckduckgo","baidu","yandex","twitter","whatsapp","telegram"].some(function(pattern){return userAgent.includes(pattern)})}var BehavioralTracker=function(){function BehavioralTracker(config){void 0===config&&(config={}),this.name="behavioral",this._tracker=null,this._isActive=!1,this._startTime=0,this._lastActivity=0,this._scrollEvents=0,this._mouseEvents=0,this._maxScrollDepth=0,this._clickCount=0,this._formInteractions=0,this._mouseMovements=0,this._trackedElements=new Set,this._visibilityTimers=new Map,this._listeners=[],this._lastScrollTime=0,this._config=__assign({enableClickTracking:!0,enableScrollTracking:!0,enableFormTracking:!0,enableMouseTracking:!0,enableVisibilityTracking:!0,enablePerformanceTracking:!0,scrollThreshold:25,mouseSampleRate:100,clickSelector:'a, button, [role="button"], input[type="submit"], input[type="button"]',formSelector:"form, input, textarea, select",excludeSelectors:[".tracking-ignore",'[data-tracking="false"]'],maxScrollEvents:100,maxMouseEvents:500},config)}return BehavioralTracker.prototype.init=function(){var _a;isBrowser()&&(this._isActive=!0,this._startTime=now$1(),this._lastActivity=now$1(),this._setupEventListeners(),this._startEngagementTracking(),(null===(_a=this._tracker)||void 0===_a?void 0:_a.config.debug)&&console.log("BehavioralTracker initialized",this._config))},BehavioralTracker.prototype.setTracker=function(tracker){this._tracker=tracker},BehavioralTracker.prototype._setupEventListeners=function(){this._config.enableClickTracking&&this._setupClickTracking(),this._config.enableScrollTracking&&this._setupScrollTracking(),this._config.enableFormTracking&&this._setupFormTracking(),this._config.enableMouseTracking&&this._setupMouseTracking(),this._config.enableVisibilityTracking&&this._setupVisibilityTracking(),this._config.enablePerformanceTracking&&this._setupPerformanceTracking(),this._setupActivityTracking()},BehavioralTracker.prototype._setupClickTracking=function(){var _this=this,handleClick=function(event){if(_this._isActive&&_this._tracker){var target=event.target;if(target&&!_this._isExcluded(target)){if(!target.matches(_this._config.clickSelector)){for(var parent_1=target.parentElement,found=!1,i=0;i<3&&parent_1;i++){if(parent_1.matches(_this._config.clickSelector)){found=!0;break}parent_1=parent_1.parentElement}if(!found)return}var clickData={element:_this._getElementSelector(target),tagName:target.tagName.toLowerCase(),className:target.className,id:target.id||"",text:_this._getElementText(target),x:event.clientX,y:event.clientY,timestamp:now$1()};_this._trackEvent("click",clickData),_this._clickCount++,_this._updateActivity(),_this._tracker.config.debug&&console.log("Click tracked:",clickData)}}};document.addEventListener("click",handleClick,{passive:!0}),this._listeners.push(function(){return document.removeEventListener("click",handleClick)})},BehavioralTracker.prototype._setupScrollTracking=function(){var _this=this,lastScrollTop=0,handleScroll=throttle(function(){if(_this._isActive&&_this._tracker&&!(_this._scrollEvents>=_this._config.maxScrollEvents)){var scrollTop=window.pageYOffset||document.documentElement.scrollTop,scrollHeight=document.documentElement.scrollHeight-window.innerHeight,currentDepth=Math.round(scrollTop/scrollHeight*100);if(_this._maxScrollDepth=Math.max(_this._maxScrollDepth,currentDepth),Math.abs(currentDepth-Math.round(lastScrollTop/scrollHeight*100))<_this._config.scrollThreshold)lastScrollTop=scrollTop;else{var currentTime=now$1(),direction=scrollTop>lastScrollTop?"down":"up",speed=Math.abs(scrollTop-lastScrollTop)/(currentTime-_this._lastScrollTime),scrollData={depth:currentDepth,maxDepth:_this._maxScrollDepth,direction:direction,speed:speed,timestamp:currentTime};_this._trackEvent("scroll",scrollData),_this._scrollEvents++,_this._updateActivity(),lastScrollTop=scrollTop,_this._lastScrollTime=currentTime,_this._tracker.config.debug&&console.log("Scroll tracked:",scrollData)}}},250);window.addEventListener("scroll",handleScroll,{passive:!0}),this._listeners.push(function(){return window.removeEventListener("scroll",handleScroll)})},BehavioralTracker.prototype._setupFormTracking=function(){var _this=this,handleFormEvent=function(event,action){var _a;if(_this._isActive&&_this._tracker){var target=event.target;if(target&&!_this._isExcluded(target)){var form=target.closest("form"),formData={formId:(null==form?void 0:form.id)||"",formName:(null==form?void 0:form.getAttribute("name"))||"",field:_this._getElementSelector(target),fieldType:target.type||target.tagName.toLowerCase(),action:action,value:"change"===action?null===(_a=target.value)||void 0===_a?void 0:_a.slice(0,50):void 0,timestamp:now$1()};_this._trackEvent("form_interaction",formData),_this._formInteractions++,_this._updateActivity(),_this._tracker.config.debug&&console.log("Form interaction tracked:",formData)}}};["focus","blur","change"].forEach(function(eventType){var handler=function(event){return handleFormEvent(event,eventType)};document.addEventListener(eventType,handler,{passive:!0}),_this._listeners.push(function(){return document.removeEventListener(eventType,handler)})});var handleSubmit=function(event){return handleFormEvent(event,"submit")};document.addEventListener("submit",handleSubmit,{passive:!0}),this._listeners.push(function(){return document.removeEventListener("submit",handleSubmit)})},BehavioralTracker.prototype._setupMouseTracking=function(){var _this=this,handleMouseMove=throttle(function(event){if(_this._isActive&&_this._tracker&&!(_this._mouseEvents>=_this._config.maxMouseEvents)){var target=event.target,mouseData={x:event.clientX,y:event.clientY,type:"move",element:target?_this._getElementSelector(target):"document",timestamp:now$1()};_this._trackEvent("mouse_move",mouseData),_this._mouseEvents++,_this._mouseMovements++,_this._updateActivity()}},this._config.mouseSampleRate);document.addEventListener("mousemove",handleMouseMove,{passive:!0}),this._listeners.push(function(){return document.removeEventListener("mousemove",handleMouseMove)})},BehavioralTracker.prototype._setupVisibilityTracking=function(){var _this=this;"IntersectionObserver"in window&&(this._visibilityObserver=new IntersectionObserver(function(entries){entries.forEach(function(entry){var _a,element=entry.target,isVisible=entry.isIntersecting,timestamp=now$1();if(isVisible)_this._visibilityTimers.set(element,timestamp);else{var startTime=_this._visibilityTimers.get(element);if(startTime){var duration=timestamp-startTime,visibilityData={element:_this._getElementSelector(element),visible:!1,duration:duration,timestamp:timestamp};_this._trackEvent("element_visibility",visibilityData),_this._visibilityTimers.delete(element),(null===(_a=_this._tracker)||void 0===_a?void 0:_a.config.debug)&&console.log("Element visibility tracked:",visibilityData)}}})},{threshold:[0,.25,.5,.75,1]}),document.querySelectorAll("[data-track-visibility], .cta, .product, .pricing").forEach(function(el){var _a;null===(_a=_this._visibilityObserver)||void 0===_a||_a.observe(el),_this._trackedElements.add(el)}))},BehavioralTracker.prototype._setupPerformanceTracking=function(){var _a,_this=this;if("PerformanceObserver"in window)try{this._performanceObserver=new PerformanceObserver(function(list){list.getEntries().forEach(function(entry){"largest-contentful-paint"===entry.entryType?_this._trackEvent("performance",{metric:"lcp",value:entry.startTime,timestamp:now$1()}):"first-input"===entry.entryType?_this._trackEvent("performance",{metric:"fid",value:entry.processingStart-entry.startTime,timestamp:now$1()}):"layout-shift"===entry.entryType&&_this._trackEvent("performance",{metric:"cls",value:entry.value,timestamp:now$1()})})}),this._performanceObserver.observe({entryTypes:["largest-contentful-paint","first-input","layout-shift"]})}catch(error){(null===(_a=this._tracker)||void 0===_a?void 0:_a.config.debug)&&console.warn("Performance tracking not supported:",error)}},BehavioralTracker.prototype._setupActivityTracking=function(){var _this=this,resetIdleTimer=function(){_this._idleTimer&&clearTimeout(_this._idleTimer),_this._idleTimer=window.setTimeout(function(){_this._trackEvent("user_idle",{duration:3e4,timestamp:now$1()})},3e4)};["mousedown","mousemove","keypress","scroll","touchstart"].forEach(function(eventType){document.addEventListener(eventType,resetIdleTimer,{passive:!0}),_this._listeners.push(function(){return document.removeEventListener(eventType,resetIdleTimer)})}),resetIdleTimer()},BehavioralTracker.prototype._startEngagementTracking=function(){var _this=this;this._engagementInterval=window.setInterval(function(){if(_this._isActive&&_this._tracker){var metrics=_this._calculateEngagementMetrics();_this._trackEvent("engagement_metrics",metrics),_this._tracker.config.debug&&console.log("Engagement metrics:",metrics)}},3e4)},BehavioralTracker.prototype._calculateEngagementMetrics=function(){var currentTime=now$1(),timeOnPage=currentTime-this._startTime,idleTime=currentTime-this._lastActivity,scrollWeight=25*Math.min(this._maxScrollDepth/100,1),clickWeight=25*Math.min(this._clickCount/5,1),formWeight=25*Math.min(this._formInteractions/3,1),timeWeight=25*Math.min(timeOnPage/6e4,1),engagementScore=Math.round(scrollWeight+clickWeight+formWeight+timeWeight);return{timeOnPage:timeOnPage,scrollDepth:this._maxScrollDepth,clickCount:this._clickCount,formInteractions:this._formInteractions,mouseMovements:this._mouseMovements,idleTime:idleTime,engagementScore:engagementScore}},BehavioralTracker.prototype._trackEvent=function(type,data){if(this._tracker){var eventData={type:type,element:data.element||type,value:data.value||JSON.stringify(data),timestamp:data.timestamp||now$1(),sessionId:this._tracker.session.sessionId,visitorId:this._tracker.session.visitorId,metadata:data};this._tracker.track("behavioral:".concat(type),eventData)}},BehavioralTracker.prototype._updateActivity=function(){this._lastActivity=now$1()},BehavioralTracker.prototype._isExcluded=function(element){return this._config.excludeSelectors.some(function(selector){return element.matches(selector)})},BehavioralTracker.prototype._getElementSelector=function(element){if(!element)return"unknown";if(element.id)return"#".concat(element.id);if(element.className&&"string"==typeof element.className){var classes=element.className.split(" ").filter(function(c){return c.length>0});if(classes.length>0)return".".concat(classes[0])}return element.tagName?element.tagName.toLowerCase():"unknown"},BehavioralTracker.prototype._getElementText=function(element){return(element.textContent||element.value||"").trim().slice(0,100)},BehavioralTracker.prototype.enable=function(){this._isActive=!0},BehavioralTracker.prototype.disable=function(){this._isActive=!1},BehavioralTracker.prototype.destroy=function(){var _a;this._isActive=!1,this._idleTimer&&clearTimeout(this._idleTimer),this._engagementInterval&&clearInterval(this._engagementInterval),this._visibilityObserver&&this._visibilityObserver.disconnect(),this._performanceObserver&&this._performanceObserver.disconnect(),this._listeners.forEach(function(removeListener){return removeListener()}),this._listeners=[],this._trackedElements.clear(),this._visibilityTimers.clear(),(null===(_a=this._tracker)||void 0===_a?void 0:_a.config.debug)&&console.log("BehavioralTracker destroyed")},BehavioralTracker.prototype.getEngagementMetrics=function(){return this._calculateEngagementMetrics()},BehavioralTracker.prototype.trackCustomEvent=function(type,data){this._trackEvent(type,data)},BehavioralTracker}(),EventEmitter=function(){function EventEmitter(){this._events=new Map}return EventEmitter.prototype.on=function(event,callback){this._events.has(event)||this._events.set(event,[]),this._events.get(event).push(callback)},EventEmitter.prototype.off=function(event,callback){var listeners=this._events.get(event);if(listeners){var index=listeners.indexOf(callback);index>-1&&listeners.splice(index,1),0===listeners.length&&this._events.delete(event)}},EventEmitter.prototype.emit=function(event){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];var listeners=this._events.get(event);listeners&&__spreadArray([],__read(listeners),!1).forEach(function(callback){try{callback.apply(void 0,__spreadArray([],__read(args),!1))}catch(error){"production"!==process.env.NODE_ENV&&console.error("Event listener error:",error)}})},EventEmitter.prototype.once=function(event,callback){var _this=this,onceWrapper=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];callback.apply(void 0,__spreadArray([],__read(args),!1)),_this.off(event,onceWrapper)};this.on(event,onceWrapper)},EventEmitter.prototype.removeAllListeners=function(event){event?this._events.delete(event):this._events.clear()},EventEmitter.prototype.listenerCount=function(event){var listeners=this._events.get(event);return listeners?listeners.length:0},EventEmitter.prototype.eventNames=function(){return Array.from(this._events.keys())},EventEmitter}(),now=function(){return isBrowser()&&"performance"in window&&performance.now?performance.now():Date.now()},generateId=function(){return Math.random().toString(36).substr(2,9)},PerformanceOptimizer=function(_super){function PerformanceOptimizer(config){void 0===config&&(config={});var _this=_super.call(this)||this;return _this.name="PerformanceOptimizer",_this._isMonitoring=!1,_this._initialized=!1,_this._lazyModules=new Map,_this._loadedModules=new Set,_this._loadingPromises=new Map,_this._splitPoints=new Map,_this._loadedChunks=new Set,_this._memorySnapshots=[],_this._memoryThresholds={warning:50,critical:75},_this._detectedLeaks=[],_this._lastGC=0,_this._cpuProfiles=[],_this._taskQueue=[],_this._isThrottling=!1,_this._currentThrottle=0,_this._requestBatches=new Map,_this._pendingRequests=[],_this._lastFlush=0,_this._coreWebVitals={lcp:0,fid:0,cls:0},_this._vitalsHistory=[],_this._resourcePriorities=new Map,_this._criticalResources=new Set,_this._preloadedResources=new Set,_this._platformOptimizations=new Map,_this._startTime=0,_this._config=_this._getDefaultConfig(config),_this._metrics=_this._getInitialMetrics(),_this._thresholds=_this._getDefaultThresholds(),_this}return __extends(PerformanceOptimizer,_super),PerformanceOptimizer.prototype._getDefaultConfig=function(config){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_40,_41,_42,_43,_44,_45,_46,_47,_48,_49,_50,_51,_52,_53,_54,_55,_56;return{enabled:null===(_a=config.enabled)||void 0===_a||_a,lazyLoading:{enabled:null===(_c=null===(_b=config.lazyLoading)||void 0===_b?void 0:_b.enabled)||void 0===_c||_c,threshold:null!==(_e=null===(_d=config.lazyLoading)||void 0===_d?void 0:_d.threshold)&&void 0!==_e?_e:51200,modules:null!==(_g=null===(_f=config.lazyLoading)||void 0===_f?void 0:_f.modules)&&void 0!==_g?_g:[],chunkSize:null!==(_j=null===(_h=config.lazyLoading)||void 0===_h?void 0:_h.chunkSize)&&void 0!==_j?_j:102400},codesplitting:{enabled:null===(_l=null===(_k=config.codesplitting)||void 0===_k?void 0:_k.enabled)||void 0===_l||_l,splitPoints:null!==(_o=null===(_m=config.codesplitting)||void 0===_m?void 0:_m.splitPoints)&&void 0!==_o?_o:[],dynamicImports:null===(_q=null===(_p=config.codesplitting)||void 0===_p?void 0:_p.dynamicImports)||void 0===_q||_q,preloadCritical:null===(_s=null===(_r=config.codesplitting)||void 0===_r?void 0:_r.preloadCritical)||void 0===_s||_s},memoryManagement:{enabled:null===(_u=null===(_t=config.memoryManagement)||void 0===_t?void 0:_t.enabled)||void 0===_u||_u,maxMemoryUsage:null!==(_w=null===(_v=config.memoryManagement)||void 0===_v?void 0:_v.maxMemoryUsage)&&void 0!==_w?_w:100,gcInterval:null!==(_y=null===(_x=config.memoryManagement)||void 0===_x?void 0:_x.gcInterval)&&void 0!==_y?_y:3e4,leakDetection:null===(_0=null===(_z=config.memoryManagement)||void 0===_z?void 0:_z.leakDetection)||void 0===_0||_0,autoCleanup:null===(_2=null===(_1=config.memoryManagement)||void 0===_1?void 0:_1.autoCleanup)||void 0===_2||_2,memoryThreshold:null!==(_4=null===(_3=config.memoryManagement)||void 0===_3?void 0:_3.memoryThreshold)&&void 0!==_4?_4:80},cpuThrottling:{enabled:null===(_6=null===(_5=config.cpuThrottling)||void 0===_5?void 0:_5.enabled)||void 0===_6||_6,maxCpuUsage:null!==(_8=null===(_7=config.cpuThrottling)||void 0===_7?void 0:_7.maxCpuUsage)&&void 0!==_8?_8:70,throttleInterval:null!==(_10=null===(_9=config.cpuThrottling)||void 0===_9?void 0:_9.throttleInterval)&&void 0!==_10?_10:100,adaptiveThrottling:null===(_12=null===(_11=config.cpuThrottling)||void 0===_11?void 0:_11.adaptiveThrottling)||void 0===_12||_12,priorityQueue:null===(_14=null===(_13=config.cpuThrottling)||void 0===_13?void 0:_13.priorityQueue)||void 0===_14||_14},requestBatching:{enabled:null===(_16=null===(_15=config.requestBatching)||void 0===_15?void 0:_15.enabled)||void 0===_16||_16,batchSize:null!==(_18=null===(_17=config.requestBatching)||void 0===_17?void 0:_17.batchSize)&&void 0!==_18?_18:10,flushInterval:null!==(_20=null===(_19=config.requestBatching)||void 0===_19?void 0:_19.flushInterval)&&void 0!==_20?_20:5e3,maxBatchAge:null!==(_22=null===(_21=config.requestBatching)||void 0===_21?void 0:_21.maxBatchAge)&&void 0!==_22?_22:3e4,priorityBatching:null===(_24=null===(_23=config.requestBatching)||void 0===_23?void 0:_23.priorityBatching)||void 0===_24||_24,compression:null===(_26=null===(_25=config.requestBatching)||void 0===_25?void 0:_25.compression)||void 0===_26||_26},coreWebVitals:{enabled:null===(_28=null===(_27=config.coreWebVitals)||void 0===_27?void 0:_27.enabled)||void 0===_28||_28,lcpThreshold:null!==(_30=null===(_29=config.coreWebVitals)||void 0===_29?void 0:_29.lcpThreshold)&&void 0!==_30?_30:2500,fidThreshold:null!==(_32=null===(_31=config.coreWebVitals)||void 0===_31?void 0:_31.fidThreshold)&&void 0!==_32?_32:100,clsThreshold:null!==(_34=null===(_33=config.coreWebVitals)||void 0===_33?void 0:_33.clsThreshold)&&void 0!==_34?_34:.1,monitoring:null===(_36=null===(_35=config.coreWebVitals)||void 0===_35?void 0:_35.monitoring)||void 0===_36||_36,optimization:null===(_38=null===(_37=config.coreWebVitals)||void 0===_37?void 0:_37.optimization)||void 0===_38||_38},resourcePrioritization:{enabled:null===(_40=null===(_39=config.resourcePrioritization)||void 0===_39?void 0:_39.enabled)||void 0===_40||_40,criticalResources:null!==(_42=null===(_41=config.resourcePrioritization)||void 0===_41?void 0:_41.criticalResources)&&void 0!==_42?_42:[],preloadThreshold:null!==(_44=null===(_43=config.resourcePrioritization)||void 0===_43?void 0:_43.preloadThreshold)&&void 0!==_44?_44:1e3,deferNonCritical:null===(_46=null===(_45=config.resourcePrioritization)||void 0===_45?void 0:_45.deferNonCritical)||void 0===_46||_46,adaptivePriority:null===(_48=null===(_47=config.resourcePrioritization)||void 0===_47?void 0:_47.adaptivePriority)||void 0===_48||_48},crossPlatform:{enabled:null===(_50=null===(_49=config.crossPlatform)||void 0===_49?void 0:_49.enabled)||void 0===_50||_50,frameworkOptimizations:null!==(_52=null===(_51=config.crossPlatform)||void 0===_51?void 0:_51.frameworkOptimizations)&&void 0!==_52?_52:{},universalPolyfills:null===(_54=null===(_53=config.crossPlatform)||void 0===_53?void 0:_53.universalPolyfills)||void 0===_54||_54,adaptiveLoading:null===(_56=null===(_55=config.crossPlatform)||void 0===_55?void 0:_55.adaptiveLoading)||void 0===_56||_56}}},PerformanceOptimizer.prototype._getInitialMetrics=function(){return{loadTime:0,domReady:0,firstPaint:0,firstContentfulPaint:0,largestContentfulPaint:0,firstInputDelay:0,cumulativeLayoutShift:0,totalBlockingTime:0,timeToInteractive:0,memoryUsage:{used:0,total:0,limit:1024*this._config.memoryManagement.maxMemoryUsage*1024},cpuUsage:0,networkStats:{requests:0,bytesTransferred:0,averageLatency:0},scriptPerformance:{initTime:0,executionTime:0,moduleLoadTimes:{}}}},PerformanceOptimizer.prototype._getDefaultThresholds=function(){return{memory:{warning:this._config.memoryManagement.memoryThreshold,critical:this._config.memoryManagement.maxMemoryUsage},cpu:{warning:.8*this._config.cpuThrottling.maxCpuUsage,critical:this._config.cpuThrottling.maxCpuUsage},network:{latency:500,bandwidth:1048576},coreWebVitals:{lcp:this._config.coreWebVitals.lcpThreshold,fid:this._config.coreWebVitals.fidThreshold,cls:this._config.coreWebVitals.clsThreshold}}},PerformanceOptimizer.prototype.init=function(){if(!this._initialized&&this._config.enabled)try{this._config.lazyLoading.enabled&&this._initLazyLoading(),this._config.codesplitting.enabled&&this._initCodeSplitting(),this._config.memoryManagement.enabled&&this._initMemoryManagement(),this._config.cpuThrottling.enabled&&this._initCpuThrottling(),this._config.requestBatching.enabled&&this._initRequestBatching(),this._config.coreWebVitals.enabled&&this._initCoreWebVitals(),this._config.resourcePrioritization.enabled&&this._initResourcePrioritization(),this._config.crossPlatform.enabled&&this._initCrossPlatform(),this._detectPlatform(),this._measureInitialMetrics(),this._initialized=!0,this.emit("performance:initialized",{config:this._config})}catch(error){console.error("PerformanceOptimizer initialization failed:",error),this.emit("performance:error",error)}},PerformanceOptimizer.prototype.destroy=function(){this.stopMonitoring(),this._throttleInterval&&clearInterval(this._throttleInterval),this._batchInterval&&clearInterval(this._batchInterval),this._monitoringInterval&&clearInterval(this._monitoringInterval),this._vitalsObserver&&this._vitalsObserver.disconnect(),this._performanceObserver&&this._performanceObserver.disconnect(),this._resizeObserver&&this._resizeObserver.disconnect(),this._lazyModules.clear(),this._loadedModules.clear(),this._loadingPromises.clear(),this._splitPoints.clear(),this._loadedChunks.clear(),this._memorySnapshots=[],this._detectedLeaks=[],this._cpuProfiles=[],this._taskQueue=[],this._requestBatches.clear(),this._pendingRequests=[],this._resourcePriorities.clear(),this._criticalResources.clear(),this._preloadedResources.clear(),this._platformOptimizations.clear(),this._initialized=!1,this.emit("performance:destroyed")},PerformanceOptimizer.prototype.configure=function(config){this._config=__assign(__assign({},this._config),config),this._thresholds=this._getDefaultThresholds(),this._initialized&&(this.destroy(),this.init()),this.emit("performance:configured",{config:this._config})},PerformanceOptimizer.prototype.getConfig=function(){return __assign({},this._config)},PerformanceOptimizer.prototype._initLazyLoading=function(){var _this=this;this._config.lazyLoading.modules.forEach(function(moduleName){_this.registerLazyModule({name:moduleName,size:0,priority:"normal",dependencies:[],loader:function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){return[2,import(moduleName)]})})},loaded:!1})})},PerformanceOptimizer.prototype.registerLazyModule=function(module){this._lazyModules.set(module.name,module),this.emit("performance:module_registered",{module:module.name})},PerformanceOptimizer.prototype.loadModule=function(name){return __awaiter(this,void 0,void 0,function(){var module,existingPromise,startTime,loadPromise,result,loadTime,error_1;return __generator(this,function(_a){switch(_a.label){case 0:if(!(module=this._lazyModules.get(name)))throw new Error("Module '".concat(name,"' not registered for lazy loading"));if(module.loaded)return[2,module];if(existingPromise=this._loadingPromises.get(name))return[2,existingPromise];startTime=now(),loadPromise=this._loadModuleWithDependencies(module),this._loadingPromises.set(name,loadPromise),_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,loadPromise];case 2:return result=_a.sent(),loadTime=now()-startTime,module.loaded=!0,module.loadTime=loadTime,this._loadedModules.add(name),this._loadingPromises.delete(name),this._metrics.scriptPerformance&&(this._metrics.scriptPerformance.moduleLoadTimes[name]=loadTime),this.emit("performance:module_loaded",{module:name,loadTime:loadTime,size:module.size}),[2,result];case 3:throw error_1=_a.sent(),this._loadingPromises.delete(name),this.emit("performance:module_error",{module:name,error:error_1}),error_1;case 4:return[2]}})})},PerformanceOptimizer.prototype._loadModuleWithDependencies=function(module){return __awaiter(this,void 0,void 0,function(){var _a,_b,dep,e_1_1,e_1,_c;return __generator(this,function(_d){switch(_d.label){case 0:_d.trys.push([0,5,6,7]),_a=__values(module.dependencies),_b=_a.next(),_d.label=1;case 1:return _b.done?[3,4]:(dep=_b.value,this._loadedModules.has(dep)?[3,3]:[4,this.loadModule(dep)]);case 2:_d.sent(),_d.label=3;case 3:return _b=_a.next(),[3,1];case 4:return[3,7];case 5:return e_1_1=_d.sent(),e_1={error:e_1_1},[3,7];case 6:try{_b&&!_b.done&&(_c=_a.return)&&_c.call(_a)}finally{if(e_1)throw e_1.error}return[7];case 7:return[2,module.loader()]}})})},PerformanceOptimizer.prototype.preloadModules=function(names){return __awaiter(this,void 0,void 0,function(){var loadPromises,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return loadPromises=names.map(function(name){return _this.loadModule(name)}),[4,Promise.all(loadPromises)];case 1:return _a.sent(),this.emit("performance:modules_preloaded",{modules:names}),[2]}})})},PerformanceOptimizer.prototype._initCodeSplitting=function(){this._config.codesplitting.preloadCritical&&this.preloadCritical()},PerformanceOptimizer.prototype.registerSplitPoint=function(splitPoint){this._splitPoints.set(splitPoint.name,splitPoint),splitPoint.critical&&this._criticalResources.add(splitPoint.name),this.emit("performance:split_point_registered",{splitPoint:splitPoint.name})},PerformanceOptimizer.prototype.splitCode=function(){return __awaiter(this,void 0,void 0,function(){var splitPromises,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return splitPromises=[],Array.from(this._splitPoints.entries()).forEach(function(_a){var _b=__read(_a,2),name=_b[0],splitPoint=_b[1];if(!_this._loadedChunks.has(name)&&splitPoint.condition()){var splitPromise=_this._loadSplitPoint(splitPoint);splitPromises.push(splitPromise)}}),[4,Promise.all(splitPromises)];case 1:return _a.sent(),this.emit("performance:code_split_complete"),[2]}})})},PerformanceOptimizer.prototype._loadSplitPoint=function(splitPoint){return __awaiter(this,void 0,void 0,function(){var startTime,modulePromises,loadTime,error_2,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:startTime=now(),_a.label=1;case 1:return _a.trys.push([1,3,,4]),modulePromises=splitPoint.modules.map(function(module){return _this.loadModule(module)}),[4,Promise.all(modulePromises)];case 2:return _a.sent(),this._loadedChunks.add(splitPoint.name),loadTime=now()-startTime,this.emit("performance:split_point_loaded",{splitPoint:splitPoint.name,loadTime:loadTime,modules:splitPoint.modules}),[3,4];case 3:throw error_2=_a.sent(),this.emit("performance:split_point_error",{splitPoint:splitPoint.name,error:error_2}),error_2;case 4:return[2]}})})},PerformanceOptimizer.prototype.preloadCritical=function(){return __awaiter(this,void 0,void 0,function(){var criticalSplitPoints,loadPromises,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return criticalSplitPoints=Array.from(this._splitPoints.values()).filter(function(sp){return sp.critical||sp.preload}),loadPromises=criticalSplitPoints.map(function(sp){return _this._loadSplitPoint(sp)}),[4,Promise.all(loadPromises)];case 1:return _a.sent(),this.emit("performance:critical_preloaded",{count:criticalSplitPoints.length}),[2]}})})},PerformanceOptimizer.prototype._initMemoryManagement=function(){var _this=this;if(this._config.memoryManagement.enabled)try{this._config.memoryManagement.gcInterval&&(this._gcInterval=window.setInterval(function(){_this._performGarbageCollection()},this._config.memoryManagement.gcInterval)),this._config.memoryManagement.leakDetection&&this._startMemoryLeakDetection()}catch(error){console.warn("Failed to initialize memory management:",error)}},PerformanceOptimizer.prototype.getMemoryUsage=function(){var snapshot={timestamp:now(),heapUsed:0,heapTotal:0,external:0};if(isBrowser()&&"memory"in performance){var memory=performance.memory;snapshot.heapUsed=memory.usedJSHeapSize||0,snapshot.heapTotal=memory.totalJSHeapSize||0,snapshot.external=memory.totalJSHeapSize-memory.usedJSHeapSize||0}return this._config.memoryManagement.leakDetection&&(snapshot.leaks=this.detectMemoryLeaks()),this._memorySnapshots.push(snapshot),this._memorySnapshots.length>100&&(this._memorySnapshots=this._memorySnapshots.slice(-100)),snapshot},PerformanceOptimizer.prototype.detectMemoryLeaks=function(){var leaks=[];if(this._memorySnapshots.length<5)return leaks;var recent=this._memorySnapshots.slice(-5);if(recent.every(function(snapshot,i){return 0===i||snapshot.heapUsed>recent[i-1].heapUsed})){var growth=recent[recent.length-1].heapUsed-recent[0].heapUsed;growth>10485760&&leaks.push({type:"memory_growth",size:growth,location:"heap",timestamp:now(),stack:(new Error).stack||"No stack trace available"})}return this._detectedLeaks=leaks,leaks},PerformanceOptimizer.prototype.cleanup=function(){var e_2,_a;this._memorySnapshots=this._memorySnapshots.slice(-10),this._cpuProfiles=this._cpuProfiles.slice(-10),this._vitalsHistory=this._vitalsHistory.slice(-10);try{for(var _b=__values(this._requestBatches),_c=_b.next();!_c.done;_c=_b.next()){var _d=__read(_c.value,2),id=_d[0];_d[1].createdAt<now()-this._config.requestBatching.maxBatchAge&&this._requestBatches.delete(id)}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_2)throw e_2.error}}this.emit("performance:cleanup_complete")},PerformanceOptimizer.prototype.forceGarbageCollection=function(){this._performGarbageCollection()},PerformanceOptimizer.prototype._performGarbageCollection=function(){var beforeSnapshot=this.getMemoryUsage();this.cleanup(),"gc"in window&&"function"==typeof window.gc&&window.gc();var afterSnapshot=this.getMemoryUsage(),freed=beforeSnapshot.heapUsed-afterSnapshot.heapUsed;this._lastGC=now(),this.emit("performance:gc_performed",{freed:freed,before:beforeSnapshot,after:afterSnapshot})},PerformanceOptimizer.prototype._startMemoryLeakDetection=function(){var _this=this;setInterval(function(){var usage=_this.getMemoryUsage(),threshold=1024*_this._thresholds.memory.warning*1024;usage.heapUsed>threshold&&_this.emit("performance:memory_warning",{usage:usage.heapUsed,threshold:threshold,leaks:usage.leaks})},1e4)},PerformanceOptimizer.prototype._initCpuThrottling=function(){this._config.cpuThrottling.priorityQueue&&this._startTaskQueue(),this._config.cpuThrottling.adaptiveThrottling&&this._startCpuMonitoring()},PerformanceOptimizer.prototype.getCpuUsage=function(){var profile={timestamp:now(),usage:0,tasks:[],throttled:this._isThrottling};return this._taskQueue.length>0&&(profile.usage=Math.min(10*this._taskQueue.length,100)),this._cpuProfiles.push(profile),this._cpuProfiles.length>50&&(this._cpuProfiles=this._cpuProfiles.slice(-50)),profile},PerformanceOptimizer.prototype.throttleCpu=function(enabled){var _this=this;this._isThrottling=enabled,enabled&&!this._throttleInterval?this._throttleInterval=window.setInterval(function(){_this._processTaskQueue()},this._config.cpuThrottling.throttleInterval):!enabled&&this._throttleInterval&&(clearInterval(this._throttleInterval),this._throttleInterval=void 0),this.emit("performance:cpu_throttling_changed",{enabled:enabled})},PerformanceOptimizer.prototype.queueTask=function(task,priority){this._taskQueue.push({fn:task,priority:priority}),this._taskQueue.sort(function(a,b){var priorities={critical:4,high:3,normal:2,low:1};return priorities[b.priority]-priorities[a.priority]}),this.emit("performance:task_queued",{priority:priority,queueSize:this._taskQueue.length})},PerformanceOptimizer.prototype._startTaskQueue=function(){this.throttleCpu(!0)},PerformanceOptimizer.prototype._startCpuMonitoring=function(){var _this=this;setInterval(function(){var profile=_this.getCpuUsage(),threshold=_this._thresholds.cpu.warning;profile.usage>threshold&&!_this._isThrottling?(_this.throttleCpu(!0),_this.emit("performance:cpu_throttling_activated",{usage:profile.usage,threshold:threshold})):profile.usage<.5*threshold&&_this._isThrottling&&(_this.throttleCpu(!1),_this.emit("performance:cpu_throttling_deactivated",{usage:profile.usage}))},5e3)},PerformanceOptimizer.prototype._processTaskQueue=function(){var _this=this;if(0!==this._taskQueue.length){var batchSize=this._isThrottling?2:5;this._taskQueue.splice(0,batchSize).forEach(function(_a){var fn=_a.fn;try{fn()}catch(error){_this.emit("performance:task_error",{error:error})}})}},PerformanceOptimizer.prototype._initRequestBatching=function(){var _this=this;this._batchInterval=window.setInterval(function(){_this._flushOldBatches()},this._config.requestBatching.flushInterval)},PerformanceOptimizer.prototype.addRequest=function(request){var queuedRequest=__assign(__assign({},request),{id:generateId(),timestamp:now()});return this._pendingRequests.push(queuedRequest),this._createOrUpdateBatch(queuedRequest),this.emit("performance:request_queued",{requestId:queuedRequest.id}),queuedRequest.id},PerformanceOptimizer.prototype._createOrUpdateBatch=function(request){var e_3,_a,targetBatch;try{for(var _b=__values(this._requestBatches.values()),_c=_b.next();!_c.done;_c=_b.next()){var batch=_c.value;if(batch.priority===request.priority&&batch.requests.length<this._config.requestBatching.batchSize){targetBatch=batch;break}}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_3)throw e_3.error}}targetBatch||(targetBatch={id:generateId(),requests:[],size:0,priority:request.priority,createdAt:now(),flushAt:now()+this._config.requestBatching.flushInterval,compressed:this._config.requestBatching.compression},this._requestBatches.set(targetBatch.id,targetBatch)),targetBatch.requests.push(request),targetBatch.size+=JSON.stringify(request.data).length,targetBatch.requests.length>=this._config.requestBatching.batchSize&&this.flushBatch(targetBatch.id)},PerformanceOptimizer.prototype.flushBatch=function(batchId){return __awaiter(this,void 0,void 0,function(){var batch,flushPromises,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return batchId?(batch=this._requestBatches.get(batchId))?[4,this._sendBatch(batch)]:[3,2]:[3,3];case 1:_a.sent(),this._requestBatches.delete(batchId),_a.label=2;case 2:return[3,5];case 3:return flushPromises=Array.from(this._requestBatches.values()).map(function(batch){return _this._sendBatch(batch)}),[4,Promise.all(flushPromises)];case 4:_a.sent(),this._requestBatches.clear(),_a.label=5;case 5:return this._lastFlush=now(),[2]}})})},PerformanceOptimizer.prototype._sendBatch=function(batch){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){try{this.emit("performance:batch_sent",{batchId:batch.id,requestCount:batch.requests.length,size:batch.size})}catch(error){this.emit("performance:batch_error",{batchId:batch.id,error:error})}return[2]})})},PerformanceOptimizer.prototype._flushOldBatches=function(){var e_4,_a,currentTime=now();try{for(var _b=__values(this._requestBatches),_c=_b.next();!_c.done;_c=_b.next()){var _d=__read(_c.value,2),id=_d[0];currentTime>=_d[1].flushAt&&this.flushBatch(id)}}catch(e_4_1){e_4={error:e_4_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_4)throw e_4.error}}},PerformanceOptimizer.prototype.getBatchStatus=function(){return Array.from(this._requestBatches.values())},PerformanceOptimizer.prototype._initCoreWebVitals=function(){isBrowser()&&this._config.coreWebVitals.monitoring&&this._observeCoreWebVitals()},PerformanceOptimizer.prototype._observeCoreWebVitals=function(){var _this=this;if("undefined"!=typeof PerformanceObserver){try{new PerformanceObserver(function(list){var entries=list.getEntries(),lastEntry=entries[entries.length-1];_this._coreWebVitals.lcp=lastEntry.startTime,_this._updateCoreWebVitals()}).observe({entryTypes:["largest-contentful-paint"]})}catch(_a){}try{new PerformanceObserver(function(list){list.getEntries().forEach(function(entry){entry.processingStart-entry.startTime>0&&(_this._coreWebVitals.fid=entry.processingStart-entry.startTime,_this._updateCoreWebVitals())})}).observe({entryTypes:["first-input"]})}catch(_b){}try{new PerformanceObserver(function(list){var clsValue=0;list.getEntries().forEach(function(entry){entry.hadRecentInput||(clsValue+=entry.value)}),_this._coreWebVitals.cls=clsValue,_this._updateCoreWebVitals()}).observe({entryTypes:["layout-shift"]})}catch(_c){}}},PerformanceOptimizer.prototype._updateCoreWebVitals=function(){this._vitalsHistory.push(__assign({},this._coreWebVitals)),this._vitalsHistory.length>50&&(this._vitalsHistory=this._vitalsHistory.slice(-50)),this.emit("performance:core_web_vitals_updated",this._coreWebVitals)},PerformanceOptimizer.prototype.measureCoreWebVitals=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return[2,new Promise(function(resolve){setTimeout(function(){resolve(__assign({},_this._coreWebVitals))},100)})]})})},PerformanceOptimizer.prototype.optimizeCoreWebVitals=function(){this._coreWebVitals.lcp&&this._coreWebVitals.lcp>this._thresholds.coreWebVitals.lcp&&(this.preloadCriticalResources(),this.emit("performance:lcp_optimization_applied")),this._coreWebVitals.fid&&this._coreWebVitals.fid>this._thresholds.coreWebVitals.fid&&(this.throttleCpu(!0),this.emit("performance:fid_optimization_applied")),this._coreWebVitals.cls&&this._coreWebVitals.cls>this._thresholds.coreWebVitals.cls&&(this.deferNonCriticalResources(),this.emit("performance:cls_optimization_applied"))},PerformanceOptimizer.prototype.getCoreWebVitalsReport=function(){return __assign({},this._coreWebVitals)},PerformanceOptimizer.prototype._initResourcePrioritization=function(){var _this=this;this._config.resourcePrioritization.criticalResources.forEach(function(resource){_this.prioritizeResource({resource:resource,priority:"critical",timing:"preload"})})},PerformanceOptimizer.prototype.prioritizeResource=function(resource){this._resourcePriorities.set(resource.resource,resource),"critical"===resource.priority&&this._criticalResources.add(resource.resource),"defer"!==resource.timing&&"lazy"!==resource.timing||this._preloadedResources.add(resource.resource),this.emit("performance:resource_prioritized",{resource:resource.resource,priority:resource.priority})},PerformanceOptimizer.prototype.preloadCriticalResources=function(){return __awaiter(this,void 0,void 0,function(){var preloadPromises,_a,_b,resource,priority,e_5,_c;return __generator(this,function(_d){switch(_d.label){case 0:if(!isBrowser())return[2];preloadPromises=[];try{for(_a=__values(this._criticalResources),_b=_a.next();!_b.done;_b=_a.next())resource=_b.value,"preload"===(null==(priority=this._resourcePriorities.get(resource))?void 0:priority.timing)&&preloadPromises.push(this._preloadResource(resource))}catch(e_5_1){e_5={error:e_5_1}}finally{try{_b&&!_b.done&&(_c=_a.return)&&_c.call(_a)}finally{if(e_5)throw e_5.error}}return[4,Promise.all(preloadPromises)];case 1:return _d.sent(),this.emit("performance:critical_resources_preloaded",{count:preloadPromises.length}),[2]}})})},PerformanceOptimizer.prototype._preloadResource=function(resource){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,new Promise(function(resolve){var link=document.createElement("link");link.rel="preload",link.href=resource,link.onload=function(){return resolve()},link.onerror=function(){return resolve()},document.head.appendChild(link)})]})})},PerformanceOptimizer.prototype.deferNonCriticalResources=function(){var _this=this;isBrowser()&&(this._preloadedResources.forEach(function(resource){var priority=_this._resourcePriorities.get(resource);(null==priority?void 0:priority.condition)&&!priority.condition()||_this._loadDeferredResource(resource)}),this.emit("performance:non_critical_resources_deferred"))},PerformanceOptimizer.prototype._loadDeferredResource=function(resource){var _this=this;requestIdleCallback(function(){_this.emit("performance:deferred_resource_loaded",{resource:resource})})},PerformanceOptimizer.prototype._initCrossPlatform=function(){this._config.crossPlatform.universalPolyfills&&this.enableUniversalPolyfills()},PerformanceOptimizer.prototype.optimizeForPlatform=function(platform,framework){this._currentPlatform=platform,this._currentFramework=framework||void 0;var optimization={platform:platform,framework:framework||"unknown",optimizations:this._config.crossPlatform.frameworkOptimizations[platform]||{},polyfills:[],fallbacks:[]};this._platformOptimizations.set(platform,optimization),this.emit("performance:platform_optimized",{platform:platform,framework:framework})},PerformanceOptimizer.prototype.enableUniversalPolyfills=function(){var _this=this;isBrowser()&&(["requestIdleCallback","IntersectionObserver","PerformanceObserver","ResizeObserver"].forEach(function(polyfill){polyfill in window||_this._addPolyfill(polyfill)}),this.emit("performance:universal_polyfills_enabled"))},PerformanceOptimizer.prototype._addPolyfill=function(name){"requestIdleCallback"===name&&("requestIdleCallback"in window||(window.requestIdleCallback=function(callback){return setTimeout(callback,0)}))},PerformanceOptimizer.prototype._detectPlatform=function(){if(isBrowser()){var userAgent=navigator.userAgent.toLowerCase();userAgent.includes("react")?this._currentPlatform="react":userAgent.includes("vue")?this._currentPlatform="vue":userAgent.includes("angular")?this._currentPlatform="angular":this._currentPlatform="vanilla",this.optimizeForPlatform(this._currentPlatform)}else this._currentPlatform="server"},PerformanceOptimizer.prototype._measureInitialMetrics=function(){var _this=this;if(isBrowser()){var startTime=now();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){_this._metrics.domReady=now()-startTime}):this._metrics.domReady=0,"complete"!==document.readyState&&window.addEventListener("load",function(){_this._metrics.loadTime=now()-startTime}),"performance"in window&&performance.getEntriesByType&&performance.getEntriesByType("paint").forEach(function(entry){"first-paint"===entry.name?_this._metrics.firstPaint=entry.startTime:"first-contentful-paint"===entry.name&&(_this._metrics.firstContentfulPaint=entry.startTime)})}},PerformanceOptimizer.prototype.startMonitoring=function(){var _this=this;this._isMonitoring||(this._isMonitoring=!0,this._monitoringInterval=window.setInterval(function(){_this._collectMetrics()},5e3),this.emit("performance:monitoring_started"))},PerformanceOptimizer.prototype.stopMonitoring=function(){this._isMonitoring&&(this._isMonitoring=!1,this._monitoringInterval&&(clearInterval(this._monitoringInterval),this._monitoringInterval=void 0),this.emit("performance:monitoring_stopped"))},PerformanceOptimizer.prototype._collectMetrics=function(){var memorySnapshot=this.getMemoryUsage();this._metrics.memoryUsage&&(this._metrics.memoryUsage.used=memorySnapshot.heapUsed,this._metrics.memoryUsage.total=memorySnapshot.heapTotal);var cpuProfile=this.getCpuUsage();this._metrics.cpuUsage=cpuProfile.usage,this.emit("performance:metrics_updated",this._metrics)},PerformanceOptimizer.prototype.getMetrics=function(){return __assign({},this._metrics)},PerformanceOptimizer.prototype.getThresholds=function(){return __assign({},this._thresholds)},PerformanceOptimizer.prototype.setThresholds=function(thresholds){this._thresholds=__assign(__assign({},this._thresholds),thresholds),this.emit("performance:thresholds_updated",this._thresholds)},PerformanceOptimizer.prototype.getOptimizationReport=function(){var violations=this._detectViolations(),recommendations=this._generateRecommendations(),score=this._calculatePerformanceScore(),grade=this._getPerformanceGrade(score);return{timestamp:now(),metrics:this._metrics,thresholds:this._thresholds,violations:violations,optimizations:recommendations,score:score,grade:grade}},PerformanceOptimizer.prototype._detectViolations=function(){var violations=[];return this._metrics.memoryUsage&&this._metrics.memoryUsage.used>1024*this._thresholds.memory.critical*1024&&violations.push({type:"memory",severity:"critical",message:"Memory usage exceeds critical threshold",value:this._metrics.memoryUsage.used,threshold:1024*this._thresholds.memory.critical*1024,timestamp:now()}),this._metrics.cpuUsage&&this._metrics.cpuUsage>this._thresholds.cpu.critical&&violations.push({type:"cpu",severity:"critical",message:"CPU usage exceeds critical threshold",value:this._metrics.cpuUsage,threshold:this._thresholds.cpu.critical,timestamp:now()}),this._coreWebVitals.lcp&&this._coreWebVitals.lcp>this._thresholds.coreWebVitals.lcp&&violations.push({type:"core-web-vitals",severity:"high",message:"Largest Contentful Paint exceeds threshold",value:this._coreWebVitals.lcp,threshold:this._thresholds.coreWebVitals.lcp,timestamp:now()}),violations},PerformanceOptimizer.prototype._generateRecommendations=function(){var _this=this,recommendations=[];return this._detectedLeaks.length>0&&recommendations.push({type:"memory",priority:"high",message:"Memory leaks detected - enable garbage collection",impact:"high",effort:"low",action:function(){return _this.forceGarbageCollection()}}),this._loadedModules.size<this._lazyModules.size/2&&recommendations.push({type:"lazy-loading",priority:"medium",message:"Enable lazy loading for better performance",impact:"medium",effort:"low",action:function(){return _this.preloadModules(Array.from(_this._lazyModules.keys()))}}),recommendations},PerformanceOptimizer.prototype._calculatePerformanceScore=function(){var score=100;return this._detectViolations().forEach(function(violation){switch(violation.severity){case"critical":score-=20;break;case"high":score-=15;break;case"medium":score-=10;break;case"low":score-=5}}),this._coreWebVitals.lcp&&this._coreWebVitals.lcp>4e3&&(score-=10),this._coreWebVitals.fid&&this._coreWebVitals.fid>300&&(score-=10),this._coreWebVitals.cls&&this._coreWebVitals.cls>.25&&(score-=10),Math.max(0,score)},PerformanceOptimizer.prototype._getPerformanceGrade=function(score){return score>=90?"A":score>=80?"B":score>=70?"C":score>=60?"D":"F"},PerformanceOptimizer}(EventEmitter),TechnologyDetector=function(){function TechnologyDetector(){this.name="TechnologyDetector",this._isEnabled=!1,this._detectionCache=new Map,this._signatures=[],this._initializeSignatures()}return TechnologyDetector.prototype.init=function(){isBrowser()&&(this._isEnabled=!0,this._performDetection())},TechnologyDetector.prototype.enable=function(){this._isEnabled=!0},TechnologyDetector.prototype.disable=function(){this._isEnabled=!1},TechnologyDetector.prototype.destroy=function(){this._isEnabled=!1,this._detectionCache.clear()},TechnologyDetector.prototype.getCurrentTechStack=function(){return this._detectionCache.get(window.location.hostname)||this._performDetection()},TechnologyDetector.prototype.redetect=function(){return this._detectionCache.delete(window.location.hostname),this._performDetection()},TechnologyDetector.prototype._performDetection=function(){var e_1,_a,_b,_c,_d,_e;if(!isBrowser()||!this._isEnabled)return{};var detected={analytics:[],libraries:[]};try{for(var _f=__values(this._signatures),_g=_f.next();!_g.done;_g=_f.next()){var signature=_g.value;if(this._checkSignature(signature)>.5)switch(signature.category){case"cms":detected.cms=signature.name;break;case"framework":detected.framework=signature.name;break;case"analytics":(null===(_b=detected.analytics)||void 0===_b?void 0:_b.includes(signature.name))||null===(_c=detected.analytics)||void 0===_c||_c.push(signature.name);break;case"library":(null===(_d=detected.libraries)||void 0===_d?void 0:_d.includes(signature.name))||null===(_e=detected.libraries)||void 0===_e||_e.push(signature.name);break;case"server":detected.server=signature.name;break;case"hosting":detected.hosting=signature.name}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_g&&!_g.done&&(_a=_f.return)&&_a.call(_f)}finally{if(e_1)throw e_1.error}}return this._detectionCache.set(window.location.hostname,detected),detected},TechnologyDetector.prototype._checkSignature=function(signature){var e_2,_a,e_3,_b,e_4,_c,e_5,_d,e_6,_e,e_7,_f,confidence=0,totalChecks=0,passedChecks=0;if(signature.checks.dom){totalChecks+=signature.checks.dom.length;try{for(var _g=__values(signature.checks.dom),_h=_g.next();!_h.done;_h=_g.next()){var selector=_h.value;document.querySelector(selector)&&passedChecks++}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_h&&!_h.done&&(_a=_g.return)&&_a.call(_g)}finally{if(e_2)throw e_2.error}}}if(signature.checks.js){totalChecks+=signature.checks.js.length;try{for(var _j=__values(signature.checks.js),_k=_j.next();!_k.done;_k=_j.next()){var jsPath=_k.value;this._checkJavaScriptObject(jsPath)&&passedChecks++}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_k&&!_k.done&&(_b=_j.return)&&_b.call(_j)}finally{if(e_3)throw e_3.error}}}if(signature.checks.meta){totalChecks+=signature.checks.meta.length;try{for(var _l=__values(signature.checks.meta),_m=_l.next();!_m.done;_m=_l.next()){var metaPattern=_m.value;this._checkMetaTag(metaPattern)&&passedChecks++}}catch(e_4_1){e_4={error:e_4_1}}finally{try{_m&&!_m.done&&(_c=_l.return)&&_c.call(_l)}finally{if(e_4)throw e_4.error}}}if(signature.checks.text){totalChecks+=signature.checks.text.length;try{for(var _o=__values(signature.checks.text),_p=_o.next();!_p.done;_p=_o.next()){var textPattern=_p.value;document.documentElement.outerHTML.includes(textPattern)&&passedChecks++}}catch(e_5_1){e_5={error:e_5_1}}finally{try{_p&&!_p.done&&(_d=_o.return)&&_d.call(_o)}finally{if(e_5)throw e_5.error}}}if(signature.checks.url){totalChecks+=signature.checks.url.length;try{for(var _q=__values(signature.checks.url),_r=_q.next();!_r.done;_r=_q.next()){var urlPattern=_r.value;this._checkUrlPattern(urlPattern)&&passedChecks++}}catch(e_6_1){e_6={error:e_6_1}}finally{try{_r&&!_r.done&&(_e=_q.return)&&_e.call(_q)}finally{if(e_6)throw e_6.error}}}if(signature.checks.cookies){totalChecks+=signature.checks.cookies.length;try{for(var _s=__values(signature.checks.cookies),_t=_s.next();!_t.done;_t=_s.next()){var cookiePattern=_t.value;this._checkCookie(cookiePattern)&&passedChecks++}}catch(e_7_1){e_7={error:e_7_1}}finally{try{_t&&!_t.done&&(_f=_s.return)&&_f.call(_s)}finally{if(e_7)throw e_7.error}}}return totalChecks>0&&(confidence=passedChecks/totalChecks*signature.confidence),confidence},TechnologyDetector.prototype._checkJavaScriptObject=function(path){var e_8,_a;try{var parts=path.split("."),current=window;try{for(var parts_1=__values(parts),parts_1_1=parts_1.next();!parts_1_1.done;parts_1_1=parts_1.next()){var part=parts_1_1.value;if(!current||"object"!=typeof current||!(part in current))return!1;current=current[part]}}catch(e_8_1){e_8={error:e_8_1}}finally{try{parts_1_1&&!parts_1_1.done&&(_a=parts_1.return)&&_a.call(parts_1)}finally{if(e_8)throw e_8.error}}return void 0!==current}catch(_b){return!1}},TechnologyDetector.prototype._checkMetaTag=function(pattern){var e_9,_a,metaTags=Array.from(document.querySelectorAll("meta"));try{for(var metaTags_1=__values(metaTags),metaTags_1_1=metaTags_1.next();!metaTags_1_1.done;metaTags_1_1=metaTags_1.next()){var meta=metaTags_1_1.value,name_1=meta.getAttribute("name")||meta.getAttribute("property")||"",content=meta.getAttribute("content")||"";if(name_1.includes(pattern)||content.includes(pattern))return!0}}catch(e_9_1){e_9={error:e_9_1}}finally{try{metaTags_1_1&&!metaTags_1_1.done&&(_a=metaTags_1.return)&&_a.call(metaTags_1)}finally{if(e_9)throw e_9.error}}return!1},TechnologyDetector.prototype._checkUrlPattern=function(pattern){var e_10,_a,e_11,_b,scripts=Array.from(document.querySelectorAll("script[src]"));try{for(var scripts_1=__values(scripts),scripts_1_1=scripts_1.next();!scripts_1_1.done;scripts_1_1=scripts_1.next())if((scripts_1_1.value.getAttribute("src")||"").includes(pattern))return!0}catch(e_10_1){e_10={error:e_10_1}}finally{try{scripts_1_1&&!scripts_1_1.done&&(_a=scripts_1.return)&&_a.call(scripts_1)}finally{if(e_10)throw e_10.error}}var links=Array.from(document.querySelectorAll("link[href]"));try{for(var links_1=__values(links),links_1_1=links_1.next();!links_1_1.done;links_1_1=links_1.next())if((links_1_1.value.getAttribute("href")||"").includes(pattern))return!0}catch(e_11_1){e_11={error:e_11_1}}finally{try{links_1_1&&!links_1_1.done&&(_b=links_1.return)&&_b.call(links_1)}finally{if(e_11)throw e_11.error}}return!1},TechnologyDetector.prototype._checkCookie=function(pattern){return document.cookie.includes(pattern)},TechnologyDetector.prototype._initializeSignatures=function(){this._signatures=[{name:"WordPress",category:"cms",confidence:1,checks:{meta:["generator"],text:["wp-content","wp-includes"],js:["wp"]}},{name:"Shopify",category:"cms",confidence:1,checks:{js:["Shopify"],text:["shopify"],meta:["shopify"]}},{name:"Drupal",category:"cms",confidence:1,checks:{meta:["generator"],text:["/sites/default/","Drupal.settings"],js:["Drupal"]}},{name:"Squarespace",category:"cms",confidence:1,checks:{text:["squarespace"],url:["squarespace"]}},{name:"Webflow",category:"cms",confidence:1,checks:{text:["webflow"],url:["webflow"]}},{name:"React",category:"framework",confidence:.9,checks:{js:["React","ReactDOM"],text:["react","data-reactroot"]}},{name:"Vue.js",category:"framework",confidence:.9,checks:{js:["Vue"],text:["vue"]}},{name:"Angular",category:"framework",confidence:.9,checks:{js:["ng","angular"],text:["ng-app","ng-controller"]}},{name:"Next.js",category:"framework",confidence:1,checks:{js:["__NEXT_DATA__"],text:["_next/static"]}},{name:"Nuxt.js",category:"framework",confidence:1,checks:{js:["__NUXT__"],text:["_nuxt/"]}},{name:"Svelte",category:"framework",confidence:.9,checks:{text:["svelte"]}},{name:"Google Analytics",category:"analytics",confidence:1,checks:{js:["gtag","ga","GoogleAnalyticsObject"],url:["google-analytics.com","googletagmanager.com"]}},{name:"Google Tag Manager",category:"analytics",confidence:1,checks:{js:["dataLayer"],url:["googletagmanager.com"]}},{name:"Mixpanel",category:"analytics",confidence:1,checks:{js:["mixpanel"],url:["mixpanel.com"]}},{name:"Amplitude",category:"analytics",confidence:1,checks:{js:["amplitude"],url:["amplitude.com"]}},{name:"Segment",category:"analytics",confidence:1,checks:{js:["analytics"],url:["segment.com","segment.io"]}},{name:"Adobe Analytics",category:"analytics",confidence:1,checks:{js:["s_account","_satellite"],url:["omtrdc.net","demdex.net"]}},{name:"Hotjar",category:"analytics",confidence:1,checks:{js:["hj"],url:["hotjar.com"]}},{name:"Facebook Pixel",category:"analytics",confidence:1,checks:{js:["fbq"],url:["facebook.net"]}},{name:"jQuery",category:"library",confidence:1,checks:{js:["jQuery","$"]}},{name:"Lodash",category:"library",confidence:1,checks:{js:["_"]}},{name:"D3.js",category:"library",confidence:1,checks:{js:["d3"]}},{name:"Chart.js",category:"library",confidence:1,checks:{js:["Chart"]}},{name:"Bootstrap",category:"library",confidence:.8,checks:{dom:[".container",".row",".col"],text:["bootstrap"]}},{name:"Tailwind CSS",category:"library",confidence:.8,checks:{dom:['[class*="tw-"]','[class*="bg-"]','[class*="text-"]'],text:["tailwind"]}},{name:"WooCommerce",category:"ecommerce",confidence:1,checks:{text:["woocommerce","wc-"],dom:[".woocommerce"]}},{name:"Magento",category:"ecommerce",confidence:1,checks:{text:["magento","Mage."],js:["Mage"]}},{name:"Cloudflare",category:"hosting",confidence:.7,checks:{text:["cloudflare"],url:["cloudflare"]}},{name:"AWS CloudFront",category:"hosting",confidence:.7,checks:{url:["cloudfront.net"]}},{name:"Netlify",category:"hosting",confidence:1,checks:{text:["netlify"],url:["netlify"]}},{name:"Vercel",category:"hosting",confidence:1,checks:{text:["vercel"],url:["vercel"]}}]},TechnologyDetector}(),WebSocketManager=function(_super){function WebSocketManager(config){void 0===config&&(config={});var _this=_super.call(this)||this;return _this.name="WebSocketManager",_this._socket=null,_this._messageQueue=[],_this._fallbackTransport=null,_this._heartbeatInterval=null,_this._heartbeatTimeout=null,_this._reconnectTimeout=null,_this._queueProcessorInterval=null,_this._heartbeatsMissed=0,_this._destroyed=!1,_this._pendingPings=new Map,_this._config={url:config.url||"",protocols:config.protocols||[],reconnect:!1!==config.reconnect,reconnectInterval:config.reconnectInterval||5e3,maxReconnectAttempts:config.maxReconnectAttempts||10,heartbeatInterval:config.heartbeatInterval||3e4,messageQueueSize:config.messageQueueSize||1e3,enableCompression:!1!==config.enableCompression,enableFallback:!1!==config.enableFallback,fallbackUrl:config.fallbackUrl||"",timeout:config.timeout||1e4,debug:config.debug||!1},_this._connectionState={status:"disconnected",url:_this._config.url,reconnectAttempts:0},_this._metrics={messagesSet:0,messagesReceived:0,reconnections:0,errors:0,averageLatency:0,uptime:0,lastActivity:0},_this._heartbeatConfig={interval:_this._config.heartbeatInterval,timeout:5e3,maxMissed:3,enabled:!0},_this._config.enableFallback&&_this._config.fallbackUrl&&(_this._fallbackTransport={type:"http",url:_this._config.fallbackUrl,enabled:!0,retryInterval:1e4}),_this}return __extends(WebSocketManager,_super),WebSocketManager.prototype.init=function(){isBrowser()?(this._startQueueProcessor(),this._config.debug&&console.log("[WebSocketManager] Initialized with config:",this._config)):this._config.debug&&console.warn("[WebSocketManager] Not in browser environment")},WebSocketManager.prototype.setSessionContext=function(sessionId,visitorId){this._sessionId=sessionId,this._visitorId=visitorId},WebSocketManager.prototype.connect=function(url){return __awaiter(this,void 0,void 0,function(){var connectUrl,_a,_this=this;return __generator(this,function(_b){if(this._destroyed)throw new Error("WebSocketManager has been destroyed");if(!(connectUrl=url||this._config.url))throw new Error("WebSocket URL is required");return(null===(_a=this._socket)||void 0===_a?void 0:_a.readyState)===WebSocket.OPEN&&this._connectionState.url===connectUrl?[2]:(this._socket&&this._cleanupConnection(),[2,new Promise(function(resolve,reject){try{_this._connectionState=__assign(__assign({},_this._connectionState),{status:"connecting",url:connectUrl}),delete _this._connectionState.lastError,_this._socket=new WebSocket(connectUrl,_this._config.protocols),_this._socket.binaryType="arraybuffer",_this._socket.onopen=function(event){_this._onOpen(event),resolve()},_this._socket.onclose=function(event){_this._onClose(event)},_this._socket.onerror=function(event){_this._onError(event),reject(new Error("WebSocket connection failed"))},_this._socket.onmessage=function(event){_this._onMessage(event)},setTimeout(function(){var _a;(null===(_a=_this._socket)||void 0===_a?void 0:_a.readyState)===WebSocket.CONNECTING&&(_this._socket.close(),reject(new Error("WebSocket connection timeout")))},_this._config.timeout)}catch(error){_this._connectionState.status="error",_this._connectionState.lastError=error,reject(error)}})])})})},WebSocketManager.prototype.disconnect=function(){this._socket&&this._socket.close(1e3,"Normal closure"),this._cleanupConnection(),this._connectionState.status="disconnected"},WebSocketManager.prototype.reconnect=function(){return __awaiter(this,void 0,void 0,function(){var error_1;return __generator(this,function(_a){switch(_a.label){case 0:if(this._connectionState.reconnectAttempts>=this._config.maxReconnectAttempts){if(this._config.debug&&console.warn("[WebSocketManager] Max reconnect attempts reached"),this._config.enableFallback&&this._fallbackTransport)return this._activateFallback("Max reconnection attempts reached"),[2];throw new Error("Max reconnection attempts reached")}this._connectionState.status="reconnecting",this._connectionState.reconnectAttempts++,this._metrics.reconnections++,this.emit("connection:reconnecting",this._connectionState),_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this.connect()];case 2:return _a.sent(),this._connectionState.reconnectAttempts=0,this.emit("connection:reconnected",this._connectionState),[3,4];case 3:throw error_1=_a.sent(),this._config.debug&&console.error("[WebSocketManager] Reconnection failed:",error_1),this._scheduleReconnection(),error_1;case 4:return[2]}})})},WebSocketManager.prototype.send=function(message){return __awaiter(this,void 0,void 0,function(){var fullMessage;return __generator(this,function(_a){if(fullMessage=__assign(__assign({},message),{id:generateId$1(),timestamp:now$1(),sessionId:this._sessionId||"unknown",visitorId:this._visitorId||"unknown"}),!this.isConnected)return this._queueMessage(fullMessage),[2,!1];try{return this._socket.send(JSON.stringify(fullMessage)),this._metrics.messagesSet++,this._metrics.lastActivity=now$1(),this.emit("message:sent",fullMessage),[2,!0]}catch(error){return this._config.debug&&console.error("[WebSocketManager] Send failed:",error),this._queueMessage(fullMessage),this.emit("message:failed",{message:fullMessage,error:error}),[2,!1]}return[2]})})},WebSocketManager.prototype.sendEvent=function(event_1,data_1){return __awaiter(this,arguments,void 0,function(event,data,priority){return void 0===priority&&(priority="normal"),__generator(this,function(_a){return[2,this.send({type:"event",data:__assign({event:event},data),priority:priority,retry:"low"!==priority})]})})},WebSocketManager.prototype.sendHeartbeat=function(){if(this.isConnected){var pingId=generateId$1(),timestamp=now$1();this._pendingPings.set(pingId,timestamp),this.send({type:"heartbeat",data:{pingId:pingId,timestamp:timestamp},priority:"critical",retry:!1}),this._heartbeatsMissed=0,this.emit("heartbeat:sent",{timestamp:timestamp})}},WebSocketManager.prototype.getConnectionState=function(){return __assign({},this._connectionState)},WebSocketManager.prototype.getMetrics=function(){var uptime=this._connectionState.connectedAt?now$1()-this._connectionState.connectedAt:0;return __assign(__assign({},this._metrics),{uptime:uptime})},WebSocketManager.prototype.clearQueue=function(){this._messageQueue=[]},Object.defineProperty(WebSocketManager.prototype,"isConnected",{get:function(){var _a;return(null===(_a=this._socket)||void 0===_a?void 0:_a.readyState)===WebSocket.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(WebSocketManager.prototype,"connectionState",{get:function(){return this._connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(WebSocketManager.prototype,"metrics",{get:function(){return this.getMetrics()},enumerable:!1,configurable:!0}),Object.defineProperty(WebSocketManager.prototype,"queueSize",{get:function(){return this._messageQueue.length},enumerable:!1,configurable:!0}),WebSocketManager.prototype.destroy=function(){this._destroyed=!0,this.disconnect(),this._clearTimers(),this.clearQueue(),this.removeAllListeners(),this._config.debug&&console.log("[WebSocketManager] Destroyed")},WebSocketManager.prototype._onOpen=function(_event){this._connectionState=__assign(__assign({},this._connectionState),{status:"connected",connectedAt:now$1()}),delete this._connectionState.disconnectedAt,delete this._connectionState.lastError,this._heartbeatConfig.enabled&&this._startHeartbeat(),this._processQueue(),this.emit("connection:open",this._connectionState),this._config.debug&&console.log("[WebSocketManager] Connected to:",this._connectionState.url)},WebSocketManager.prototype._onClose=function(event){var wasConnected="connected"===this._connectionState.status;this._connectionState=__assign(__assign({},this._connectionState),{status:"disconnected",disconnectedAt:now$1()}),this._cleanupConnection(),this.emit("connection:close",this._connectionState),this._config.debug&&console.log("[WebSocketManager] Disconnected:",event.code,event.reason),this._config.reconnect&&wasConnected&&!this._destroyed&&this._scheduleReconnection()},WebSocketManager.prototype._onError=function(event){var error=new Error(event.message||"WebSocket error");this._connectionState.lastError=error,this._connectionState.status="error",this._metrics.errors++,this.emit("connection:error",{error:error,state:this._connectionState}),this._config.debug&&console.error("[WebSocketManager] Error:",error)},WebSocketManager.prototype._onMessage=function(event){var _a;try{var message=JSON.parse(event.data);if(this._metrics.messagesReceived++,this._metrics.lastActivity=now$1(),"heartbeat"===message.type&&(null===(_a=message.data)||void 0===_a?void 0:_a.pingId))return void this._handleHeartbeatResponse(message);if("ack"===message.type)return void this._handleAcknowledgment(message);this.emit("message:received",message),this._config.debug&&console.log("[WebSocketManager] Message received:",message)}catch(error){this._config.debug&&console.error("[WebSocketManager] Failed to parse message:",error)}},WebSocketManager.prototype._handleHeartbeatResponse=function(message){var _a=message.data,pingId=_a.pingId,timestamp=_a.timestamp;if(this._pendingPings.has(pingId)){var sendTime=this._pendingPings.get(pingId),latency=now$1()-sendTime;this._connectionState.latency=latency,this._metrics.averageLatency=(this._metrics.averageLatency+latency)/2,this._pendingPings.delete(pingId),this._heartbeatsMissed=0,this.emit("heartbeat:received",{timestamp:timestamp,latency:latency})}},WebSocketManager.prototype._handleAcknowledgment=function(message){var _a,messageId=null===(_a=message.data)||void 0===_a?void 0:_a.messageId;messageId&&(this._messageQueue=this._messageQueue.filter(function(msg){return msg.id!==messageId}))},WebSocketManager.prototype._queueMessage=function(message){if(this._messageQueue.length>=this._config.messageQueueSize){var dropped=this._messageQueue.shift();this.emit("queue:full",{size:this._messageQueue.length,dropped:dropped})}var queuedMessage=__assign(__assign({},message),{attempts:0,nextRetry:now$1(),maxRetries:"critical"===message.priority?5:3});this._messageQueue.push(queuedMessage),this.emit("message:queued",message)},WebSocketManager.prototype._processQueue=function(){var e_1,_a;if(this.isConnected&&0!==this._messageQueue.length){var messagesToSend=this._messageQueue.filter(function(msg){return msg.nextRetry<=now$1()&&msg.attempts<msg.maxRetries}),_loop_1=function(message){try{this_1._socket.send(JSON.stringify(message)),this_1._messageQueue=this_1._messageQueue.filter(function(msg){return msg.id!==message.id}),this_1._metrics.messagesSet++,this_1.emit("message:sent",message)}catch(error){message.attempts++,message.nextRetry=now$1()+1e3*message.attempts,message.attempts>=message.maxRetries&&(this_1._messageQueue=this_1._messageQueue.filter(function(msg){return msg.id!==message.id}),this_1.emit("message:failed",{message:message,error:error}))}},this_1=this;try{for(var messagesToSend_1=__values(messagesToSend),messagesToSend_1_1=messagesToSend_1.next();!messagesToSend_1_1.done;messagesToSend_1_1=messagesToSend_1.next())_loop_1(messagesToSend_1_1.value)}catch(e_1_1){e_1={error:e_1_1}}finally{try{messagesToSend_1_1&&!messagesToSend_1_1.done&&(_a=messagesToSend_1.return)&&_a.call(messagesToSend_1)}finally{if(e_1)throw e_1.error}}}},WebSocketManager.prototype._startQueueProcessor=function(){var _this=this;this._queueProcessorInterval&&clearInterval(this._queueProcessorInterval),this._queueProcessorInterval=window.setInterval(function(){_this._processQueue()},1e3)},WebSocketManager.prototype._startHeartbeat=function(){var _this=this;this._heartbeatInterval&&clearInterval(this._heartbeatInterval),this._heartbeatInterval=window.setInterval(function(){_this.isConnected&&(_this.sendHeartbeat(),_this._heartbeatTimeout=window.setTimeout(function(){_this._heartbeatsMissed++,_this._heartbeatsMissed>=_this._heartbeatConfig.maxMissed&&(_this._config.debug&&console.warn("[WebSocketManager] Too many missed heartbeats, reconnecting"),_this.reconnect().catch(function(){}))},_this._heartbeatConfig.timeout))},this._heartbeatConfig.interval)},WebSocketManager.prototype._scheduleReconnection=function(){var _this=this;this._reconnectTimeout&&clearTimeout(this._reconnectTimeout);var delay=this._config.reconnectInterval*Math.pow(1.5,this._connectionState.reconnectAttempts);this._reconnectTimeout=window.setTimeout(function(){_this._destroyed||"connected"===_this._connectionState.status||_this.reconnect().catch(function(){})},delay)},WebSocketManager.prototype._activateFallback=function(reason){this._fallbackTransport&&(this.emit("fallback:activated",{reason:reason,url:this._fallbackTransport.url}),this._config.debug&&console.log("[WebSocketManager] Fallback activated:",reason))},WebSocketManager.prototype._cleanupConnection=function(){this._clearTimers(),this._pendingPings.clear(),this._heartbeatsMissed=0},WebSocketManager.prototype._clearTimers=function(){this._heartbeatInterval&&(clearInterval(this._heartbeatInterval),this._heartbeatInterval=null),this._heartbeatTimeout&&(clearTimeout(this._heartbeatTimeout),this._heartbeatTimeout=null),this._reconnectTimeout&&(clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null),this._queueProcessorInterval&&(clearInterval(this._queueProcessorInterval),this._queueProcessorInterval=null)},WebSocketManager}(EventEmitter),SessionManager=function(){function SessionManager(storage,options){void 0===options&&(options={}),this._currentSession=null,this._fingerprint=null,this._listeners=new Map,this._destroyed=!1,this.SESSION_KEY="session",this.VISITOR_KEY="visitor",this.FINGERPRINT_KEY="fingerprint",this.TABS_KEY="active_tabs",this.HEARTBEAT_KEY="heartbeat",this._storage=storage,this._options=__assign({sessionTimeout:18e5,enableCrossTabs:!0,enableFingerprinting:!0,fingerprintElements:{screen:!0,timezone:!0,language:!0,platform:!0,plugins:!0,canvas:!1},sessionValidation:!0,storagePrefix:"opt_session_"},options),this._tabId=this._generateTabId(),this._options.enableFingerprinting&&this._generateFingerprint(),this._options.enableCrossTabs&&isBrowser()&&(this._setupCrossTabSync(),this._startHeartbeat())}return SessionManager.prototype.initializeSession=function(){return __awaiter(this,void 0,void 0,function(){var restored,newSession,error_1,fallback;return __generator(this,function(_a){switch(_a.label){case 0:return _a.trys.push([0,3,,4]),[4,this._restoreSession()];case 1:return(restored=_a.sent())?(this._currentSession=restored,this._emit("session:restored",restored),[2,restored]):[4,this._createNewSession()];case 2:return newSession=_a.sent(),this._currentSession=newSession,this._saveSession(newSession),this._emit("session:created",newSession),[2,newSession];case 3:return error_1=_a.sent(),console.error("Session initialization failed:",error_1),fallback=this._createBasicSession(),this._currentSession=fallback,[2,fallback];case 4:return[2]}})})},SessionManager.prototype.getCurrentSession=function(){return this._currentSession},SessionManager.prototype.updateActivity=function(){this._currentSession&&(this._currentSession.lastActivity=now$1(),this._currentSession.pageViews++,this._saveSession(this._currentSession))},SessionManager.prototype.validateSession=function(){return __awaiter(this,void 0,void 0,function(){var reasons,isValid,currentFingerprint,storedFingerprint;return __generator(this,function(_a){switch(_a.label){case 0:return this._currentSession?(reasons=[],isValid=!0,now$1()-this._currentSession.lastActivity>this._options.sessionTimeout&&(isValid=!1,reasons.push("Session timeout exceeded")),this._options.enableFingerprinting&&this._options.sessionValidation?[4,this._generateFingerprint()]:[3,2]):[2,{isValid:!1,reasons:["No active session"],fingerprint:this._fingerprint,lastValidated:now$1()}];case 1:currentFingerprint=_a.sent(),(storedFingerprint=this._getStoredFingerprint())&&currentFingerprint.hash!==storedFingerprint.hash&&this._checkCriticalFingerprintMismatch(currentFingerprint,storedFingerprint)&&(isValid=!1,reasons.push("Session fingerprint validation failed")),_a.label=2;case 2:return[2,{isValid:isValid,reasons:reasons,fingerprint:this._fingerprint,lastValidated:now$1()}]}})})},SessionManager.prototype.invalidateSession=function(){this._currentSession&&(this._emit("session:invalid",this._currentSession),this._currentSession=null,this._storage.remove(this.SESSION_KEY))},SessionManager.prototype.getFingerprint=function(){return this._fingerprint},SessionManager.prototype.on=function(event,callback){this._listeners.has(event)||this._listeners.set(event,[]),this._listeners.get(event).push(callback)},SessionManager.prototype.off=function(event,callback){var listeners=this._listeners.get(event);if(listeners){var index=listeners.indexOf(callback);index>-1&&listeners.splice(index,1)}},SessionManager.prototype.destroy=function(){if(!this._destroyed){this._syncTimer&&clearInterval(this._syncTimer),this._heartbeatTimer&&clearInterval(this._heartbeatTimer);try{this._removeFromActiveTabs()}catch(error){}this._listeners.clear(),this._destroyed=!0}},SessionManager.prototype._restoreSession=function(){return __awaiter(this,void 0,void 0,function(){var sessionData,session;return __generator(this,function(_a){switch(_a.label){case 0:return _a.trys.push([0,2,,3]),(sessionData=this._storage.get(this.SESSION_KEY))&&(session=safeJsonParse(sessionData,null))?[4,this._validateStoredSession(session)]:[2,null];case 1:return _a.sent().isValid?[2,session]:(this._storage.remove(this.SESSION_KEY),[2,null]);case 2:return _a.sent(),[2,null];case 3:return[2]}})})},SessionManager.prototype._createNewSession=function(){return __awaiter(this,void 0,void 0,function(){var visitorId,session;return __generator(this,function(_a){try{visitorId=this._storage.get(this.VISITOR_KEY)||generateVisitorId(),this._storage.set(this.VISITOR_KEY,visitorId)}catch(error){visitorId=generateVisitorId()}session={sessionId:generateSessionId(),visitorId:visitorId,startTime:now$1(),lastActivity:now$1(),pageViews:0,platform:detectPlatform(),userAgent:getUserAgent(),referrer:getReferrer(),landingPage:getCurrentUrl()};try{this._addToActiveTabs()}catch(error){}return[2,session]})})},SessionManager.prototype._createBasicSession=function(){return{sessionId:generateSessionId(),visitorId:generateVisitorId(),startTime:now$1(),lastActivity:now$1(),pageViews:0,platform:detectPlatform(),userAgent:getUserAgent(),referrer:getReferrer(),landingPage:getCurrentUrl()}},SessionManager.prototype._saveSession=function(session){try{this._storage.set(this.SESSION_KEY,safeJsonStringify(session))}catch(error){this._options.debug&&console.warn("Failed to save session:",error)}},SessionManager.prototype._generateFingerprint=function(){return __awaiter(this,void 0,void 0,function(){var elements,fingerprint,_a,hashString;return __generator(this,function(_b){switch(_b.label){case 0:return isBrowser()?(elements=this._options.fingerprintElements,fingerprint={},elements.screen&&(fingerprint.screenResolution="".concat(screen.width,"x").concat(screen.height)),elements.timezone&&(fingerprint.timezone=(new Date).getTimezoneOffset()),elements.language&&(fingerprint.language=navigator.language||"unknown"),elements.platform&&(fingerprint.platform=detectPlatform(),fingerprint.browser=detectBrowser()),elements.plugins&&(fingerprint.pluginsHash=this._hashPlugins()),elements.canvas?(_a=fingerprint,[4,this._generateCanvasFingerprint()]):[3,2]):(this._fingerprint={screenResolution:"unknown",timezone:0,language:"unknown",platform:"server",browser:"unknown",pluginsHash:"unknown",hash:"server-side"},[2,this._fingerprint]);case 1:_a.canvasHash=_b.sent(),_b.label=2;case 2:return hashString=Object.values(fingerprint).join("|"),fingerprint.hash=this._simpleHash(hashString).toString(),this._fingerprint=fingerprint,this._storage.set(this.FINGERPRINT_KEY,safeJsonStringify(this._fingerprint)),[2,this._fingerprint]}})})},SessionManager.prototype._getStoredFingerprint=function(){var stored=this._storage.get(this.FINGERPRINT_KEY);return stored?safeJsonParse(stored,null):null},SessionManager.prototype._checkCriticalFingerprintMismatch=function(current,stored){return current.platform!==stored.platform||current.browser!==stored.browser||current.screenResolution!==stored.screenResolution},SessionManager.prototype._validateStoredSession=function(session){return __awaiter(this,void 0,void 0,function(){var timeSinceActivity,reasons,isValid;return __generator(this,function(_a){return timeSinceActivity=now$1()-session.lastActivity,reasons=[],isValid=!0,timeSinceActivity>this._options.sessionTimeout&&(isValid=!1,reasons.push("Session expired")),[2,{isValid:isValid,reasons:reasons,fingerprint:this._fingerprint,lastValidated:now$1()}]})})},SessionManager.prototype._setupCrossTabSync=function(){var _this=this;isBrowser()&&(window.addEventListener("storage",function(event){event.key===_this._getStorageKey(_this.SESSION_KEY)&&_this._handleSessionSync(event.newValue)}),this._syncTimer=window.setInterval(function(){_this._checkTabSync()},5e3))},SessionManager.prototype._startHeartbeat=function(){var _this=this;isBrowser()&&(this._heartbeatTimer=window.setInterval(function(){_this._updateHeartbeat(),_this._cleanupInactiveTabs()},1e4))},SessionManager.prototype._handleSessionSync=function(newSessionData){var _a;if(newSessionData){var session=safeJsonParse(newSessionData,null);session&&session.sessionId!==(null===(_a=this._currentSession)||void 0===_a?void 0:_a.sessionId)&&(this._currentSession=session,this._emit("session:synchronized",session))}},SessionManager.prototype._checkTabSync=function(){var activeTabs=this._getActiveTabs(),currentTime=now$1(),thisTab=activeTabs[this._tabId];(!thisTab||currentTime-thisTab.lastHeartbeat>3e4)&&this._addToActiveTabs()},SessionManager.prototype._updateHeartbeat=function(){var _a,heartbeat={tabId:this._tabId,timestamp:now$1(),sessionId:(null===(_a=this._currentSession)||void 0===_a?void 0:_a.sessionId)||"unknown"};this._storage.set(this.HEARTBEAT_KEY,safeJsonStringify(heartbeat))},SessionManager.prototype._getActiveTabs=function(){try{var stored=this._storage.get(this.TABS_KEY);return stored?safeJsonParse(stored,{}):{}}catch(error){return{}}},SessionManager.prototype._addToActiveTabs=function(){var _a;try{var activeTabs=this._getActiveTabs();activeTabs[this._tabId]={startTime:now$1(),lastHeartbeat:now$1(),sessionId:(null===(_a=this._currentSession)||void 0===_a?void 0:_a.sessionId)||"pending"},this._storage.set(this.TABS_KEY,safeJsonStringify(activeTabs))}catch(error){}},SessionManager.prototype._removeFromActiveTabs=function(){try{var activeTabs=this._getActiveTabs();delete activeTabs[this._tabId],this._storage.set(this.TABS_KEY,safeJsonStringify(activeTabs))}catch(error){}},SessionManager.prototype._cleanupInactiveTabs=function(){var e_1,_a,activeTabs=this._getActiveTabs(),currentTime=now$1(),hasChanges=!1;try{for(var _b=__values(Object.entries(activeTabs)),_c=_b.next();!_c.done;_c=_b.next()){var _d=__read(_c.value,2),tabId=_d[0];currentTime-_d[1].lastHeartbeat>6e4&&(delete activeTabs[tabId],hasChanges=!0)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}hasChanges&&this._storage.set(this.TABS_KEY,safeJsonStringify(activeTabs))},SessionManager.prototype._generateTabId=function(){return"tab_"+Math.random().toString(36).substr(2,9)+"_"+now$1()},SessionManager.prototype._getStorageKey=function(key){return this._options.storagePrefix+key},SessionManager.prototype._hashPlugins=function(){if(!isBrowser()||!navigator.plugins)return"unknown";var plugins=Array.from(navigator.plugins).map(function(plugin){return plugin.name}).sort().join("|");return this._simpleHash(plugins).toString()},SessionManager.prototype._generateCanvasFingerprint=function(){return __awaiter(this,void 0,void 0,function(){var canvas,ctx;return __generator(this,function(_a){if(!isBrowser())return[2,"unknown"];try{return canvas=document.createElement("canvas"),(ctx=canvas.getContext("2d"))?(ctx.textBaseline="top",ctx.font="14px Arial",ctx.fillText("Fingerprint test 🎨",2,2),[2,this._simpleHash(canvas.toDataURL()).toString()]):[2,"unknown"]}catch(_b){return[2,"canvas-blocked"]}return[2]})})},SessionManager.prototype._simpleHash=function(str){for(var hash=0,i=0;i<str.length;i++)hash=(hash<<5)-hash+str.charCodeAt(i),hash&=hash;return Math.abs(hash)},SessionManager.prototype._emit=function(type,session){var event={type:type,session:session,timestamp:now$1(),tabId:this._tabId};(this._listeners.get(type)||[]).forEach(function(callback){try{callback(event)}catch(error){console.error("Session event listener error:",error)}})},SessionManager}(),Storage$1=function(){function Storage(prefix){void 0===prefix&&(prefix="opt_"),this._fallback=new Map,this._prefix=prefix}return Storage.prototype.get=function(key){var prefixedKey=this._prefix+key;try{if(isBrowser()&&window.localStorage&&null!==(value=localStorage.getItem(prefixedKey))){if((parsed=safeJsonParse(value,null))&&this._isNotExpired(parsed.expiry))return parsed.value;parsed&&localStorage.removeItem(prefixedKey)}}catch(e){}try{var value,parsed;if(isBrowser()&&window.sessionStorage&&null!==(value=sessionStorage.getItem(prefixedKey))&&(parsed=safeJsonParse(value,null))&&this._isNotExpired(parsed.expiry))return parsed.value}catch(e){}try{if(isBrowser()){var cookieValue=this._getCookie(prefixedKey);if(cookieValue)return cookieValue}}catch(e){}return this._fallback.get(prefixedKey)||null},Storage.prototype.set=function(key,value,expiry){var _this=this,prefixedKey=this._prefix+key,storageValue=safeJsonStringify({value:value,expiry:expiry});try{if(isBrowser()&&window.localStorage)return void localStorage.setItem(prefixedKey,storageValue)}catch(e){}try{if(isBrowser()&&window.sessionStorage)return void sessionStorage.setItem(prefixedKey,storageValue)}catch(e){}try{if(isBrowser()&&value.length<4e3)return void this._setCookie(prefixedKey,value,expiry)}catch(e){}this._fallback.set(prefixedKey,value),this._fallback.size>100&&Array.from(this._fallback.entries()).slice(0,20).forEach(function(_a){var k=__read(_a,1)[0];return _this._fallback.delete(k)})},Storage.prototype.remove=function(key){var prefixedKey=this._prefix+key;try{isBrowser()&&window.localStorage&&localStorage.removeItem(prefixedKey)}catch(e){}try{isBrowser()&&window.sessionStorage&&sessionStorage.removeItem(prefixedKey)}catch(e){}try{isBrowser()&&this._deleteCookie(prefixedKey)}catch(e){}this._fallback.delete(prefixedKey)},Storage.prototype.clear=function(){var _this=this;this._getAllKeys().forEach(function(key){return _this.remove(key.replace(_this._prefix,""))}),this._fallback.clear()},Storage.prototype._isNotExpired=function(expiry){return!expiry||Date.now()<expiry},Storage.prototype._getAllKeys=function(){var _this=this,keys=[];try{if(isBrowser()&&window.localStorage)for(var i=0;i<localStorage.length;i++)(key=localStorage.key(i))&&key.startsWith(this._prefix)&&keys.push(key)}catch(e){}try{if(isBrowser()&&window.sessionStorage)for(i=0;i<sessionStorage.length;i++){var key;(key=sessionStorage.key(i))&&key.startsWith(this._prefix)&&keys.push(key)}}catch(e){}return this._fallback.forEach(function(_,key){key.startsWith(_this._prefix)&&keys.push(key)}),Array.from(new Set(keys))},Storage.prototype._getCookie=function(name){var _a;if(!isBrowser())return null;var parts="; ".concat(document.cookie).split("; ".concat(name,"="));if(2===parts.length){var cookieValue=null===(_a=parts.pop())||void 0===_a?void 0:_a.split(";").shift();return cookieValue?decodeURIComponent(cookieValue):null}return null},Storage.prototype._setCookie=function(name,value,expiry){if(isBrowser()){var cookieString="".concat(name,"=").concat(encodeURIComponent(value),"; path=/");if(expiry){var expiryDate=new Date(expiry);cookieString+="; expires=".concat(expiryDate.toUTCString())}"https:"===location.protocol&&(cookieString+="; secure"),cookieString+="; samesite=lax",document.cookie=cookieString}},Storage.prototype._deleteCookie=function(name){isBrowser()&&(document.cookie="".concat(name,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"))},Storage}(),Tracker=function(_super){function Tracker(){var _this=_super.call(this)||this;return _this.isInitialized=!1,_this._modules=new Map,_this._eventQueue=[],_this._destroyed=!1,_this._storage=new Storage$1,_this._sessionManager=new SessionManager(_this._storage),_this.config={apiUrl:"",projectId:"",debug:!1,enableGDPR:!0,sessionTimeout:18e5,batchSize:10,flushInterval:5e3,platform:"auto"},_this.session=_this._createEmptySession(),_this}return __extends(Tracker,_super),Tracker.prototype.init=function(config){return __awaiter(this,void 0,void 0,function(){var sessionOptions,_a,behavioralTracker,technologyDetector,performanceOptimizer,wsConfig,cleanConfig,webSocketManager,error_1,_b,_c,_this=this;return __generator(this,function(_d){switch(_d.label){case 0:if(this.isInitialized)return this.config.debug&&console.warn("Tracker already initialized"),[2];if(this.config=deepMerge(this.config,config),!this.config.apiUrl||!this.config.projectId)throw new Error("apiUrl and projectId are required");return this._storage=new Storage$1("opt_".concat(this.config.projectId,"_")),sessionOptions={sessionTimeout:this.config.sessionTimeout||18e5,enableCrossTabs:!0,enableFingerprinting:!0,sessionValidation:!0,storagePrefix:"opt_".concat(this.config.projectId,"_session_")},this._sessionManager=new SessionManager(this._storage,sessionOptions),this._sessionManager.on("session:created",function(event){_this.session=event.session,_this.emit("session:created",event),_this.config.debug&&console.log("New session created:",event)}),this._sessionManager.on("session:restored",function(event){_this.session=event.session,_this.emit("session:restored",event),_this.config.debug&&console.log("Session restored:",event)}),this._sessionManager.on("session:synchronized",function(event){_this.session=event.session,_this.emit("session:synchronized",event),_this.config.debug&&console.log("Session synchronized across tabs:",event)}),this._sessionManager.on("session:invalid",function(event){_this.emit("session:invalid",event),_this.config.debug&&console.log("Session invalidated:",event)}),_a=this,[4,this._sessionManager.initializeSession()];case 1:if(_a.session=_d.sent(),(behavioralTracker=new BehavioralTracker({enableClickTracking:!0,enableScrollTracking:!0,enableFormTracking:!0,enableMouseTracking:!!this.config.debug,enableVisibilityTracking:!0,enablePerformanceTracking:!0})).setTracker(this),this.use(behavioralTracker),technologyDetector=new TechnologyDetector,this.use(technologyDetector),performanceOptimizer=new PerformanceOptimizer(this.config.performance),this.use(performanceOptimizer),!1!==(null===(_b=this.config.performance)||void 0===_b?void 0:_b.enabled)&&(performanceOptimizer.startMonitoring(),this.config.debug&&console.log("Performance monitoring started")),!(null===(_c=this.config.websocket)||void 0===_c?void 0:_c.enabled)||!isBrowser())return[3,5];if(wsConfig=this.config.websocket,cleanConfig={url:wsConfig.url||""},void 0!==this.config.debug&&(cleanConfig.debug=this.config.debug),wsConfig.protocols&&(cleanConfig.protocols=wsConfig.protocols),void 0!==wsConfig.reconnect&&(cleanConfig.reconnect=wsConfig.reconnect),wsConfig.reconnectInterval&&(cleanConfig.reconnectInterval=wsConfig.reconnectInterval),wsConfig.maxReconnectAttempts&&(cleanConfig.maxReconnectAttempts=wsConfig.maxReconnectAttempts),wsConfig.heartbeatInterval&&(cleanConfig.heartbeatInterval=wsConfig.heartbeatInterval),wsConfig.messageQueueSize&&(cleanConfig.messageQueueSize=wsConfig.messageQueueSize),void 0!==wsConfig.enableCompression&&(cleanConfig.enableCompression=wsConfig.enableCompression),void 0!==wsConfig.enableFallback&&(cleanConfig.enableFallback=wsConfig.enableFallback),wsConfig.fallbackUrl&&(cleanConfig.fallbackUrl=wsConfig.fallbackUrl),wsConfig.timeout&&(cleanConfig.timeout=wsConfig.timeout),(webSocketManager=new WebSocketManager(cleanConfig)).setSessionContext(this.session.sessionId,this.session.visitorId),this.use(webSocketManager),!wsConfig.autoConnect||!wsConfig.url)return[3,5];_d.label=2;case 2:return _d.trys.push([2,4,,5]),[4,webSocketManager.connect()];case 3:return _d.sent(),this.config.debug&&console.log("WebSocket auto-connected"),[3,5];case 4:return error_1=_d.sent(),this.config.debug&&console.warn("WebSocket auto-connect failed:",error_1),[3,5];case 5:return this._startFlushTimer(),isBrowser()&&domReady(function(){_this.pageView()}),this.isInitialized=!0,this.emit("initialized",this.config),this.config.debug&&console.log("Tracker initialized",{config:this.config,session:this.session,fingerprint:this._sessionManager.getFingerprint(),modules:Array.from(this._modules.keys())}),[2]}})})},Tracker.prototype.track=function(event,data){if(void 0===data&&(data={}),this.isInitialized)if(this.hasConsent()){var eventData={type:"custom",element:event,value:data,timestamp:now$1(),sessionId:this.session.sessionId,visitorId:this.session.visitorId,metadata:data};this._queueEvent(eventData),this.emit("track",eventData),this.config.debug&&console.log("Event tracked",eventData)}else this.config.debug&&console.warn("No consent for tracking");else this.config.debug&&console.warn("Tracker not initialized")},Tracker.prototype.identify=function(visitorId,traits){void 0===traits&&(traits={}),this.isInitialized&&(this.session.visitorId=visitorId,this.track("identify",{visitorId:visitorId,traits:traits}),this.emit("identify",{visitorId:visitorId,traits:traits}))},Tracker.prototype.pageView=function(data){if(void 0===data&&(data={}),this.isInitialized&&this.hasConsent()){var techStack=this.getTechnologyStack(),pageViewData=__assign({url:getCurrentUrl(),title:getCurrentTitle(),timestamp:now$1(),sessionId:this.session.sessionId,visitorId:this.session.visitorId,referrer:getReferrer()},data);this._sessionManager.updateActivity(),this.session=this._sessionManager.getCurrentSession()||this.session,this._queueEvent({type:"pageview",element:pageViewData.url,value:pageViewData.title,timestamp:pageViewData.timestamp,sessionId:pageViewData.sessionId,visitorId:pageViewData.visitorId,metadata:__assign(__assign({},pageViewData),{techStack:techStack})}),this.emit("pageview",__assign(__assign({},pageViewData),{techStack:techStack})),this.config.debug&&console.log("Page view tracked",__assign(__assign({},pageViewData),{techStack:techStack}))}},Tracker.prototype.use=function(module){this._modules.has(module.name)?this.config.debug&&console.warn("Module ".concat(module.name," already registered")):(this._modules.set(module.name,module),this.isInitialized&&module.init(),this.emit("module:added",module))},Tracker.prototype.getModule=function(name){return this._modules.get(name)||null},Tracker.prototype.getTechnologyStack=function(){var techModule=this.getModule("TechnologyDetector");return techModule?techModule.getCurrentTechStack():{}},Tracker.prototype.connectWebSocket=function(){return __awaiter(this,void 0,void 0,function(){var webSocketManager;return __generator(this,function(_a){if(!(webSocketManager=this.getModule("WebSocketManager")))throw new Error("WebSocket module not initialized");return[2,webSocketManager.connect()]})})},Tracker.prototype.disconnectWebSocket=function(){var webSocketManager=this.getModule("WebSocketManager");webSocketManager&&webSocketManager.disconnect()},Tracker.prototype.sendWebSocketEvent=function(event_1,data_1){return __awaiter(this,arguments,void 0,function(event,data,priority){var webSocketManager;return void 0===priority&&(priority="normal"),__generator(this,function(_a){return(webSocketManager=this.getModule("WebSocketManager"))?[2,webSocketManager.sendEvent(event,data,priority)]:[2,!1]})})},Tracker.prototype.getWebSocketState=function(){var webSocketManager=this.getModule("WebSocketManager");return webSocketManager?webSocketManager.getConnectionState():null},Tracker.prototype.getWebSocketMetrics=function(){var wsModule=this.getModule("WebSocketManager");return wsModule?wsModule.getMetrics():null},Tracker.prototype.setConsent=function(consent){this._storage.set("consent",JSON.stringify(consent)),this.emit("consent:changed",consent),this.config.debug&&console.log("Consent updated",consent)},Tracker.prototype.hasConsent=function(){if(!this.config.enableGDPR)return!0;var consentData=this._storage.get("consent");if(!consentData)return!1;try{var consent=JSON.parse(consentData);return consent.hasConsent&&consent.purposes.analytics}catch(_a){return!1}},Tracker.prototype.showConsentBanner=function(){var gdprModule=this.getModule("GDPRCompliance");gdprModule?gdprModule.showConsentBanner():this.config.debug&&console.warn("GDPR Compliance module not found")},Tracker.prototype.hideConsentBanner=function(){var gdprModule=this.getModule("GDPRCompliance");gdprModule?gdprModule.hideConsentBanner():this.config.debug&&console.warn("GDPR Compliance module not found")},Tracker.prototype.getGDPRConsent=function(){var gdprModule=this.getModule("GDPRCompliance");return gdprModule?gdprModule.getConsent():null},Tracker.prototype.setGDPRConsent=function(consent){var gdprModule=this.getModule("GDPRCompliance");gdprModule?gdprModule.setConsent(consent):this.config.debug&&console.warn("GDPR Compliance module not found")},Tracker.prototype.withdrawConsent=function(category){var gdprModule=this.getModule("GDPRCompliance");gdprModule?gdprModule.withdrawConsent(category):this.config.debug&&console.warn("GDPR Compliance module not found")},Tracker.prototype.requestDataAccess=function(email){return __awaiter(this,void 0,void 0,function(){var gdprModule;return __generator(this,function(_a){if(gdprModule=this.getModule("GDPRCompliance"))return[2,gdprModule.requestDataAccess(email)];throw new Error("GDPR Compliance module not found")})})},Tracker.prototype.requestDataDeletion=function(email){return __awaiter(this,void 0,void 0,function(){var gdprModule;return __generator(this,function(_a){if(gdprModule=this.getModule("GDPRCompliance"))return[2,gdprModule.requestDataDeletion(email)];throw new Error("GDPR Compliance module not found")})})},Tracker.prototype.requestDataPortability=function(email){return __awaiter(this,void 0,void 0,function(){var gdprModule;return __generator(this,function(_a){if(gdprModule=this.getModule("GDPRCompliance"))return[2,gdprModule.requestDataPortability(email)];throw new Error("GDPR Compliance module not found")})})},Tracker.prototype.getPrivacySettings=function(){var gdprModule=this.getModule("GDPRCompliance");return gdprModule?gdprModule.getPrivacySettings():null},Tracker.prototype.setPrivacySettings=function(settings){var gdprModule=this.getModule("GDPRCompliance");gdprModule?gdprModule.setPrivacySettings(settings):this.config.debug&&console.warn("GDPR Compliance module not found")},Tracker.prototype.isGDPRCompliant=function(){var gdprModule=this.getModule("GDPRCompliance");return gdprModule?gdprModule.isCompliant():!this.config.enableGDPR},Tracker.prototype.exportUserData=function(visitorId){return __awaiter(this,void 0,void 0,function(){var gdprModule;return __generator(this,function(_a){if(gdprModule=this.getModule("GDPRCompliance"))return[2,gdprModule.exportUserData(visitorId||this.session.visitorId)];throw new Error("GDPR Compliance module not found")})})},Tracker.prototype.flush=function(){return __awaiter(this,void 0,void 0,function(){var events,error_2,_a;return __generator(this,function(_b){switch(_b.label){case 0:if(0===this._eventQueue.length)return[2];events=__spreadArray([],__read(this._eventQueue),!1),this._eventQueue=[],_b.label=1;case 1:return _b.trys.push([1,3,,4]),[4,this._sendEvents(events)];case 2:return _b.sent(),this.emit("events:sent",events),[3,4];case 3:return error_2=_b.sent(),(_a=this._eventQueue).unshift.apply(_a,__spreadArray([],__read(events),!1)),this.emit("events:failed",error_2),this.config.debug&&console.error("Failed to send events",error_2),[3,4];case 4:return[2]}})})},Tracker.prototype.destroy=function(){this._destroyed||(this._flushTimer&&clearInterval(this._flushTimer),this.flush().catch(function(){}),this._sessionManager.destroy(),this._modules.forEach(function(module){module.destroy&&module.destroy()}),this._modules.clear(),this.removeAllListeners(),this._destroyed=!0,this.isInitialized=!1)},Tracker.prototype._createEmptySession=function(){return{sessionId:"",visitorId:"",startTime:0,lastActivity:0,pageViews:0,platform:"",userAgent:"",landingPage:""}},Tracker.prototype._queueEvent=function(event){this._eventQueue.push(event),this._eventQueue.length>=this.config.batchSize&&this.flush().catch(function(){})},Tracker.prototype._startFlushTimer=function(){var _this=this;this._flushTimer&&clearInterval(this._flushTimer),this._flushTimer=window.setInterval(function(){_this._eventQueue.length>0&&_this.flush().catch(function(){})},this.config.flushInterval)},Tracker.prototype._sendEvents=function(events){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return this.config.debug&&console.log("Sending events",events),[4,new Promise(function(resolve){return setTimeout(resolve,100)})];case 1:return _a.sent(),[2]}})})},Tracker.prototype.configurePerformance=function(config){var perfModule=this.getModule("PerformanceOptimizer");perfModule?perfModule.configure(config):this.config.debug&&console.warn("PerformanceOptimizer module not found")},Tracker.prototype.getPerformanceMetrics=function(){var perfModule=this.getModule("PerformanceOptimizer");return perfModule?perfModule.getMetrics():{loadTime:0,domReady:0,firstPaint:0,firstContentfulPaint:0,largestContentfulPaint:0,firstInputDelay:0,cumulativeLayoutShift:0,totalBlockingTime:0,timeToInteractive:0,memoryUsage:{used:0,total:0,limit:0},cpuUsage:0,networkStats:{requests:0,bytesTransferred:0,averageLatency:0},scriptPerformance:{initTime:0,executionTime:0,moduleLoadTimes:{}}}},Tracker.prototype.getPerformanceReport=function(){var perfModule=this.getModule("PerformanceOptimizer");return perfModule?perfModule.getOptimizationReport():{timestamp:Date.now(),metrics:this.getPerformanceMetrics(),thresholds:{memory:{warning:80,critical:100},cpu:{warning:70,critical:90},network:{latency:500,bandwidth:1048576},coreWebVitals:{lcp:2500,fid:100,cls:.1}},violations:[],optimizations:[],score:100,grade:"A"}},Tracker.prototype.startPerformanceMonitoring=function(){var perfModule=this.getModule("PerformanceOptimizer");perfModule?perfModule.startMonitoring():this.config.debug&&console.warn("PerformanceOptimizer module not found")},Tracker.prototype.stopPerformanceMonitoring=function(){var perfModule=this.getModule("PerformanceOptimizer");perfModule?perfModule.stopMonitoring():this.config.debug&&console.warn("PerformanceOptimizer module not found")},Tracker.prototype.optimizePerformance=function(){var perfModule=this.getModule("PerformanceOptimizer");perfModule?perfModule.optimizeCoreWebVitals():this.config.debug&&console.warn("PerformanceOptimizer module not found")},Tracker.prototype.preloadCriticalResources=function(){return __awaiter(this,void 0,void 0,function(){var perfModule;return __generator(this,function(_a){switch(_a.label){case 0:return(perfModule=this.getModule("PerformanceOptimizer"))?[4,perfModule.preloadCriticalResources()]:[3,2];case 1:return _a.sent(),[3,3];case 2:this.config.debug&&console.warn("PerformanceOptimizer module not found"),_a.label=3;case 3:return[2]}})})},Tracker.prototype.enableLazyLoading=function(){var perfModule=this.getModule("PerformanceOptimizer");perfModule?perfModule.configure({lazyLoading:{enabled:!0,threshold:51200,modules:[],chunkSize:102400}}):this.config.debug&&console.warn("PerformanceOptimizer module not found")},Tracker.prototype.enableCodeSplitting=function(){var perfModule=this.getModule("PerformanceOptimizer");perfModule?perfModule.configure({codesplitting:{enabled:!0,splitPoints:[],dynamicImports:!0,preloadCritical:!0}}):this.config.debug&&console.warn("PerformanceOptimizer module not found")},Tracker.prototype.measureCoreWebVitals=function(){return __awaiter(this,void 0,void 0,function(){var perfModule;return __generator(this,function(_a){switch(_a.label){case 0:return(perfModule=this.getModule("PerformanceOptimizer"))?[4,perfModule.measureCoreWebVitals()]:[3,2];case 1:return[2,_a.sent()];case 2:return[2,{lcp:0,fid:0,cls:0,fcp:0,ttfb:0,tbt:0,tti:0}]}})})},Tracker}(EventEmitter),GDPRCompliance=function(_super){function GDPRCompliance(config,storage){var _a,_b,_c,_d,_e,_f;void 0===config&&(config={});var _this=_super.call(this)||this;return _this.name="GDPRCompliance",_this._consent=null,_this._bannerElement=null,_this._initialized=!1,_this._defaultTexts={bannerTitle:"We value your privacy",bannerDescription:"We use cookies and similar technologies to enhance your experience, analyze usage, and assist with marketing. You can manage your preferences at any time.",acceptAll:"Accept All",rejectAll:"Reject All",customize:"Customize",savePreferences:"Save Preferences",necessary:"Necessary",analytics:"Analytics",marketing:"Marketing",privacyPolicy:"Privacy Policy",cookiePolicy:"Cookie Policy"},_this._config=__assign({enabled:!0,consentBanner:__assign({enabled:!0,position:"bottom",theme:"light",texts:_this._defaultTexts,showOnEveryPage:!1,respectDoNotTrack:!0},config.consentBanner),cookieCategories:_this._getDefaultCookieCategories(),dataRetention:__assign({defaultDays:730,automaticDeletion:!0},config.dataRetention),userRights:__assign({enableDataAccess:!0,enableDataDeletion:!0,enableDataPortability:!0,enableOptOut:!0},config.userRights),privacyByDesign:__assign({dataMinimization:!0,purposeLimitation:!0,storageMinimization:!0,autoAnonymization:!0},config.privacyByDesign),legalBasis:__assign({type:"consent",description:"User consent for data processing"},config.legalBasis)},config),_this._cookieCategories=_this._config.cookieCategories||_this._getDefaultCookieCategories(),_this._privacySettings={dataMinimization:(null===(_a=_this._config.privacyByDesign)||void 0===_a?void 0:_a.dataMinimization)||!0,anonymizeIPs:!0,respectDoNotTrack:(null===(_b=_this._config.consentBanner)||void 0===_b?void 0:_b.respectDoNotTrack)||!0,cookielessTracking:!1,storageMinimization:(null===(_c=_this._config.privacyByDesign)||void 0===_c?void 0:_c.storageMinimization)||!0,automaticDeletion:(null===(_d=_this._config.dataRetention)||void 0===_d?void 0:_d.automaticDeletion)||!0,purposeLimitation:(null===(_e=_this._config.privacyByDesign)||void 0===_e?void 0:_e.purposeLimitation)||!0,dataRetentionDays:(null===(_f=_this._config.dataRetention)||void 0===_f?void 0:_f.defaultDays)||730,consentRequired:!0},_this._storage=storage||(isBrowser()?localStorage:{getItem:function(){return null},setItem:function(){},removeItem:function(){},clear:function(){}}),_this}return __extends(GDPRCompliance,_super),GDPRCompliance.prototype.init=function(){if(this._config.enabled&&!this._initialized){if(this._loadStoredConsent(),this._privacySettings.respectDoNotTrack&&this._hasDoNotTrack())return this._handleDoNotTrack(),this._initialized=!0,void this.emit("gdpr:initialized",this._config);this._shouldShowBanner()&&this.showConsentBanner(),this._initialized=!0,this.emit("gdpr:initialized",this._config)}},GDPRCompliance.prototype.showConsentBanner=function(){var _a;isBrowser()&&(null===(_a=this._config.consentBanner)||void 0===_a?void 0:_a.enabled)?(this._createBannerElement(),this.emit("banner:shown")):this.emit("banner:shown")},GDPRCompliance.prototype.hideConsentBanner=function(){this._bannerElement&&(this._bannerElement.remove(),this._bannerElement=null,this.emit("banner:hidden"))},GDPRCompliance.prototype.getConsent=function(){return this._consent},GDPRCompliance.prototype.setConsent=function(consent){var _this=this,newConsent=__assign({id:generateId$1(),hasConsent:!0,timestamp:now$1(),version:"1.0",method:"banner",categories:{},legalBasis:{},purposes:{analytics:!1,marketing:!1,functional:!0,advertising:!1,personalization:!1}},consent);Object.keys(newConsent.categories).forEach(function(categoryId){if(_this._cookieCategories.find(function(c){return c.id===categoryId})&&newConsent.categories[categoryId])switch(categoryId){case"analytics":newConsent.purposes.analytics=!0;break;case"marketing":newConsent.purposes.marketing=!0;break;case"advertising":newConsent.purposes.advertising=!0;break;case"personalization":newConsent.purposes.personalization=!0}}),this._consent=newConsent,this._storeConsent(),this.hideConsentBanner(),this.emit("consent:updated",newConsent)},GDPRCompliance.prototype.withdrawConsent=function(category){var _this=this;if(this._consent){if(category)switch(this._consent.categories[category]=!1,category){case"analytics":this._consent.purposes.analytics=!1;break;case"marketing":this._consent.purposes.marketing=!1;break;case"advertising":this._consent.purposes.advertising=!1;break;case"personalization":this._consent.purposes.personalization=!1}else this._consent.hasConsent=!1,this._consent.withdrawalDate=now$1(),Object.keys(this._consent.categories).forEach(function(cat){_this._consent.categories[cat]=!1}),this._consent.purposes={analytics:!1,marketing:!1,functional:!0,advertising:!1,personalization:!1};this._storeConsent(),this.emit("consent:withdrawn",{category:category,consent:this._consent})}},GDPRCompliance.prototype.renewConsent=function(){this._consent&&(this._consent.renewalRequired=!0,this._storeConsent()),this.showConsentBanner(),this.emit("consent:renewal_required")},GDPRCompliance.prototype.getCookieCategories=function(){return this._cookieCategories},GDPRCompliance.prototype.setCookieCategory=function(categoryId,enabled){var category=this._cookieCategories.find(function(c){return c.id===categoryId});category&&!category.required&&(category.enabled=enabled,this._consent&&(this._consent.categories[categoryId]=enabled,this._storeConsent()),this.emit("cookie:category_changed",{categoryId:categoryId,enabled:enabled}))},GDPRCompliance.prototype.clearCookies=function(category){isBrowser()&&((category?this._cookieCategories.filter(function(c){return c.id===category}):this._cookieCategories.filter(function(c){return!c.enabled&&!c.required})).forEach(function(cat){cat.cookies.forEach(function(cookie){document.cookie="".concat(cookie.name,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=").concat(cookie.domain||window.location.hostname)})}),this.emit("cookies:cleared",{category:category}))},GDPRCompliance.prototype.requestDataAccess=function(email){return __awaiter(this,void 0,void 0,function(){var request,_a;return __generator(this,function(_b){if(!(null===(_a=this._config.userRights)||void 0===_a?void 0:_a.enableDataAccess))throw new Error("Data access requests are not enabled");return request=__assign(__assign({id:generateId$1(),type:"access",timestamp:now$1(),visitorId:this._getVisitorId()},email&&{email:email}),{status:"pending",expiresAt:now$1()+2592e6}),this.emit("data:access_requested",request),[2,request]})})},GDPRCompliance.prototype.requestDataDeletion=function(email){return __awaiter(this,void 0,void 0,function(){var request,_a;return __generator(this,function(_b){if(!(null===(_a=this._config.userRights)||void 0===_a?void 0:_a.enableDataDeletion))throw new Error("Data deletion requests are not enabled");return request=__assign(__assign({id:generateId$1(),type:"deletion",timestamp:now$1(),visitorId:this._getVisitorId()},email&&{email:email}),{status:"pending",expiresAt:now$1()+2592e6}),this.emit("data:deletion_requested",request),[2,request]})})},GDPRCompliance.prototype.requestDataPortability=function(email){return __awaiter(this,void 0,void 0,function(){var request,_a;return __generator(this,function(_b){if(!(null===(_a=this._config.userRights)||void 0===_a?void 0:_a.enableDataPortability))throw new Error("Data portability requests are not enabled");return request=__assign(__assign({id:generateId$1(),type:"portability",timestamp:now$1(),visitorId:this._getVisitorId()},email&&{email:email}),{status:"pending",expiresAt:now$1()+2592e6}),this.emit("data:portability_requested",request),[2,request]})})},GDPRCompliance.prototype.getPrivacySettings=function(){return __assign({},this._privacySettings)},GDPRCompliance.prototype.setPrivacySettings=function(settings){this._privacySettings=__assign(__assign({},this._privacySettings),settings),this.emit("privacy:settings_updated",this._privacySettings)},GDPRCompliance.prototype.anonymizeData=function(data){if(!this._privacySettings.dataMinimization)return data;var anonymized=__assign({},data);return this._privacySettings.anonymizeIPs&&anonymized.ip&&(anonymized.ip=this._anonymizeIP(anonymized.ip)),["email","phone","name","address","ssn"].forEach(function(field){anonymized[field]&&delete anonymized[field]}),anonymized},GDPRCompliance.prototype.isCompliant=function(){return!this._config.enabled||!(this._privacySettings.consentRequired&&!this._hasValidConsent())&&!!this._isDataRetentionCompliant()},GDPRCompliance.prototype.getComplianceReport=function(){var issues=[],recommendations=[],consentStatus="missing";this._consent?this._consent.withdrawalDate?consentStatus="withdrawn":this._isConsentExpired()?(consentStatus="expired",issues.push("Consent has expired and needs renewal")):consentStatus="valid":issues.push("No consent record found");var dataRetentionCompliant=this._isDataRetentionCompliant();dataRetentionCompliant||(issues.push("Data retention period exceeded"),recommendations.push("Implement automatic data deletion"));var cookieCompliant=this._isCookieCompliant();return cookieCompliant||(issues.push("Non-essential cookies active without consent"),recommendations.push("Review cookie categorization and consent status")),{timestamp:now$1(),consentStatus:consentStatus,dataRetentionCompliance:dataRetentionCompliant,cookieCompliance:cookieCompliant,privacySettingsCompliance:!0,issues:issues,recommendations:recommendations}},GDPRCompliance.prototype.exportUserData=function(visitorId){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,{visitorId:visitorId,exportDate:now$1(),sessions:[],events:[],pageViews:[],consent:this._consent?[this._consent]:[],format:"json"}]})})},GDPRCompliance.prototype.deleteUserData=function(visitorId){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){try{return this._storage.removeItem("gdpr_consent_".concat(visitorId)),this._storage.removeItem("visitor_session_".concat(visitorId)),this._consent&&(this._consent=null),this.emit("data:deleted",{visitorId:visitorId}),[2,!0]}catch(error){return this.emit("data:deletion_failed",{visitorId:visitorId,error:error}),[2,!1]}return[2]})})},GDPRCompliance.prototype.destroy=function(){this.hideConsentBanner(),this._initialized=!1,this.emit("gdpr:destroyed")},GDPRCompliance.prototype._getDefaultCookieCategories=function(){return[{id:"necessary",name:"Necessary",description:"These cookies are essential for the website to function properly.",required:!0,enabled:!0,purpose:"Essential website functionality",legalBasis:{type:"legitimate_interests",description:"Necessary for website operation",legitimateInterests:"Providing requested services"},retentionPeriod:365,cookies:[{name:"session_id",purpose:"Session management",provider:"First party",expiry:"Session",type:"essential"}]},{id:"analytics",name:"Analytics",description:"These cookies help us understand how visitors interact with our website.",required:!1,enabled:!1,purpose:"Website analytics and improvement",legalBasis:{type:"consent",description:"User consent for analytics"},retentionPeriod:730,cookies:[{name:"tracking_id",purpose:"Visitor tracking",provider:"First party",expiry:"2 years",type:"analytics"}]},{id:"marketing",name:"Marketing",description:"These cookies are used to show relevant advertising and marketing content.",required:!1,enabled:!1,purpose:"Personalized advertising",legalBasis:{type:"consent",description:"User consent for marketing"},retentionPeriod:365,cookies:[{name:"marketing_id",purpose:"Marketing campaigns",provider:"Third party",expiry:"1 year",type:"marketing"}]}]},GDPRCompliance.prototype._loadStoredConsent=function(){try{var stored=this._storage.getItem("gdpr_consent");stored&&(this._consent=JSON.parse(stored))}catch(_a){}},GDPRCompliance.prototype._storeConsent=function(){this._consent&&this._storage.setItem("gdpr_consent",JSON.stringify(this._consent))},GDPRCompliance.prototype._shouldShowBanner=function(){var _a,_b;return!(!(null===(_a=this._config.consentBanner)||void 0===_a?void 0:_a.enabled)||this._hasValidConsent()&&!(null===(_b=this._consent)||void 0===_b?void 0:_b.renewalRequired)||this._hasDoNotTrack()&&this._privacySettings.respectDoNotTrack)},GDPRCompliance.prototype._hasValidConsent=function(){return null!==this._consent&&this._consent.hasConsent&&!this._consent.withdrawalDate&&!this._isConsentExpired()},GDPRCompliance.prototype._isConsentExpired=function(){if(!this._consent)return!0;var expiryTime=this._consent.timestamp+31536e6;return now$1()>expiryTime},GDPRCompliance.prototype._hasDoNotTrack=function(){return!!isBrowser()&&("1"===navigator.doNotTrack||"1"===window.doNotTrack||"1"===navigator.msDoNotTrack)},GDPRCompliance.prototype._handleDoNotTrack=function(){this.setConsent({hasConsent:!1,method:"implied",categories:{},purposes:{analytics:!1,marketing:!1,functional:!0,advertising:!1,personalization:!1}}),this.emit("consent:do_not_track")},GDPRCompliance.prototype._createBannerElement=function(){if(isBrowser()&&!this._bannerElement){var banner=document.createElement("div");banner.className="gdpr-banner",banner.innerHTML=this._getBannerHTML(),this._applyBannerStyles(banner),this._addBannerEventListeners(banner),document.body.appendChild(banner),this._bannerElement=banner}},GDPRCompliance.prototype._getBannerHTML=function(){var _a,texts=(null===(_a=this._config.consentBanner)||void 0===_a?void 0:_a.texts)||this._defaultTexts;return'\n      <div class="gdpr-banner-content">\n        <div class="gdpr-banner-text">\n          <h3>'.concat(texts.bannerTitle,"</h3>\n          <p>").concat(texts.bannerDescription,'</p>\n        </div>\n        <div class="gdpr-banner-actions">\n          <button type="button" class="gdpr-btn gdpr-btn-customize">').concat(texts.customize,'</button>\n          <button type="button" class="gdpr-btn gdpr-btn-reject">').concat(texts.rejectAll,'</button>\n          <button type="button" class="gdpr-btn gdpr-btn-accept">').concat(texts.acceptAll,"</button>\n        </div>\n      </div>\n    ")},GDPRCompliance.prototype._applyBannerStyles=function(banner){var _a,_b,_c,position=(null===(_a=this._config.consentBanner)||void 0===_a?void 0:_a.position)||"bottom",theme=(null===(_b=this._config.consentBanner)||void 0===_b?void 0:_b.theme)||"light",baseStyles={position:"fixed",left:"0",right:"0",zIndex:"10000",backgroundColor:"dark"===theme?"#2d3748":"#ffffff",color:"dark"===theme?"#ffffff":"#2d3748",padding:"16px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",fontFamily:"-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif",fontSize:"14px",lineHeight:"1.4"};"top"===position?baseStyles.top="0":baseStyles.bottom="0",Object.assign(banner.style,baseStyles,null===(_c=this._config.consentBanner)||void 0===_c?void 0:_c.customStyles);var content=banner.querySelector(".gdpr-banner-content");content&&Object.assign(content.style,{display:"flex",alignItems:"center",justifyContent:"space-between",maxWidth:"1200px",margin:"0 auto",gap:"16px"}),banner.querySelectorAll(".gdpr-btn").forEach(function(btn){var button=btn;Object.assign(button.style,{padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",marginLeft:"8px"}),button.classList.contains("gdpr-btn-accept")?Object.assign(button.style,{backgroundColor:"#4299e1",color:"#ffffff"}):button.classList.contains("gdpr-btn-reject")?Object.assign(button.style,{backgroundColor:"transparent",color:"dark"===theme?"#ffffff":"#4a5568",border:"1px solid currentColor"}):Object.assign(button.style,{backgroundColor:"transparent",color:"dark"===theme?"#ffffff":"#4a5568",textDecoration:"underline"})})},GDPRCompliance.prototype._addBannerEventListeners=function(banner){var _this=this,acceptBtn=banner.querySelector(".gdpr-btn-accept"),rejectBtn=banner.querySelector(".gdpr-btn-reject"),customizeBtn=banner.querySelector(".gdpr-btn-customize");acceptBtn&&acceptBtn.addEventListener("click",function(){_this.setConsent({hasConsent:!0,method:"banner",categories:Object.fromEntries(_this._cookieCategories.map(function(cat){return[cat.id,!cat.required||cat.enabled]}))})}),rejectBtn&&rejectBtn.addEventListener("click",function(){_this.setConsent({hasConsent:!1,method:"banner",categories:Object.fromEntries(_this._cookieCategories.map(function(cat){return[cat.id,cat.required]}))})}),customizeBtn&&customizeBtn.addEventListener("click",function(){_this._showCustomizeModal()})},GDPRCompliance.prototype._showCustomizeModal=function(){this.emit("banner:customize_requested",this._cookieCategories)},GDPRCompliance.prototype._isDataRetentionCompliant=function(){if(!this._consent)return!0;var retentionDays=this._privacySettings.dataRetentionDays;return now$1()-this._consent.timestamp<=24*retentionDays*60*60*1e3},GDPRCompliance.prototype._isCookieCompliant=function(){var _this=this;return!!this._consent&&this._cookieCategories.every(function(category){if(category.required)return!0;var consentForCategory=_this._consent.categories[category.id];return void 0!==consentForCategory?category.enabled===consentForCategory:!category.enabled})},GDPRCompliance.prototype._anonymizeIP=function(ip){return ip.includes(":")?ip.split(":").slice(0,4).join(":")+"::":ip.split(".").slice(0,3).join(".")+".0"},GDPRCompliance.prototype._getVisitorId=function(){return"visitor_"+generateId$1()},GDPRCompliance}(EventEmitter),globalTracker=null;function init(config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return globalTracker||(globalTracker=new Tracker),[4,globalTracker.init(config)];case 1:return _a.sent(),[2,globalTracker]}})})}function getTracker(){return globalTracker}function track(event,data){globalTracker&&globalTracker.track(event,data)}function pageView(data){globalTracker&&globalTracker.pageView(data)}function identify(visitorId,traits){globalTracker&&globalTracker.identify(visitorId,traits)}function setConsent(consent){globalTracker&&globalTracker.setConsent(consent)}function createTracker(config){var tracker=new Tracker;return config&&config.apiUrl&&config.projectId&&tracker.init(config).catch(function(error){config.debug&&console.error("Failed to initialize tracker:",error)}),tracker}if(isBrowser()){var globalWindow=window;globalWindow.optimizelyConfig&&init(globalWindow.optimizelyConfig),globalWindow.Optimizely={init:init,getTracker:getTracker,track:track,pageView:pageView,identify:identify,setConsent:setConsent,createTracker:createTracker,Tracker:Tracker}}var index={init:init,getTracker:getTracker,track:track,pageView:pageView,identify:identify,setConsent:setConsent,createTracker:createTracker,Tracker:Tracker};export{BehavioralTracker,EventEmitter,GDPRCompliance,SessionManager,Storage$1 as Storage,TechnologyDetector,Tracker,UniversalPolyfills,WebSocketManager,addEventListener,anonymizeIP,anonymizeIPv4,anonymizeIPv6,areCookiesEnabled,calculateRetentionExpiry,clearAllCookies,createTracker,debounce,deepMerge,index as default,detectBrowser,detectPlatform,domReady,formatGDPRDate,generateId$1 as generateId,generateSessionId,generateVisitorId,getCurrentTitle,getCurrentUrl,getDoNotTrackStatus,getLanguage,getPlatform,getReferrer,getScrollDepth,getTimezoneOffset,getTracker,getUserAgent,hashSensitiveData,identify,init,isBot,isBrowser,isConsentRequired,isDataExpired,isElementVisible,isProduction,isValidEmail,now$1 as now,pageView,removePII,safeJsonParse,safeJsonStringify,setConsent,shouldAnonymizeIP,shouldMinimizeData,simpleHash,throttle,track};
//# sourceMappingURL=tracker.esm.js.map

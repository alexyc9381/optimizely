!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).OptimizelyTracker={})}(this,function(t){"use strict";var i=function(t,n){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},i(t,n)};function n(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}i(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var e=function(){return e=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var r in i=arguments[n])Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r]);return t},e.apply(this,arguments)};function r(t,i,n,e){return new(n||(n=Promise))(function(r,o){function s(t){try{c(e.next(t))}catch(t){o(t)}}function a(t){try{c(e.throw(t))}catch(t){o(t)}}function c(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(s,a)}c((e=e.apply(t,i||[])).next())})}function o(t,i){var n,e,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,e&&(r=2&a[0]?e.return:a[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,a[1])).done)return r;switch(e=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,e=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=i.call(t,o)}catch(t){a=[6,t],e=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function s(t){var i="function"==typeof Symbol&&Symbol.iterator,n=i&&t[i],e=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,r,o=n.call(t),s=[];try{for(;(void 0===i||i-- >0)&&!(e=o.next()).done;)s.push(e.value)}catch(t){r={error:t}}finally{try{e&&!e.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s}function c(t,i,n){if(n||2===arguments.length)for(var e,r=0,o=i.length;r<o;r++)!e&&r in i||(e||(e=Array.prototype.slice.call(i,0,r)),e[r]=i[r]);return t.concat(e||Array.prototype.slice.call(i))}"function"==typeof SuppressedError&&SuppressedError;var u=function(){function t(){}return t.init=function(){this.initialized||(this.polyfillPromise(),this.polyfillFetch(),this.polyfillIntersectionObserver(),this.polyfillPerformanceObserver(),this.polyfillRequestIdleCallback(),this.polyfillCustomEvent(),this.polyfillAssign(),this.polyfillArrayIncludes(),this.polyfillStringIncludes(),this.polyfillConsole(),this.initialized=!0)},t.polyfillPromise=function(){var t,i;"undefined"==typeof Promise&&(window.Promise=(i=function(){function n(i){this.state="pending",this.handlers=[],this[t]="Promise";try{i(this.resolve.bind(this),this.reject.bind(this))}catch(t){this.reject(t)}}return n.prototype.resolve=function(t){var i=this;"pending"===this.state&&(this.state="fulfilled",this.value=t,this.handlers.forEach(function(t){return i.handle(t)}),this.handlers=[])},n.prototype.reject=function(t){var i=this;"pending"===this.state&&(this.state="rejected",this.value=t,this.handlers.forEach(function(t){return i.handle(t)}),this.handlers=[])},n.prototype.handle=function(t){if("pending"===this.state)this.handlers.push(t);else if("fulfilled"===this.state&&t.onFulfilled)try{var i=t.onFulfilled(this.value);t.resolve(i)}catch(i){t.reject(i)}else if("rejected"===this.state&&t.onRejected)try{i=t.onRejected(this.value),t.resolve(i)}catch(i){t.reject(i)}else"fulfilled"===this.state?t.resolve(this.value):t.reject(this.value)},n.prototype.then=function(t,n){var e=this;return new i(function(i,r){e.handle({onFulfilled:t,onRejected:n,resolve:i,reject:r})})},n.prototype.catch=function(t){return this.then(void 0,t)},n.prototype.finally=function(t){return this.then(function(i){return t&&t(),i},function(i){throw t&&t(),i})},n.resolve=function(t){return new i(function(i){return i(t)})},n.reject=function(t){return new i(function(i,n){return n(t)})},n.all=function(t){return new i(function(i,n){if(0!==t.length){var e=0,r=new Array(t.length);t.forEach(function(o,s){o.then(function(n){r[s]=n,++e===t.length&&i(r)},n)})}else i([])})},n}(),t=Symbol.toStringTag,i))},t.polyfillFetch=function(){"undefined"==typeof fetch&&(window.fetch=function(t,i){return void 0===i&&(i={}),new Promise(function(n,e){var r=new XMLHttpRequest,o=i.method||"GET";r.open(o,t),i.headers&&Object.keys(i.headers).forEach(function(t){r.setRequestHeader(t,i.headers[t])}),r.onload=function(){var t={ok:r.status>=200&&r.status<300,status:r.status,statusText:r.statusText,headers:new Map,json:function(){return Promise.resolve(JSON.parse(r.responseText))},text:function(){return Promise.resolve(r.responseText)}};n(t)},r.onerror=function(){return e(new Error("Network Error"))},r.send(i.body||null)})})},t.polyfillIntersectionObserver=function(){"undefined"==typeof IntersectionObserver&&(window.IntersectionObserver=function(){function t(t){this.elements=new Set,this.callback=t}return t.prototype.observe=function(t){var i=this;this.elements.add(t),setTimeout(function(){i.callback([{target:t,isIntersecting:!0,intersectionRatio:1}])},0)},t.prototype.unobserve=function(t){this.elements.delete(t)},t.prototype.disconnect=function(){this.elements.clear()},t}())},t.polyfillPerformanceObserver=function(){"undefined"==typeof PerformanceObserver&&(window.PerformanceObserver=function(){function t(t){this.callback=t}return t.prototype.observe=function(){var t=this;setTimeout(function(){t.callback({getEntries:function(){return[]}})},0)},t.prototype.disconnect=function(){},t}())},t.polyfillRequestIdleCallback=function(){"undefined"==typeof window||window.requestIdleCallback||(window.requestIdleCallback=function(t,i){var n=Date.now(),e=(null==i?void 0:i.timeout)||0;return setTimeout(function(){var i=Math.max(0,50-(Date.now()-n)),r={didTimeout:e>0&&Date.now()-n>=e,timeRemaining:function(){return i}};t(r)},1)},window.cancelIdleCallback=function(t){clearTimeout(t)})},t.polyfillCustomEvent=function(){"undefined"==typeof CustomEvent&&(window.CustomEvent=function(t,i){void 0===i&&(i={});var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,i.bubbles||!1,i.cancelable||!1,i.detail),n})},t.polyfillAssign=function(){Object.assign||(Object.assign=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=0;r<i.length;r++){var o=i[r];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e})},t.polyfillArrayIncludes=function(){Array.prototype.includes||(Array.prototype.includes=function(t,i){var n=parseInt(String(i||0))||0;if(n>=this.length)return!1;for(var e=n>=0?n:Math.max(0,this.length+n);e<this.length;e++)if(this[e]===t)return!0;return!1})},t.polyfillStringIncludes=function(){String.prototype.includes||(String.prototype.includes=function(t,i){return"number"!=typeof i&&(i=0),!(i+t.length>this.length)&&-1!==this.indexOf(t,i)})},t.polyfillConsole=function(){"undefined"==typeof console&&(window.console={log:function(){},warn:function(){},error:function(){},info:function(){},debug:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){}})},t.isModernBrowser=function(){return!("undefined"==typeof Promise||"undefined"==typeof fetch||"undefined"==typeof IntersectionObserver||"undefined"==typeof PerformanceObserver||"undefined"==typeof CustomEvent||"function"!=typeof Object.assign||"function"!=typeof Array.prototype.includes||"function"!=typeof String.prototype.includes)},t.getCompatibilityReport=function(){var t={Promise:"undefined"!=typeof Promise,fetch:"undefined"!=typeof fetch,IntersectionObserver:"undefined"!=typeof IntersectionObserver,PerformanceObserver:"undefined"!=typeof PerformanceObserver,requestIdleCallback:"undefined"!=typeof window&&void 0!==window.requestIdleCallback,CustomEvent:"undefined"!=typeof CustomEvent,ObjectAssign:!!Object.assign,ArrayIncludes:!!Array.prototype.includes,StringIncludes:!!String.prototype.includes,localStorage:"undefined"!=typeof Storage,sessionStorage:"undefined"!=typeof Storage},i=Object.keys(t).filter(function(i){return!t[i]});return{isModern:this.isModernBrowser(),features:t,polyfillsNeeded:i}},t.initialized=!1,t}();function h(){return"v_"+l(16)}function f(){return"s_"+l(12)+"_"+Date.now()}function l(t){for(var i="",n=0;n<t;n++)i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return i}function d(){if(p()&&window.crypto&&window.crypto.getRandomValues){var t=new Uint8Array(16);return window.crypto.getRandomValues(t),Array.from(t,function(t){return t.toString(16).padStart(2,"0")}).join("")}return Math.random().toString(36).substring(2)+Date.now().toString(36)}function v(){return Date.now()}function m(t,i){var n;return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n||(t.apply(void 0,c([],a(e),!1)),n=!0,setTimeout(function(){return n=!1},i))}}function p(){return"undefined"!=typeof window&&"undefined"!=typeof document}function y(t,i){void 0===i&&(i=null);try{return JSON.parse(t)}catch(t){return i}}function g(t,i){void 0===i&&(i="{}");try{return JSON.stringify(t)}catch(t){return i}}function w(){return p()?window.location.href.split("#")[0].split("?")[0]:""}function b(){return p()&&document.title||""}function k(){return p()&&document.referrer||""}function S(){return p()?navigator.userAgent||"":"server"}function _(){if(!p())return"server";var t=S().toLowerCase();return/android/.test(t)?"android":/iphone|ipad|ipod/.test(t)?"ios":/windows/.test(t)?"windows":/mac/.test(t)?"mac":/linux/.test(t)?"linux":"unknown"}function x(){if(!p())return"unknown";var t=S().toLowerCase();return/chrome/.test(t)&&!/edge/.test(t)?"chrome":/firefox/.test(t)?"firefox":/safari/.test(t)&&!/chrome/.test(t)?"safari":/edge/.test(t)?"edge":/opera/.test(t)?"opera":"unknown"}function T(t){p()&&"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}function P(t,i){var n=e({},t);for(var r in i)if(i.hasOwnProperty(r)){var o=i[r],s=n[r];o&&"object"==typeof o&&!Array.isArray(o)&&s&&"object"==typeof s&&!Array.isArray(s)?n[r]=P(s,o):n[r]=o}return n}function I(t){var i=t.split(".");return 4===i.length?"".concat(i[0],".").concat(i[1],".").concat(i[2],".0"):t}function j(t){var i=t.split(":");return i.length>=4?"".concat(i.slice(0,4).join(":"),"::"):t}function O(t,i){return t+24*i*60*60*1e3}var C=function(){function t(t){void 0===t&&(t={}),this.name="behavioral",this.t=null,this.i=!1,this.o=0,this.u=0,this.h=0,this.l=0,this.v=0,this.m=0,this.p=0,this.k=0,this.S=new Set,this._=new Map,this.T=[],this.P=0,this.I=e({enableClickTracking:!0,enableScrollTracking:!0,enableFormTracking:!0,enableMouseTracking:!0,enableVisibilityTracking:!0,enablePerformanceTracking:!0,scrollThreshold:25,mouseSampleRate:100,clickSelector:'a, button, [role="button"], input[type="submit"], input[type="button"]',formSelector:"form, input, textarea, select",excludeSelectors:[".tracking-ignore",'[data-tracking="false"]'],maxScrollEvents:100,maxMouseEvents:500},t)}return t.prototype.init=function(){var t;p()&&(this.i=!0,this.o=v(),this.u=v(),this.j(),this.O(),null===(t=this.t)||void 0===t||t.config.debug)},t.prototype.setTracker=function(t){this.t=t},t.prototype.j=function(){this.I.enableClickTracking&&this.C(),this.I.enableScrollTracking&&this.M(),this.I.enableFormTracking&&this.A(),this.I.enableMouseTracking&&this.D(),this.I.enableVisibilityTracking&&this.R(),this.I.enablePerformanceTracking&&this.q(),this.N()},t.prototype.C=function(){var t=this,i=function(i){if(t.i&&t.t){var n=i.target;if(n&&!t.G(n)){if(!n.matches(t.I.clickSelector)){for(var e=n.parentElement,r=!1,o=0;o<3&&e;o++){if(e.matches(t.I.clickSelector)){r=!0;break}e=e.parentElement}if(!r)return}var s={element:t.W(n),tagName:n.tagName.toLowerCase(),className:n.className,id:n.id||"",text:t.U(n),x:i.clientX,y:i.clientY,timestamp:v()};t.V("click",s),t.m++,t.L(),t.t.config.debug}}};document.addEventListener("click",i,{passive:!0}),this.T.push(function(){return document.removeEventListener("click",i)})},t.prototype.M=function(){var t=this,i=0,n=m(function(){if(t.i&&t.t&&!(t.h>=t.I.maxScrollEvents)){var n=window.pageYOffset||document.documentElement.scrollTop,e=document.documentElement.scrollHeight-window.innerHeight,r=Math.round(n/e*100);if(t.v=Math.max(t.v,r),Math.abs(r-Math.round(i/e*100))<t.I.scrollThreshold)i=n;else{var o=v(),s=n>i?"down":"up",a=Math.abs(n-i)/(o-t.P),c={depth:r,maxDepth:t.v,direction:s,speed:a,timestamp:o};t.V("scroll",c),t.h++,t.L(),i=n,t.P=o,t.t.config.debug}}},250);window.addEventListener("scroll",n,{passive:!0}),this.T.push(function(){return window.removeEventListener("scroll",n)})},t.prototype.A=function(){var t=this,i=function(i,n){var e;if(t.i&&t.t){var r=i.target;if(r&&!t.G(r)){var o=r.closest("form"),s={formId:(null==o?void 0:o.id)||"",formName:(null==o?void 0:o.getAttribute("name"))||"",field:t.W(r),fieldType:r.type||r.tagName.toLowerCase(),action:n,value:"change"===n?null===(e=r.value)||void 0===e?void 0:e.slice(0,50):void 0,timestamp:v()};t.V("form_interaction",s),t.p++,t.L(),t.t.config.debug}}};["focus","blur","change"].forEach(function(n){var e=function(t){return i(t,n)};document.addEventListener(n,e,{passive:!0}),t.T.push(function(){return document.removeEventListener(n,e)})});var n=function(t){return i(t,"submit")};document.addEventListener("submit",n,{passive:!0}),this.T.push(function(){return document.removeEventListener("submit",n)})},t.prototype.D=function(){var t=this,i=m(function(i){if(t.i&&t.t&&!(t.l>=t.I.maxMouseEvents)){var n=i.target,e={x:i.clientX,y:i.clientY,type:"move",element:n?t.W(n):"document",timestamp:v()};t.V("mouse_move",e),t.l++,t.k++,t.L()}},this.I.mouseSampleRate);document.addEventListener("mousemove",i,{passive:!0}),this.T.push(function(){return document.removeEventListener("mousemove",i)})},t.prototype.R=function(){var t=this;"IntersectionObserver"in window&&(this.J=new IntersectionObserver(function(i){i.forEach(function(i){var n,e=i.target,r=i.isIntersecting,o=v();if(r)t._.set(e,o);else{var s=t._.get(e);if(s){var a=o-s,c={element:t.W(e),visible:!1,duration:a,timestamp:o};t.V("element_visibility",c),t._.delete(e),null===(n=t.t)||void 0===n||n.config.debug}}})},{threshold:[0,.25,.5,.75,1]}),document.querySelectorAll("[data-track-visibility], .cta, .product, .pricing").forEach(function(i){var n;null===(n=t.J)||void 0===n||n.observe(i),t.S.add(i)}))},t.prototype.q=function(){var t,i=this;if("PerformanceObserver"in window)try{this.B=new PerformanceObserver(function(t){t.getEntries().forEach(function(t){"largest-contentful-paint"===t.entryType?i.V("performance",{metric:"lcp",value:t.startTime,timestamp:v()}):"first-input"===t.entryType?i.V("performance",{metric:"fid",value:t.processingStart-t.startTime,timestamp:v()}):"layout-shift"===t.entryType&&i.V("performance",{metric:"cls",value:t.value,timestamp:v()})})}),this.B.observe({entryTypes:["largest-contentful-paint","first-input","layout-shift"]})}catch(i){null===(t=this.t)||void 0===t||t.config.debug}},t.prototype.N=function(){var t=this,i=function(){t.F&&clearTimeout(t.F),t.F=window.setTimeout(function(){t.V("user_idle",{duration:3e4,timestamp:v()})},3e4)};["mousedown","mousemove","keypress","scroll","touchstart"].forEach(function(n){document.addEventListener(n,i,{passive:!0}),t.T.push(function(){return document.removeEventListener(n,i)})}),i()},t.prototype.O=function(){var t=this;this.H=window.setInterval(function(){if(t.i&&t.t){var i=t.X();t.V("engagement_metrics",i),t.t.config.debug}},3e4)},t.prototype.X=function(){var t=v(),i=t-this.o,n=t-this.u,e=25*Math.min(this.v/100,1),r=25*Math.min(this.m/5,1),o=25*Math.min(this.p/3,1),s=25*Math.min(i/6e4,1),a=Math.round(e+r+o+s);return{timeOnPage:i,scrollDepth:this.v,clickCount:this.m,formInteractions:this.p,mouseMovements:this.k,idleTime:n,engagementScore:a}},t.prototype.V=function(t,i){if(this.t){var n={type:t,element:i.element||t,value:i.value||JSON.stringify(i),timestamp:i.timestamp||v(),sessionId:this.t.session.sessionId,visitorId:this.t.session.visitorId,metadata:i};this.t.track("behavioral:".concat(t),n)}},t.prototype.L=function(){this.u=v()},t.prototype.G=function(t){return this.I.excludeSelectors.some(function(i){return t.matches(i)})},t.prototype.W=function(t){if(!t)return"unknown";if(t.id)return"#".concat(t.id);if(t.className&&"string"==typeof t.className){var i=t.className.split(" ").filter(function(t){return t.length>0});if(i.length>0)return".".concat(i[0])}return t.tagName?t.tagName.toLowerCase():"unknown"},t.prototype.U=function(t){return(t.textContent||t.value||"").trim().slice(0,100)},t.prototype.enable=function(){this.i=!0},t.prototype.disable=function(){this.i=!1},t.prototype.destroy=function(){var t;this.i=!1,this.F&&clearTimeout(this.F),this.H&&clearInterval(this.H),this.J&&this.J.disconnect(),this.B&&this.B.disconnect(),this.T.forEach(function(t){return t()}),this.T=[],this.S.clear(),this._.clear(),null===(t=this.t)||void 0===t||t.config.debug},t.prototype.getEngagementMetrics=function(){return this.X()},t.prototype.trackCustomEvent=function(t,i){this.V(t,i)},t}(),M=function(){function t(){this.Y=new Map}return t.prototype.on=function(t,i){this.Y.has(t)||this.Y.set(t,[]),this.Y.get(t).push(i)},t.prototype.off=function(t,i){var n=this.Y.get(t);if(n){var e=n.indexOf(i);e>-1&&n.splice(e,1),0===n.length&&this.Y.delete(t)}},t.prototype.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var e=this.Y.get(t);e&&c([],a(e),!1).forEach(function(t){try{t.apply(void 0,c([],a(i),!1))}catch(t){process.env.NODE_ENV}})},t.prototype.once=function(t,i){var n=this,e=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];i.apply(void 0,c([],a(r),!1)),n.off(t,e)};this.on(t,e)},t.prototype.removeAllListeners=function(t){t?this.Y.delete(t):this.Y.clear()},t.prototype.listenerCount=function(t){var i=this.Y.get(t);return i?i.length:0},t.prototype.eventNames=function(){return Array.from(this.Y.keys())},t}(),z=function(){return p()&&"performance"in window&&performance.now?performance.now():Date.now()},A=function(){return Math.random().toString(36).substr(2,9)},D=function(t){function i(i){void 0===i&&(i={});var n=t.call(this)||this;return n.name="PerformanceOptimizer",n.$=!1,n.K=!1,n.Z=new Map,n.tt=new Set,n.it=new Map,n.nt=new Map,n.et=new Set,n.rt=[],n.memoryThresholds={warning:50,critical:75},n.ot=[],n.lastGC=0,n.st=[],n.ct=[],n.ut=!1,n.currentThrottle=0,n.ht=new Map,n.ft=[],n.lastFlush=0,n.lt={lcp:0,fid:0,cls:0},n.dt=[],n.vt=new Map,n.yt=new Set,n.gt=new Set,n.wt=new Map,n.startTime=0,n.I=n.bt(i),n.kt=n.St(),n._t=n.xt(),n}return n(i,t),i.prototype.bt=function(t){var i,n,e,r,o,s,a,c,u,h,f,l,d,v,m,p,y,g,w,b,k,S,_,x,T,P,I,j,O,C,M,z,A,D,R,E,q,N,G,W,U,V,L,J,B,F,H,Q,X,Y,$,K,Z,tt,it,nt,et,rt,ot,st,at,ct,ut,ht,ft,lt,dt,vt,mt,pt,yt,gt,wt,bt,kt,St,_t,xt,Tt,Pt,It;return{enabled:null===(i=t.enabled)||void 0===i||i,lazyLoading:{enabled:null===(e=null===(n=t.lazyLoading)||void 0===n?void 0:n.enabled)||void 0===e||e,threshold:null!==(o=null===(r=t.lazyLoading)||void 0===r?void 0:r.threshold)&&void 0!==o?o:51200,modules:null!==(a=null===(s=t.lazyLoading)||void 0===s?void 0:s.modules)&&void 0!==a?a:[],chunkSize:null!==(u=null===(c=t.lazyLoading)||void 0===c?void 0:c.chunkSize)&&void 0!==u?u:102400},codesplitting:{enabled:null===(f=null===(h=t.codesplitting)||void 0===h?void 0:h.enabled)||void 0===f||f,splitPoints:null!==(d=null===(l=t.codesplitting)||void 0===l?void 0:l.splitPoints)&&void 0!==d?d:[],dynamicImports:null===(m=null===(v=t.codesplitting)||void 0===v?void 0:v.dynamicImports)||void 0===m||m,preloadCritical:null===(y=null===(p=t.codesplitting)||void 0===p?void 0:p.preloadCritical)||void 0===y||y},memoryManagement:{enabled:null===(w=null===(g=t.memoryManagement)||void 0===g?void 0:g.enabled)||void 0===w||w,maxMemoryUsage:null!==(k=null===(b=t.memoryManagement)||void 0===b?void 0:b.maxMemoryUsage)&&void 0!==k?k:100,gcInterval:null!==(_=null===(S=t.memoryManagement)||void 0===S?void 0:S.gcInterval)&&void 0!==_?_:3e4,leakDetection:null===(T=null===(x=t.memoryManagement)||void 0===x?void 0:x.leakDetection)||void 0===T||T,autoCleanup:null===(I=null===(P=t.memoryManagement)||void 0===P?void 0:P.autoCleanup)||void 0===I||I,memoryThreshold:null!==(O=null===(j=t.memoryManagement)||void 0===j?void 0:j.memoryThreshold)&&void 0!==O?O:80},cpuThrottling:{enabled:null===(M=null===(C=t.cpuThrottling)||void 0===C?void 0:C.enabled)||void 0===M||M,maxCpuUsage:null!==(A=null===(z=t.cpuThrottling)||void 0===z?void 0:z.maxCpuUsage)&&void 0!==A?A:70,throttleInterval:null!==(R=null===(D=t.cpuThrottling)||void 0===D?void 0:D.throttleInterval)&&void 0!==R?R:100,adaptiveThrottling:null===(q=null===(E=t.cpuThrottling)||void 0===E?void 0:E.adaptiveThrottling)||void 0===q||q,priorityQueue:null===(G=null===(N=t.cpuThrottling)||void 0===N?void 0:N.priorityQueue)||void 0===G||G},requestBatching:{enabled:null===(U=null===(W=t.requestBatching)||void 0===W?void 0:W.enabled)||void 0===U||U,batchSize:null!==(L=null===(V=t.requestBatching)||void 0===V?void 0:V.batchSize)&&void 0!==L?L:10,flushInterval:null!==(B=null===(J=t.requestBatching)||void 0===J?void 0:J.flushInterval)&&void 0!==B?B:5e3,maxBatchAge:null!==(H=null===(F=t.requestBatching)||void 0===F?void 0:F.maxBatchAge)&&void 0!==H?H:3e4,priorityBatching:null===(X=null===(Q=t.requestBatching)||void 0===Q?void 0:Q.priorityBatching)||void 0===X||X,compression:null===($=null===(Y=t.requestBatching)||void 0===Y?void 0:Y.compression)||void 0===$||$},coreWebVitals:{enabled:null===(Z=null===(K=t.coreWebVitals)||void 0===K?void 0:K.enabled)||void 0===Z||Z,lcpThreshold:null!==(it=null===(tt=t.coreWebVitals)||void 0===tt?void 0:tt.lcpThreshold)&&void 0!==it?it:2500,fidThreshold:null!==(et=null===(nt=t.coreWebVitals)||void 0===nt?void 0:nt.fidThreshold)&&void 0!==et?et:100,clsThreshold:null!==(ot=null===(rt=t.coreWebVitals)||void 0===rt?void 0:rt.clsThreshold)&&void 0!==ot?ot:.1,monitoring:null===(at=null===(st=t.coreWebVitals)||void 0===st?void 0:st.monitoring)||void 0===at||at,optimization:null===(ut=null===(ct=t.coreWebVitals)||void 0===ct?void 0:ct.optimization)||void 0===ut||ut},resourcePrioritization:{enabled:null===(ft=null===(ht=t.resourcePrioritization)||void 0===ht?void 0:ht.enabled)||void 0===ft||ft,criticalResources:null!==(dt=null===(lt=t.resourcePrioritization)||void 0===lt?void 0:lt.criticalResources)&&void 0!==dt?dt:[],preloadThreshold:null!==(mt=null===(vt=t.resourcePrioritization)||void 0===vt?void 0:vt.preloadThreshold)&&void 0!==mt?mt:1e3,deferNonCritical:null===(yt=null===(pt=t.resourcePrioritization)||void 0===pt?void 0:pt.deferNonCritical)||void 0===yt||yt,adaptivePriority:null===(wt=null===(gt=t.resourcePrioritization)||void 0===gt?void 0:gt.adaptivePriority)||void 0===wt||wt},crossPlatform:{enabled:null===(kt=null===(bt=t.crossPlatform)||void 0===bt?void 0:bt.enabled)||void 0===kt||kt,frameworkOptimizations:null!==(_t=null===(St=t.crossPlatform)||void 0===St?void 0:St.frameworkOptimizations)&&void 0!==_t?_t:{},universalPolyfills:null===(Tt=null===(xt=t.crossPlatform)||void 0===xt?void 0:xt.universalPolyfills)||void 0===Tt||Tt,adaptiveLoading:null===(It=null===(Pt=t.crossPlatform)||void 0===Pt?void 0:Pt.adaptiveLoading)||void 0===It||It}}},i.prototype.St=function(){return{loadTime:0,domReady:0,firstPaint:0,firstContentfulPaint:0,largestContentfulPaint:0,firstInputDelay:0,cumulativeLayoutShift:0,totalBlockingTime:0,timeToInteractive:0,memoryUsage:{used:0,total:0,limit:1024*this.I.memoryManagement.maxMemoryUsage*1024},cpuUsage:0,networkStats:{requests:0,bytesTransferred:0,averageLatency:0},scriptPerformance:{initTime:0,executionTime:0,moduleLoadTimes:{}}}},i.prototype.xt=function(){return{memory:{warning:this.I.memoryManagement.memoryThreshold,critical:this.I.memoryManagement.maxMemoryUsage},cpu:{warning:.8*this.I.cpuThrottling.maxCpuUsage,critical:this.I.cpuThrottling.maxCpuUsage},network:{latency:500,bandwidth:1048576},coreWebVitals:{lcp:this.I.coreWebVitals.lcpThreshold,fid:this.I.coreWebVitals.fidThreshold,cls:this.I.coreWebVitals.clsThreshold}}},i.prototype.init=function(){if(!this.K&&this.I.enabled)try{this.I.lazyLoading.enabled&&this.Tt(),this.I.codesplitting.enabled&&this.Pt(),this.I.memoryManagement.enabled&&this.It(),this.I.cpuThrottling.enabled&&this.jt(),this.I.requestBatching.enabled&&this.Ot(),this.I.coreWebVitals.enabled&&this.Ct(),this.I.resourcePrioritization.enabled&&this.Mt(),this.I.crossPlatform.enabled&&this.zt(),this.At(),this.Dt(),this.K=!0,this.emit("performance:initialized",{config:this.I})}catch(t){this.emit("performance:error",t)}},i.prototype.destroy=function(){this.stopMonitoring(),this.Rt&&clearInterval(this.Rt),this.Et&&clearInterval(this.Et),this.qt&&clearInterval(this.qt),this.Nt&&this.Nt.disconnect(),this.B&&this.B.disconnect(),this.Gt&&this.Gt.disconnect(),this.Z.clear(),this.tt.clear(),this.it.clear(),this.nt.clear(),this.et.clear(),this.rt=[],this.ot=[],this.st=[],this.ct=[],this.ht.clear(),this.ft=[],this.vt.clear(),this.yt.clear(),this.gt.clear(),this.wt.clear(),this.K=!1,this.emit("performance:destroyed")},i.prototype.configure=function(t){this.I=e(e({},this.I),t),this._t=this.xt(),this.K&&(this.destroy(),this.init()),this.emit("performance:configured",{config:this.I})},i.prototype.getConfig=function(){return e({},this.I)},i.prototype.Tt=function(){var t=this;this.I.lazyLoading.modules.forEach(function(i){t.registerLazyModule({name:i,size:0,priority:"normal",dependencies:[],loader:function(){return r(t,void 0,void 0,function(){return o(this,function(t){return[2,import(i)]})})},loaded:!1})})},i.prototype.registerLazyModule=function(t){this.Z.set(t.name,t),this.emit("performance:module_registered",{module:t.name})},i.prototype.loadModule=function(t){return r(this,void 0,void 0,function(){var i,n,e,r,s,a,c;return o(this,function(o){switch(o.label){case 0:if(!(i=this.Z.get(t)))throw new Error("Module '".concat(t,"' not registered for lazy loading"));if(i.loaded)return[2,i];if(n=this.it.get(t))return[2,n];e=z(),r=this.Wt(i),this.it.set(t,r),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,r];case 2:return s=o.sent(),a=z()-e,i.loaded=!0,i.loadTime=a,this.tt.add(t),this.it.delete(t),this.kt.scriptPerformance&&(this.kt.scriptPerformance.moduleLoadTimes[t]=a),this.emit("performance:module_loaded",{module:t,loadTime:a,size:i.size}),[2,s];case 3:throw c=o.sent(),this.it.delete(t),this.emit("performance:module_error",{module:t,error:c}),c;case 4:return[2]}})})},i.prototype.Wt=function(t){return r(this,void 0,void 0,function(){var i,n,e,r,a,c;return o(this,function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),i=s(t.dependencies),n=i.next(),o.label=1;case 1:return n.done?[3,4]:(e=n.value,this.tt.has(e)?[3,3]:[4,this.loadModule(e)]);case 2:o.sent(),o.label=3;case 3:return n=i.next(),[3,1];case 4:return[3,7];case 5:return r=o.sent(),a={error:r},[3,7];case 6:try{n&&!n.done&&(c=i.return)&&c.call(i)}finally{if(a)throw a.error}return[7];case 7:return[2,t.loader()]}})})},i.prototype.preloadModules=function(t){return r(this,void 0,void 0,function(){var i,n=this;return o(this,function(e){switch(e.label){case 0:return i=t.map(function(t){return n.loadModule(t)}),[4,Promise.all(i)];case 1:return e.sent(),this.emit("performance:modules_preloaded",{modules:t}),[2]}})})},i.prototype.Pt=function(){this.I.codesplitting.preloadCritical&&this.preloadCritical()},i.prototype.registerSplitPoint=function(t){this.nt.set(t.name,t),t.critical&&this.yt.add(t.name),this.emit("performance:split_point_registered",{splitPoint:t.name})},i.prototype.splitCode=function(){return r(this,void 0,void 0,function(){var t,i=this;return o(this,function(n){switch(n.label){case 0:return t=[],Array.from(this.nt.entries()).forEach(function(n){var e=a(n,2),r=e[0],o=e[1];if(!i.et.has(r)&&o.condition()){var s=i.Ut(o);t.push(s)}}),[4,Promise.all(t)];case 1:return n.sent(),this.emit("performance:code_split_complete"),[2]}})})},i.prototype.Ut=function(t){return r(this,void 0,void 0,function(){var i,n,e,r,s=this;return o(this,function(o){switch(o.label){case 0:i=z(),o.label=1;case 1:return o.trys.push([1,3,,4]),n=t.modules.map(function(t){return s.loadModule(t)}),[4,Promise.all(n)];case 2:return o.sent(),this.et.add(t.name),e=z()-i,this.emit("performance:split_point_loaded",{splitPoint:t.name,loadTime:e,modules:t.modules}),[3,4];case 3:throw r=o.sent(),this.emit("performance:split_point_error",{splitPoint:t.name,error:r}),r;case 4:return[2]}})})},i.prototype.preloadCritical=function(){return r(this,void 0,void 0,function(){var t,i,n=this;return o(this,function(e){switch(e.label){case 0:return t=Array.from(this.nt.values()).filter(function(t){return t.critical||t.preload}),i=t.map(function(t){return n.Ut(t)}),[4,Promise.all(i)];case 1:return e.sent(),this.emit("performance:critical_preloaded",{count:t.length}),[2]}})})},i.prototype.It=function(){var t=this;this.I.memoryManagement.autoCleanup&&(this.gcInterval=window.setInterval(function(){t.Vt()},this.I.memoryManagement.gcInterval)),this.I.memoryManagement.leakDetection&&this.Lt()},i.prototype.getMemoryUsage=function(){var t={timestamp:z(),heapUsed:0,heapTotal:0,external:0};if(p()&&"memory"in performance){var i=performance.memory;t.heapUsed=i.usedJSHeapSize||0,t.heapTotal=i.totalJSHeapSize||0,t.external=i.totalJSHeapSize-i.usedJSHeapSize||0}return this.I.memoryManagement.leakDetection&&(t.leaks=this.detectMemoryLeaks()),this.rt.push(t),this.rt.length>100&&(this.rt=this.rt.slice(-100)),t},i.prototype.detectMemoryLeaks=function(){var t=[];if(this.rt.length<5)return t;var i=this.rt.slice(-5);if(i.every(function(t,n){return 0===n||t.heapUsed>i[n-1].heapUsed})){var n=i[i.length-1].heapUsed-i[0].heapUsed;n>10485760&&t.push({type:"memory_growth",size:n,location:"heap",timestamp:z(),stack:(new Error).stack||"No stack trace available"})}return this.ot=t,t},i.prototype.cleanup=function(){var t,i;this.rt=this.rt.slice(-10),this.st=this.st.slice(-10),this.dt=this.dt.slice(-10);try{for(var n=s(this.ht),e=n.next();!e.done;e=n.next()){var r=a(e.value,2),o=r[0];r[1].createdAt<z()-this.I.requestBatching.maxBatchAge&&this.ht.delete(o)}}catch(i){t={error:i}}finally{try{e&&!e.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}this.emit("performance:cleanup_complete")},i.prototype.forceGarbageCollection=function(){this.Vt()},i.prototype.Vt=function(){var t=this.getMemoryUsage();this.cleanup(),"gc"in window&&"function"==typeof window.gc&&window.gc();var i=this.getMemoryUsage(),n=t.heapUsed-i.heapUsed;this.lastGC=z(),this.emit("performance:gc_performed",{freed:n,before:t,after:i})},i.prototype.Lt=function(){var t=this;setInterval(function(){var i=t.getMemoryUsage(),n=1024*t._t.memory.warning*1024;i.heapUsed>n&&t.emit("performance:memory_warning",{usage:i.heapUsed,threshold:n,leaks:i.leaks})},1e4)},i.prototype.jt=function(){this.I.cpuThrottling.priorityQueue&&this.Jt(),this.I.cpuThrottling.adaptiveThrottling&&this.Bt()},i.prototype.getCpuUsage=function(){var t={timestamp:z(),usage:0,tasks:[],throttled:this.ut};return this.ct.length>0&&(t.usage=Math.min(10*this.ct.length,100)),this.st.push(t),this.st.length>50&&(this.st=this.st.slice(-50)),t},i.prototype.throttleCpu=function(t){var i=this;this.ut=t,t&&!this.Rt?this.Rt=window.setInterval(function(){i.Ft()},this.I.cpuThrottling.throttleInterval):!t&&this.Rt&&(clearInterval(this.Rt),this.Rt=void 0),this.emit("performance:cpu_throttling_changed",{enabled:t})},i.prototype.queueTask=function(t,i){this.ct.push({fn:t,priority:i}),this.ct.sort(function(t,i){var n={critical:4,high:3,normal:2,low:1};return n[i.priority]-n[t.priority]}),this.emit("performance:task_queued",{priority:i,queueSize:this.ct.length})},i.prototype.Jt=function(){this.throttleCpu(!0)},i.prototype.Bt=function(){var t=this;setInterval(function(){var i=t.getCpuUsage(),n=t._t.cpu.warning;i.usage>n&&!t.ut?(t.throttleCpu(!0),t.emit("performance:cpu_throttling_activated",{usage:i.usage,threshold:n})):i.usage<.5*n&&t.ut&&(t.throttleCpu(!1),t.emit("performance:cpu_throttling_deactivated",{usage:i.usage}))},5e3)},i.prototype.Ft=function(){var t=this;if(0!==this.ct.length){var i=this.ut?2:5;this.ct.splice(0,i).forEach(function(i){var n=i.fn;try{n()}catch(i){t.emit("performance:task_error",{error:i})}})}},i.prototype.Ot=function(){var t=this;this.Et=window.setInterval(function(){t.Ht()},this.I.requestBatching.flushInterval)},i.prototype.addRequest=function(t){var i=e(e({},t),{id:A(),timestamp:z()});return this.ft.push(i),this.Qt(i),this.emit("performance:request_queued",{requestId:i.id}),i.id},i.prototype.Qt=function(t){var i,n,e;try{for(var r=s(this.ht.values()),o=r.next();!o.done;o=r.next()){var a=o.value;if(a.priority===t.priority&&a.requests.length<this.I.requestBatching.batchSize){e=a;break}}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}e||(e={id:A(),requests:[],size:0,priority:t.priority,createdAt:z(),flushAt:z()+this.I.requestBatching.flushInterval,compressed:this.I.requestBatching.compression},this.ht.set(e.id,e)),e.requests.push(t),e.size+=JSON.stringify(t.data).length,e.requests.length>=this.I.requestBatching.batchSize&&this.flushBatch(e.id)},i.prototype.flushBatch=function(t){return r(this,void 0,void 0,function(){var i,n,e=this;return o(this,function(r){switch(r.label){case 0:return t?(i=this.ht.get(t))?[4,this.Xt(i)]:[3,2]:[3,3];case 1:r.sent(),this.ht.delete(t),r.label=2;case 2:return[3,5];case 3:return n=Array.from(this.ht.values()).map(function(t){return e.Xt(t)}),[4,Promise.all(n)];case 4:r.sent(),this.ht.clear(),r.label=5;case 5:return this.lastFlush=z(),[2]}})})},i.prototype.Xt=function(t){return r(this,void 0,void 0,function(){return o(this,function(i){try{this.emit("performance:batch_sent",{batchId:t.id,requestCount:t.requests.length,size:t.size})}catch(i){this.emit("performance:batch_error",{batchId:t.id,error:i})}return[2]})})},i.prototype.Ht=function(){var t,i,n=z();try{for(var e=s(this.ht),r=e.next();!r.done;r=e.next()){var o=a(r.value,2),c=o[0];n>=o[1].flushAt&&this.flushBatch(c)}}catch(i){t={error:i}}finally{try{r&&!r.done&&(i=e.return)&&i.call(e)}finally{if(t)throw t.error}}},i.prototype.getBatchStatus=function(){return Array.from(this.ht.values())},i.prototype.Ct=function(){p()&&this.I.coreWebVitals.monitoring&&this.Yt()},i.prototype.Yt=function(){var t=this;if("undefined"!=typeof PerformanceObserver){try{new PerformanceObserver(function(i){var n=i.getEntries(),e=n[n.length-1];t.lt.lcp=e.startTime,t.$t()}).observe({entryTypes:["largest-contentful-paint"]})}catch(t){}try{new PerformanceObserver(function(i){i.getEntries().forEach(function(i){i.processingStart-i.startTime>0&&(t.lt.fid=i.processingStart-i.startTime,t.$t())})}).observe({entryTypes:["first-input"]})}catch(t){}try{new PerformanceObserver(function(i){var n=0;i.getEntries().forEach(function(t){t.hadRecentInput||(n+=t.value)}),t.lt.cls=n,t.$t()}).observe({entryTypes:["layout-shift"]})}catch(t){}}},i.prototype.$t=function(){this.dt.push(e({},this.lt)),this.dt.length>50&&(this.dt=this.dt.slice(-50)),this.emit("performance:core_web_vitals_updated",this.lt)},i.prototype.measureCoreWebVitals=function(){return r(this,void 0,void 0,function(){var t=this;return o(this,function(i){return[2,new Promise(function(i){setTimeout(function(){i(e({},t.lt))},100)})]})})},i.prototype.optimizeCoreWebVitals=function(){this.lt.lcp&&this.lt.lcp>this._t.coreWebVitals.lcp&&(this.preloadCriticalResources(),this.emit("performance:lcp_optimization_applied")),this.lt.fid&&this.lt.fid>this._t.coreWebVitals.fid&&(this.throttleCpu(!0),this.emit("performance:fid_optimization_applied")),this.lt.cls&&this.lt.cls>this._t.coreWebVitals.cls&&(this.deferNonCriticalResources(),this.emit("performance:cls_optimization_applied"))},i.prototype.getCoreWebVitalsReport=function(){return e({},this.lt)},i.prototype.Mt=function(){var t=this;this.I.resourcePrioritization.criticalResources.forEach(function(i){t.prioritizeResource({resource:i,priority:"critical",timing:"preload"})})},i.prototype.prioritizeResource=function(t){this.vt.set(t.resource,t),"critical"===t.priority&&this.yt.add(t.resource),"defer"!==t.timing&&"lazy"!==t.timing||this.gt.add(t.resource),this.emit("performance:resource_prioritized",{resource:t.resource,priority:t.priority})},i.prototype.preloadCriticalResources=function(){return r(this,void 0,void 0,function(){var t,i,n,e,r,a,c;return o(this,function(o){switch(o.label){case 0:if(!p())return[2];t=[];try{for(i=s(this.yt),n=i.next();!n.done;n=i.next())e=n.value,"preload"===(null==(r=this.vt.get(e))?void 0:r.timing)&&t.push(this.Kt(e))}catch(t){a={error:t}}finally{try{n&&!n.done&&(c=i.return)&&c.call(i)}finally{if(a)throw a.error}}return[4,Promise.all(t)];case 1:return o.sent(),this.emit("performance:critical_resources_preloaded",{count:t.length}),[2]}})})},i.prototype.Kt=function(t){return r(this,void 0,void 0,function(){return o(this,function(i){return[2,new Promise(function(i){var n=document.createElement("link");n.rel="preload",n.href=t,n.onload=function(){return i()},n.onerror=function(){return i()},document.head.appendChild(n)})]})})},i.prototype.deferNonCriticalResources=function(){var t=this;p()&&(this.gt.forEach(function(i){var n=t.vt.get(i);(null==n?void 0:n.condition)&&!n.condition()||t.Zt(i)}),this.emit("performance:non_critical_resources_deferred"))},i.prototype.Zt=function(t){var i=this;requestIdleCallback(function(){i.emit("performance:deferred_resource_loaded",{resource:t})})},i.prototype.zt=function(){this.I.crossPlatform.universalPolyfills&&this.enableUniversalPolyfills()},i.prototype.optimizeForPlatform=function(t,i){this.ti=t,this.currentFramework=i||void 0;var n={platform:t,framework:i||"unknown",optimizations:this.I.crossPlatform.frameworkOptimizations[t]||{},polyfills:[],fallbacks:[]};this.wt.set(t,n),this.emit("performance:platform_optimized",{platform:t,framework:i})},i.prototype.enableUniversalPolyfills=function(){var t=this;p()&&(["requestIdleCallback","IntersectionObserver","PerformanceObserver","ResizeObserver"].forEach(function(i){i in window||t.ii(i)}),this.emit("performance:universal_polyfills_enabled"))},i.prototype.ii=function(t){"requestIdleCallback"===t&&("requestIdleCallback"in window||(window.requestIdleCallback=function(t){return setTimeout(t,0)}))},i.prototype.At=function(){if(p()){var t=navigator.userAgent.toLowerCase();t.includes("react")?this.ti="react":t.includes("vue")?this.ti="vue":t.includes("angular")?this.ti="angular":this.ti="vanilla",this.optimizeForPlatform(this.ti)}else this.ti="server"},i.prototype.Dt=function(){var t=this;if(p()){var i=z();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t.kt.domReady=z()-i}):this.kt.domReady=0,"complete"!==document.readyState&&window.addEventListener("load",function(){t.kt.loadTime=z()-i}),"performance"in window&&performance.getEntriesByType&&performance.getEntriesByType("paint").forEach(function(i){"first-paint"===i.name?t.kt.firstPaint=i.startTime:"first-contentful-paint"===i.name&&(t.kt.firstContentfulPaint=i.startTime)})}},i.prototype.startMonitoring=function(){var t=this;this.$||(this.$=!0,this.qt=window.setInterval(function(){t.ni()},5e3),this.emit("performance:monitoring_started"))},i.prototype.stopMonitoring=function(){this.$&&(this.$=!1,this.qt&&(clearInterval(this.qt),this.qt=void 0),this.emit("performance:monitoring_stopped"))},i.prototype.ni=function(){var t=this.getMemoryUsage();this.kt.memoryUsage&&(this.kt.memoryUsage.used=t.heapUsed,this.kt.memoryUsage.total=t.heapTotal);var i=this.getCpuUsage();this.kt.cpuUsage=i.usage,this.emit("performance:metrics_updated",this.kt)},i.prototype.getMetrics=function(){return e({},this.kt)},i.prototype.getThresholds=function(){return e({},this._t)},i.prototype.setThresholds=function(t){this._t=e(e({},this._t),t),this.emit("performance:thresholds_updated",this._t)},i.prototype.getOptimizationReport=function(){var t=this.ei(),i=this.ri(),n=this.oi(),e=this.si(n);return{timestamp:z(),metrics:this.kt,thresholds:this._t,violations:t,optimizations:i,score:n,grade:e}},i.prototype.ei=function(){var t=[];return this.kt.memoryUsage&&this.kt.memoryUsage.used>1024*this._t.memory.critical*1024&&t.push({type:"memory",severity:"critical",message:"Memory usage exceeds critical threshold",value:this.kt.memoryUsage.used,threshold:1024*this._t.memory.critical*1024,timestamp:z()}),this.kt.cpuUsage&&this.kt.cpuUsage>this._t.cpu.critical&&t.push({type:"cpu",severity:"critical",message:"CPU usage exceeds critical threshold",value:this.kt.cpuUsage,threshold:this._t.cpu.critical,timestamp:z()}),this.lt.lcp&&this.lt.lcp>this._t.coreWebVitals.lcp&&t.push({type:"core-web-vitals",severity:"high",message:"Largest Contentful Paint exceeds threshold",value:this.lt.lcp,threshold:this._t.coreWebVitals.lcp,timestamp:z()}),t},i.prototype.ri=function(){var t=this,i=[];return this.ot.length>0&&i.push({type:"memory",priority:"high",message:"Memory leaks detected - enable garbage collection",impact:"high",effort:"low",action:function(){return t.forceGarbageCollection()}}),this.tt.size<this.Z.size/2&&i.push({type:"lazy-loading",priority:"medium",message:"Enable lazy loading for better performance",impact:"medium",effort:"low",action:function(){return t.preloadModules(Array.from(t.Z.keys()))}}),i},i.prototype.oi=function(){var t=100;return this.ei().forEach(function(i){switch(i.severity){case"critical":t-=20;break;case"high":t-=15;break;case"medium":t-=10;break;case"low":t-=5}}),this.lt.lcp&&this.lt.lcp>4e3&&(t-=10),this.lt.fid&&this.lt.fid>300&&(t-=10),this.lt.cls&&this.lt.cls>.25&&(t-=10),Math.max(0,t)},i.prototype.si=function(t){return t>=90?"A":t>=80?"B":t>=70?"C":t>=60?"D":"F"},i}(M),R=function(){function t(){this.name="TechnologyDetector",this.ai=!1,this.ci=new Map,this.ui=[],this.hi()}return t.prototype.init=function(){p()&&(this.ai=!0,this.fi())},t.prototype.enable=function(){this.ai=!0},t.prototype.disable=function(){this.ai=!1},t.prototype.destroy=function(){this.ai=!1,this.ci.clear()},t.prototype.getCurrentTechStack=function(){return this.ci.get(window.location.hostname)||this.fi()},t.prototype.redetect=function(){return this.ci.delete(window.location.hostname),this.fi()},t.prototype.fi=function(){var t,i,n,e,r,o;if(!p()||!this.ai)return{};var a={analytics:[],libraries:[]};try{for(var c=s(this.ui),u=c.next();!u.done;u=c.next()){var h=u.value;if(this.li(h)>.5)switch(h.category){case"cms":a.cms=h.name;break;case"framework":a.framework=h.name;break;case"analytics":(null===(n=a.analytics)||void 0===n?void 0:n.includes(h.name))||null===(e=a.analytics)||void 0===e||e.push(h.name);break;case"library":(null===(r=a.libraries)||void 0===r?void 0:r.includes(h.name))||null===(o=a.libraries)||void 0===o||o.push(h.name);break;case"server":a.server=h.name;break;case"hosting":a.hosting=h.name}}}catch(i){t={error:i}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(t)throw t.error}}return this.ci.set(window.location.hostname,a),a},t.prototype.li=function(t){var i,n,e,r,o,a,c,u,h,f,l,d,v=0,m=0,p=0;if(t.checks.dom){m+=t.checks.dom.length;try{for(var y=s(t.checks.dom),g=y.next();!g.done;g=y.next()){var w=g.value;document.querySelector(w)&&p++}}catch(t){i={error:t}}finally{try{g&&!g.done&&(n=y.return)&&n.call(y)}finally{if(i)throw i.error}}}if(t.checks.js){m+=t.checks.js.length;try{for(var b=s(t.checks.js),k=b.next();!k.done;k=b.next()){var S=k.value;this.di(S)&&p++}}catch(t){e={error:t}}finally{try{k&&!k.done&&(r=b.return)&&r.call(b)}finally{if(e)throw e.error}}}if(t.checks.meta){m+=t.checks.meta.length;try{for(var _=s(t.checks.meta),x=_.next();!x.done;x=_.next()){var T=x.value;this.mi(T)&&p++}}catch(t){o={error:t}}finally{try{x&&!x.done&&(a=_.return)&&a.call(_)}finally{if(o)throw o.error}}}if(t.checks.text){m+=t.checks.text.length;try{for(var P=s(t.checks.text),I=P.next();!I.done;I=P.next()){var j=I.value;document.documentElement.outerHTML.includes(j)&&p++}}catch(t){c={error:t}}finally{try{I&&!I.done&&(u=P.return)&&u.call(P)}finally{if(c)throw c.error}}}if(t.checks.url){m+=t.checks.url.length;try{for(var O=s(t.checks.url),C=O.next();!C.done;C=O.next()){var M=C.value;this.pi(M)&&p++}}catch(t){h={error:t}}finally{try{C&&!C.done&&(f=O.return)&&f.call(O)}finally{if(h)throw h.error}}}if(t.checks.cookies){m+=t.checks.cookies.length;try{for(var z=s(t.checks.cookies),A=z.next();!A.done;A=z.next()){var D=A.value;this.yi(D)&&p++}}catch(t){l={error:t}}finally{try{A&&!A.done&&(d=z.return)&&d.call(z)}finally{if(l)throw l.error}}}return m>0&&(v=p/m*t.confidence),v},t.prototype.di=function(t){var i,n;try{var e=t.split("."),r=window;try{for(var o=s(e),a=o.next();!a.done;a=o.next()){var c=a.value;if(!r||"object"!=typeof r||!(c in r))return!1;r=r[c]}}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return void 0!==r}catch(t){return!1}},t.prototype.mi=function(t){var i,n,e=Array.from(document.querySelectorAll("meta"));try{for(var r=s(e),o=r.next();!o.done;o=r.next()){var a=o.value,c=a.getAttribute("name")||a.getAttribute("property")||"",u=a.getAttribute("content")||"";if(c.includes(t)||u.includes(t))return!0}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return!1},t.prototype.pi=function(t){var i,n,e,r,o=Array.from(document.querySelectorAll("script[src]"));try{for(var a=s(o),c=a.next();!c.done;c=a.next())if((c.value.getAttribute("src")||"").includes(t))return!0}catch(t){i={error:t}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}var u=Array.from(document.querySelectorAll("link[href]"));try{for(var h=s(u),f=h.next();!f.done;f=h.next())if((f.value.getAttribute("href")||"").includes(t))return!0}catch(t){e={error:t}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(e)throw e.error}}return!1},t.prototype.yi=function(t){return document.cookie.includes(t)},t.prototype.hi=function(){this.ui=[{name:"WordPress",category:"cms",confidence:1,checks:{meta:["generator"],text:["wp-content","wp-includes"],js:["wp"]}},{name:"Shopify",category:"cms",confidence:1,checks:{js:["Shopify"],text:["shopify"],meta:["shopify"]}},{name:"Drupal",category:"cms",confidence:1,checks:{meta:["generator"],text:["/sites/default/","Drupal.settings"],js:["Drupal"]}},{name:"Squarespace",category:"cms",confidence:1,checks:{text:["squarespace"],url:["squarespace"]}},{name:"Webflow",category:"cms",confidence:1,checks:{text:["webflow"],url:["webflow"]}},{name:"React",category:"framework",confidence:.9,checks:{js:["React","ReactDOM"],text:["react","data-reactroot"]}},{name:"Vue.js",category:"framework",confidence:.9,checks:{js:["Vue"],text:["vue"]}},{name:"Angular",category:"framework",confidence:.9,checks:{js:["ng","angular"],text:["ng-app","ng-controller"]}},{name:"Next.js",category:"framework",confidence:1,checks:{js:["__NEXT_DATA__"],text:["_next/static"]}},{name:"Nuxt.js",category:"framework",confidence:1,checks:{js:["__NUXT__"],text:["_nuxt/"]}},{name:"Svelte",category:"framework",confidence:.9,checks:{text:["svelte"]}},{name:"Google Analytics",category:"analytics",confidence:1,checks:{js:["gtag","ga","GoogleAnalyticsObject"],url:["google-analytics.com","googletagmanager.com"]}},{name:"Google Tag Manager",category:"analytics",confidence:1,checks:{js:["dataLayer"],url:["googletagmanager.com"]}},{name:"Mixpanel",category:"analytics",confidence:1,checks:{js:["mixpanel"],url:["mixpanel.com"]}},{name:"Amplitude",category:"analytics",confidence:1,checks:{js:["amplitude"],url:["amplitude.com"]}},{name:"Segment",category:"analytics",confidence:1,checks:{js:["analytics"],url:["segment.com","segment.io"]}},{name:"Adobe Analytics",category:"analytics",confidence:1,checks:{js:["s_account","_satellite"],url:["omtrdc.net","demdex.net"]}},{name:"Hotjar",category:"analytics",confidence:1,checks:{js:["hj"],url:["hotjar.com"]}},{name:"Facebook Pixel",category:"analytics",confidence:1,checks:{js:["fbq"],url:["facebook.net"]}},{name:"jQuery",category:"library",confidence:1,checks:{js:["jQuery","$"]}},{name:"Lodash",category:"library",confidence:1,checks:{js:["_"]}},{name:"D3.js",category:"library",confidence:1,checks:{js:["d3"]}},{name:"Chart.js",category:"library",confidence:1,checks:{js:["Chart"]}},{name:"Bootstrap",category:"library",confidence:.8,checks:{dom:[".container",".row",".col"],text:["bootstrap"]}},{name:"Tailwind CSS",category:"library",confidence:.8,checks:{dom:['[class*="tw-"]','[class*="bg-"]','[class*="text-"]'],text:["tailwind"]}},{name:"WooCommerce",category:"ecommerce",confidence:1,checks:{text:["woocommerce","wc-"],dom:[".woocommerce"]}},{name:"Magento",category:"ecommerce",confidence:1,checks:{text:["magento","Mage."],js:["Mage"]}},{name:"Cloudflare",category:"hosting",confidence:.7,checks:{text:["cloudflare"],url:["cloudflare"]}},{name:"AWS CloudFront",category:"hosting",confidence:.7,checks:{url:["cloudfront.net"]}},{name:"Netlify",category:"hosting",confidence:1,checks:{text:["netlify"],url:["netlify"]}},{name:"Vercel",category:"hosting",confidence:1,checks:{text:["vercel"],url:["vercel"]}}]},t}(),E=function(t){function i(i){void 0===i&&(i={});var n=t.call(this)||this;return n.name="WebSocketManager",n.gi=null,n.wi=[],n.bi=null,n.ki=null,n.Si=null,n._i=null,n.xi=null,n.Ti=0,n.Pi=!1,n.Ii=new Map,n.I={url:i.url||"",protocols:i.protocols||[],reconnect:!1!==i.reconnect,reconnectInterval:i.reconnectInterval||5e3,maxReconnectAttempts:i.maxReconnectAttempts||10,heartbeatInterval:i.heartbeatInterval||3e4,messageQueueSize:i.messageQueueSize||1e3,enableCompression:!1!==i.enableCompression,enableFallback:!1!==i.enableFallback,fallbackUrl:i.fallbackUrl||"",timeout:i.timeout||1e4,debug:i.debug||!1},n.ji={status:"disconnected",url:n.I.url,reconnectAttempts:0},n.kt={messagesSet:0,messagesReceived:0,reconnections:0,errors:0,averageLatency:0,uptime:0,lastActivity:0},n.Oi={interval:n.I.heartbeatInterval,timeout:5e3,maxMissed:3,enabled:!0},n.I.enableFallback&&n.I.fallbackUrl&&(n.bi={type:"http",url:n.I.fallbackUrl,enabled:!0,retryInterval:1e4}),n}return n(i,t),i.prototype.init=function(){p()?(this.Ci(),this.I.debug):this.I.debug},i.prototype.setSessionContext=function(t,i){this.Mi=t,this.zi=i},i.prototype.connect=function(t){return r(this,void 0,void 0,function(){var i,n,r=this;return o(this,function(o){if(this.Pi)throw new Error("WebSocketManager has been destroyed");if(!(i=t||this.I.url))throw new Error("WebSocket URL is required");return(null===(n=this.gi)||void 0===n?void 0:n.readyState)===WebSocket.OPEN&&this.ji.url===i?[2]:(this.gi&&this.Ai(),[2,new Promise(function(t,n){try{r.ji=e(e({},r.ji),{status:"connecting",url:i}),delete r.ji.lastError,r.gi=new WebSocket(i,r.I.protocols),r.gi.binaryType="arraybuffer",r.gi.onopen=function(i){r.Di(i),t()},r.gi.onclose=function(t){r.Ri(t)},r.gi.onerror=function(t){r.Ei(t),n(new Error("WebSocket connection failed"))},r.gi.onmessage=function(t){r.qi(t)},setTimeout(function(){var t;(null===(t=r.gi)||void 0===t?void 0:t.readyState)===WebSocket.CONNECTING&&(r.gi.close(),n(new Error("WebSocket connection timeout")))},r.I.timeout)}catch(t){r.ji.status="error",r.ji.lastError=t,n(t)}})])})})},i.prototype.disconnect=function(){this.gi&&this.gi.close(1e3,"Normal closure"),this.Ai(),this.ji.status="disconnected"},i.prototype.reconnect=function(){return r(this,void 0,void 0,function(){var t;return o(this,function(i){switch(i.label){case 0:if(this.ji.reconnectAttempts>=this.I.maxReconnectAttempts){if(this.I.debug,this.I.enableFallback&&this.bi)return this.Ni("Max reconnection attempts reached"),[2];throw new Error("Max reconnection attempts reached")}this.ji.status="reconnecting",this.ji.reconnectAttempts++,this.kt.reconnections++,this.emit("connection:reconnecting",this.ji),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.connect()];case 2:return i.sent(),this.ji.reconnectAttempts=0,this.emit("connection:reconnected",this.ji),[3,4];case 3:throw t=i.sent(),this.I.debug,this.Gi(),t;case 4:return[2]}})})},i.prototype.send=function(t){return r(this,void 0,void 0,function(){var i;return o(this,function(n){if(i=e(e({},t),{id:d(),timestamp:v(),sessionId:this.Mi||"unknown",visitorId:this.zi||"unknown"}),!this.isConnected)return this.Wi(i),[2,!1];try{return this.gi.send(JSON.stringify(i)),this.kt.messagesSet++,this.kt.lastActivity=v(),this.emit("message:sent",i),[2,!0]}catch(t){return this.I.debug,this.Wi(i),this.emit("message:failed",{message:i,error:t}),[2,!1]}return[2]})})},i.prototype.sendEvent=function(t,i){return r(this,arguments,void 0,function(t,i,n){return void 0===n&&(n="normal"),o(this,function(r){return[2,this.send({type:"event",data:e({event:t},i),priority:n,retry:"low"!==n})]})})},i.prototype.sendHeartbeat=function(){if(this.isConnected){var t=d(),i=v();this.Ii.set(t,i),this.send({type:"heartbeat",data:{pingId:t,timestamp:i},priority:"critical",retry:!1}),this.Ti=0,this.emit("heartbeat:sent",{timestamp:i})}},i.prototype.getConnectionState=function(){return e({},this.ji)},i.prototype.getMetrics=function(){var t=this.ji.connectedAt?v()-this.ji.connectedAt:0;return e(e({},this.kt),{uptime:t})},i.prototype.clearQueue=function(){this.wi=[]},Object.defineProperty(i.prototype,"isConnected",{get:function(){var t;return(null===(t=this.gi)||void 0===t?void 0:t.readyState)===WebSocket.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectionState",{get:function(){return this.ji},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"metrics",{get:function(){return this.getMetrics()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"queueSize",{get:function(){return this.wi.length},enumerable:!1,configurable:!0}),i.prototype.destroy=function(){this.Pi=!0,this.disconnect(),this.Ui(),this.clearQueue(),this.removeAllListeners(),this.I.debug},i.prototype.Di=function(t){this.ji=e(e({},this.ji),{status:"connected",connectedAt:v()}),delete this.ji.disconnectedAt,delete this.ji.lastError,this.Oi.enabled&&this.Vi(),this.Li(),this.emit("connection:open",this.ji),this.I.debug},i.prototype.Ri=function(t){var i="connected"===this.ji.status;this.ji=e(e({},this.ji),{status:"disconnected",disconnectedAt:v()}),this.Ai(),this.emit("connection:close",this.ji),this.I.debug,this.I.reconnect&&i&&!this.Pi&&this.Gi()},i.prototype.Ei=function(t){var i=new Error(t.message||"WebSocket error");this.ji.lastError=i,this.ji.status="error",this.kt.errors++,this.emit("connection:error",{error:i,state:this.ji}),this.I.debug},i.prototype.qi=function(t){var i;try{var n=JSON.parse(t.data);if(this.kt.messagesReceived++,this.kt.lastActivity=v(),"heartbeat"===n.type&&(null===(i=n.data)||void 0===i?void 0:i.pingId))return void this.Ji(n);if("ack"===n.type)return void this.Bi(n);this.emit("message:received",n),this.I.debug}catch(t){this.I.debug}},i.prototype.Ji=function(t){var i=t.data,n=i.pingId,e=i.timestamp;if(this.Ii.has(n)){var r=this.Ii.get(n),o=v()-r;this.ji.latency=o,this.kt.averageLatency=(this.kt.averageLatency+o)/2,this.Ii.delete(n),this.Ti=0,this.emit("heartbeat:received",{timestamp:e,latency:o})}},i.prototype.Bi=function(t){var i,n=null===(i=t.data)||void 0===i?void 0:i.messageId;n&&(this.wi=this.wi.filter(function(t){return t.id!==n}))},i.prototype.Wi=function(t){if(this.wi.length>=this.I.messageQueueSize){var i=this.wi.shift();this.emit("queue:full",{size:this.wi.length,dropped:i})}var n=e(e({},t),{attempts:0,nextRetry:v(),maxRetries:"critical"===t.priority?5:3});this.wi.push(n),this.emit("message:queued",t)},i.prototype.Li=function(){var t,i;if(this.isConnected&&0!==this.wi.length){var n=this.wi.filter(function(t){return t.nextRetry<=v()&&t.attempts<t.maxRetries}),e=function(t){try{r.gi.send(JSON.stringify(t)),r.wi=r.wi.filter(function(i){return i.id!==t.id}),r.kt.messagesSet++,r.emit("message:sent",t)}catch(i){t.attempts++,t.nextRetry=v()+1e3*t.attempts,t.attempts>=t.maxRetries&&(r.wi=r.wi.filter(function(i){return i.id!==t.id}),r.emit("message:failed",{message:t,error:i}))}},r=this;try{for(var o=s(n),a=o.next();!a.done;a=o.next())e(a.value)}catch(i){t={error:i}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}}},i.prototype.Ci=function(){var t=this;this.xi&&clearInterval(this.xi),this.xi=window.setInterval(function(){t.Li()},1e3)},i.prototype.Vi=function(){var t=this;this.ki&&clearInterval(this.ki),this.ki=window.setInterval(function(){t.isConnected&&(t.sendHeartbeat(),t.Si=window.setTimeout(function(){t.Ti++,t.Ti>=t.Oi.maxMissed&&(t.I.debug,t.reconnect().catch(function(){}))},t.Oi.timeout))},this.Oi.interval)},i.prototype.Gi=function(){var t=this;this._i&&clearTimeout(this._i);var i=this.I.reconnectInterval*Math.pow(1.5,this.ji.reconnectAttempts);this._i=window.setTimeout(function(){t.Pi||"connected"===t.ji.status||t.reconnect().catch(function(){})},i)},i.prototype.Ni=function(t){this.bi&&(this.emit("fallback:activated",{reason:t,url:this.bi.url}),this.I.debug)},i.prototype.Ai=function(){this.Ui(),this.Ii.clear(),this.Ti=0},i.prototype.Ui=function(){this.ki&&(clearInterval(this.ki),this.ki=null),this.Si&&(clearTimeout(this.Si),this.Si=null),this._i&&(clearTimeout(this._i),this._i=null),this.xi&&(clearInterval(this.xi),this.xi=null)},i}(M),q=function(){function t(t,i){void 0===i&&(i={}),this.Fi=null,this.Hi=null,this.T=new Map,this.Pi=!1,this.SESSION_KEY="session",this.VISITOR_KEY="visitor",this.FINGERPRINT_KEY="fingerprint",this.TABS_KEY="active_tabs",this.HEARTBEAT_KEY="heartbeat",this.Qi=t,this.Xi=e({sessionTimeout:18e5,enableCrossTabs:!0,enableFingerprinting:!0,fingerprintElements:{screen:!0,timezone:!0,language:!0,platform:!0,plugins:!0,canvas:!1},sessionValidation:!0,storagePrefix:"opt_session_"},i),this.Yi=this.$i(),this.Xi.enableFingerprinting&&this.Ki(),this.Xi.enableCrossTabs&&p()&&(this.Zi(),this.Vi())}return t.prototype.initializeSession=function(){return r(this,void 0,void 0,function(){var t,i,n;return o(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,this.tn()];case 1:return(t=e.sent())?(this.Fi=t,this.nn("session:restored",t),[2,t]):[4,this.en()];case 2:return i=e.sent(),this.Fi=i,this.rn(i),this.nn("session:created",i),[2,i];case 3:return e.sent(),n=this.sn(),this.Fi=n,[2,n];case 4:return[2]}})})},t.prototype.getCurrentSession=function(){return this.Fi},t.prototype.updateActivity=function(){this.Fi&&(this.Fi.lastActivity=v(),this.Fi.pageViews++,this.rn(this.Fi))},t.prototype.validateSession=function(){return r(this,void 0,void 0,function(){var t,i,n,e;return o(this,function(r){switch(r.label){case 0:return this.Fi?(t=[],i=!0,v()-this.Fi.lastActivity>this.Xi.sessionTimeout&&(i=!1,t.push("Session timeout exceeded")),this.Xi.enableFingerprinting&&this.Xi.sessionValidation?[4,this.Ki()]:[3,2]):[2,{isValid:!1,reasons:["No active session"],fingerprint:this.Hi,lastValidated:v()}];case 1:n=r.sent(),(e=this.an())&&n.hash!==e.hash&&this.cn(n,e)&&(i=!1,t.push("Session fingerprint validation failed")),r.label=2;case 2:return[2,{isValid:i,reasons:t,fingerprint:this.Hi,lastValidated:v()}]}})})},t.prototype.invalidateSession=function(){this.Fi&&(this.nn("session:invalid",this.Fi),this.Fi=null,this.Qi.remove(this.SESSION_KEY))},t.prototype.getFingerprint=function(){return this.Hi},t.prototype.on=function(t,i){this.T.has(t)||this.T.set(t,[]),this.T.get(t).push(i)},t.prototype.off=function(t,i){var n=this.T.get(t);if(n){var e=n.indexOf(i);e>-1&&n.splice(e,1)}},t.prototype.destroy=function(){if(!this.Pi){this.un&&clearInterval(this.un),this.hn&&clearInterval(this.hn);try{this.ln()}catch(t){}this.T.clear(),this.Pi=!0}},t.prototype.tn=function(){return r(this,void 0,void 0,function(){var t,i;return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),(t=this.Qi.get(this.SESSION_KEY))&&(i=y(t,null))?[4,this.dn(i)]:[2,null];case 1:return n.sent().isValid?[2,i]:(this.Qi.remove(this.SESSION_KEY),[2,null]);case 2:return n.sent(),[2,null];case 3:return[2]}})})},t.prototype.en=function(){return r(this,void 0,void 0,function(){var t,i;return o(this,function(n){try{t=this.Qi.get(this.VISITOR_KEY)||h(),this.Qi.set(this.VISITOR_KEY,t)}catch(i){t=h()}i={sessionId:f(),visitorId:t,startTime:v(),lastActivity:v(),pageViews:0,platform:_(),userAgent:S(),referrer:k(),landingPage:w()};try{this.vn()}catch(t){}return[2,i]})})},t.prototype.sn=function(){return{sessionId:f(),visitorId:h(),startTime:v(),lastActivity:v(),pageViews:0,platform:_(),userAgent:S(),referrer:k(),landingPage:w()}},t.prototype.rn=function(t){try{this.Qi.set(this.SESSION_KEY,g(t))}catch(t){this.Xi.debug}},t.prototype.Ki=function(){return r(this,void 0,void 0,function(){var t,i,n,e;return o(this,function(r){switch(r.label){case 0:return p()?(t=this.Xi.fingerprintElements,i={},t.screen&&(i.screenResolution="".concat(screen.width,"x").concat(screen.height)),t.timezone&&(i.timezone=(new Date).getTimezoneOffset()),t.language&&(i.language=navigator.language||"unknown"),t.platform&&(i.platform=_(),i.browser=x()),t.plugins&&(i.pluginsHash=this.mn()),t.canvas?(n=i,[4,this.pn()]):[3,2]):(this.Hi={screenResolution:"unknown",timezone:0,language:"unknown",platform:"server",browser:"unknown",pluginsHash:"unknown",hash:"server-side"},[2,this.Hi]);case 1:n.canvasHash=r.sent(),r.label=2;case 2:return e=Object.values(i).join("|"),i.hash=this.yn(e).toString(),this.Hi=i,this.Qi.set(this.FINGERPRINT_KEY,g(this.Hi)),[2,this.Hi]}})})},t.prototype.an=function(){var t=this.Qi.get(this.FINGERPRINT_KEY);return t?y(t,null):null},t.prototype.cn=function(t,i){return t.platform!==i.platform||t.browser!==i.browser||t.screenResolution!==i.screenResolution},t.prototype.dn=function(t){return r(this,void 0,void 0,function(){var i,n,e;return o(this,function(r){return i=v()-t.lastActivity,n=[],e=!0,i>this.Xi.sessionTimeout&&(e=!1,n.push("Session expired")),[2,{isValid:e,reasons:n,fingerprint:this.Hi,lastValidated:v()}]})})},t.prototype.Zi=function(){var t=this;p()&&(window.addEventListener("storage",function(i){i.key===t.gn(t.SESSION_KEY)&&t.wn(i.newValue)}),this.un=window.setInterval(function(){t.bn()},5e3))},t.prototype.Vi=function(){var t=this;p()&&(this.hn=window.setInterval(function(){t.kn(),t.Sn()},1e4))},t.prototype.wn=function(t){var i;if(t){var n=y(t,null);n&&n.sessionId!==(null===(i=this.Fi)||void 0===i?void 0:i.sessionId)&&(this.Fi=n,this.nn("session:synchronized",n))}},t.prototype.bn=function(){var t=this._n(),i=v(),n=t[this.Yi];(!n||i-n.lastHeartbeat>3e4)&&this.vn()},t.prototype.kn=function(){var t,i={tabId:this.Yi,timestamp:v(),sessionId:(null===(t=this.Fi)||void 0===t?void 0:t.sessionId)||"unknown"};this.Qi.set(this.HEARTBEAT_KEY,g(i))},t.prototype._n=function(){try{var t=this.Qi.get(this.TABS_KEY);return t?y(t,{}):{}}catch(t){return{}}},t.prototype.vn=function(){var t;try{var i=this._n();i[this.Yi]={startTime:v(),lastHeartbeat:v(),sessionId:(null===(t=this.Fi)||void 0===t?void 0:t.sessionId)||"pending"},this.Qi.set(this.TABS_KEY,g(i))}catch(t){}},t.prototype.ln=function(){try{var t=this._n();delete t[this.Yi],this.Qi.set(this.TABS_KEY,g(t))}catch(t){}},t.prototype.Sn=function(){var t,i,n=this._n(),e=v(),r=!1;try{for(var o=s(Object.entries(n)),c=o.next();!c.done;c=o.next()){var u=a(c.value,2),h=u[0];e-u[1].lastHeartbeat>6e4&&(delete n[h],r=!0)}}catch(i){t={error:i}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}r&&this.Qi.set(this.TABS_KEY,g(n))},t.prototype.$i=function(){return"tab_"+Math.random().toString(36).substr(2,9)+"_"+v()},t.prototype.gn=function(t){return this.Xi.storagePrefix+t},t.prototype.mn=function(){if(!p()||!navigator.plugins)return"unknown";var t=Array.from(navigator.plugins).map(function(t){return t.name}).sort().join("|");return this.yn(t).toString()},t.prototype.pn=function(){return r(this,void 0,void 0,function(){var t,i;return o(this,function(n){if(!p())return[2,"unknown"];try{return t=document.createElement("canvas"),(i=t.getContext("2d"))?(i.textBaseline="top",i.font="14px Arial",i.fillText("Fingerprint test ",2,2),[2,this.yn(t.toDataURL()).toString()]):[2,"unknown"]}catch(t){return[2,"canvas-blocked"]}return[2]})})},t.prototype.yn=function(t){for(var i=0,n=0;n<t.length;n++)i=(i<<5)-i+t.charCodeAt(n),i&=i;return Math.abs(i)},t.prototype.nn=function(t,i){var n={type:t,session:i,timestamp:v(),tabId:this.Yi};(this.T.get(t)||[]).forEach(function(t){try{t(n)}catch(t){}})},t}(),N=function(){function t(t){void 0===t&&(t="opt_"),this.xn=new Map,this.Tn=t}return t.prototype.get=function(t){var i=this.Tn+t;try{if(p()&&window.localStorage&&null!==(n=localStorage.getItem(i))){if((e=y(n,null))&&this.Pn(e.expiry))return e.value;e&&localStorage.removeItem(i)}}catch(t){}try{var n,e;if(p()&&window.sessionStorage&&null!==(n=sessionStorage.getItem(i))&&(e=y(n,null))&&this.Pn(e.expiry))return e.value}catch(t){}try{if(p()){var r=this.In(i);if(r)return r}}catch(t){}return this.xn.get(i)||null},t.prototype.set=function(t,i,n){var e=this,r=this.Tn+t,o=g({value:i,expiry:n});try{if(p()&&window.localStorage)return void localStorage.setItem(r,o)}catch(t){}try{if(p()&&window.sessionStorage)return void sessionStorage.setItem(r,o)}catch(t){}try{if(p()&&i.length<4e3)return void this.jn(r,i,n)}catch(t){}this.xn.set(r,i),this.xn.size>100&&Array.from(this.xn.entries()).slice(0,20).forEach(function(t){var i=a(t,1)[0];return e.xn.delete(i)})},t.prototype.remove=function(t){var i=this.Tn+t;try{p()&&window.localStorage&&localStorage.removeItem(i)}catch(t){}try{p()&&window.sessionStorage&&sessionStorage.removeItem(i)}catch(t){}try{p()&&this.On(i)}catch(t){}this.xn.delete(i)},t.prototype.clear=function(){var t=this;this.Cn().forEach(function(i){return t.remove(i.replace(t.Tn,""))}),this.xn.clear()},t.prototype.Pn=function(t){return!t||Date.now()<t},t.prototype.Cn=function(){var t=this,i=[];try{if(p()&&window.localStorage)for(var n=0;n<localStorage.length;n++)(e=localStorage.key(n))&&e.startsWith(this.Tn)&&i.push(e)}catch(t){}try{if(p()&&window.sessionStorage)for(n=0;n<sessionStorage.length;n++){var e;(e=sessionStorage.key(n))&&e.startsWith(this.Tn)&&i.push(e)}}catch(t){}return this.xn.forEach(function(n,e){e.startsWith(t.Tn)&&i.push(e)}),Array.from(new Set(i))},t.prototype.In=function(t){var i;if(!p())return null;var n="; ".concat(document.cookie).split("; ".concat(t,"="));if(2===n.length){var e=null===(i=n.pop())||void 0===i?void 0:i.split(";").shift();return e?decodeURIComponent(e):null}return null},t.prototype.jn=function(t,i,n){if(p()){var e="".concat(t,"=").concat(encodeURIComponent(i),"; path=/");if(n){var r=new Date(n);e+="; expires=".concat(r.toUTCString())}"https:"===location.protocol&&(e+="; secure"),e+="; samesite=lax",document.cookie=e}},t.prototype.On=function(t){p()&&(document.cookie="".concat(t,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"))},t}(),G=function(t){function i(){var i=t.call(this)||this;return i.isInitialized=!1,i.Mn=new Map,i.zn=[],i.Pi=!1,i.Qi=new N,i.An=new q(i.Qi),i.config={apiUrl:"",projectId:"",debug:!1,enableGDPR:!0,sessionTimeout:18e5,batchSize:10,flushInterval:5e3,platform:"auto"},i.session=i.Dn(),i}return n(i,t),i.prototype.init=function(t){return r(this,void 0,void 0,function(){var i,n,e,r,s,a,c,u,h,f,l=this;return o(this,function(o){switch(o.label){case 0:if(this.isInitialized)return this.config.debug,[2];if(this.config=P(this.config,t),!this.config.apiUrl||!this.config.projectId)throw new Error("apiUrl and projectId are required");return this.Qi=new N("opt_".concat(this.config.projectId,"_")),i={sessionTimeout:this.config.sessionTimeout||18e5,enableCrossTabs:!0,enableFingerprinting:!0,sessionValidation:!0,storagePrefix:"opt_".concat(this.config.projectId,"_session_")},this.An=new q(this.Qi,i),this.An.on("session:created",function(t){l.session=t.session,l.emit("session:created",t),l.config.debug}),this.An.on("session:restored",function(t){l.session=t.session,l.emit("session:restored",t),l.config.debug}),this.An.on("session:synchronized",function(t){l.session=t.session,l.emit("session:synchronized",t),l.config.debug}),this.An.on("session:invalid",function(t){l.emit("session:invalid",t),l.config.debug}),n=this,[4,this.An.initializeSession()];case 1:if(n.session=o.sent(),(e=new C({enableClickTracking:!0,enableScrollTracking:!0,enableFormTracking:!0,enableMouseTracking:!!this.config.debug,enableVisibilityTracking:!0,enablePerformanceTracking:!0})).setTracker(this),this.use(e),r=new R,this.use(r),s=new D(this.config.performance),this.use(s),!1!==(null===(h=this.config.performance)||void 0===h?void 0:h.enabled)&&(s.startMonitoring(),this.config.debug),!(null===(f=this.config.websocket)||void 0===f?void 0:f.enabled)||!p())return[3,5];if(a=this.config.websocket,c={url:a.url||""},void 0!==this.config.debug&&(c.debug=this.config.debug),a.protocols&&(c.protocols=a.protocols),void 0!==a.reconnect&&(c.reconnect=a.reconnect),a.reconnectInterval&&(c.reconnectInterval=a.reconnectInterval),a.maxReconnectAttempts&&(c.maxReconnectAttempts=a.maxReconnectAttempts),a.heartbeatInterval&&(c.heartbeatInterval=a.heartbeatInterval),a.messageQueueSize&&(c.messageQueueSize=a.messageQueueSize),void 0!==a.enableCompression&&(c.enableCompression=a.enableCompression),void 0!==a.enableFallback&&(c.enableFallback=a.enableFallback),a.fallbackUrl&&(c.fallbackUrl=a.fallbackUrl),a.timeout&&(c.timeout=a.timeout),(u=new E(c)).setSessionContext(this.session.sessionId,this.session.visitorId),this.use(u),!a.autoConnect||!a.url)return[3,5];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,u.connect()];case 3:case 4:return o.sent(),this.config.debug,[3,5];case 5:return this.Rn(),p()&&T(function(){l.pageView()}),this.isInitialized=!0,this.emit("initialized",this.config),this.config.debug,[2]}})})},i.prototype.track=function(t,i){if(void 0===i&&(i={}),this.isInitialized)if(this.hasConsent()){var n={type:"custom",element:t,value:i,timestamp:v(),sessionId:this.session.sessionId,visitorId:this.session.visitorId,metadata:i};this.En(n),this.emit("track",n),this.config.debug}else this.config.debug;else this.config.debug},i.prototype.identify=function(t,i){void 0===i&&(i={}),this.isInitialized&&(this.session.visitorId=t,this.track("identify",{visitorId:t,traits:i}),this.emit("identify",{visitorId:t,traits:i}))},i.prototype.pageView=function(t){if(void 0===t&&(t={}),this.isInitialized&&this.hasConsent()){var i=this.getTechnologyStack(),n=e({url:w(),title:b(),timestamp:v(),sessionId:this.session.sessionId,visitorId:this.session.visitorId,referrer:k()},t);this.An.updateActivity(),this.session=this.An.getCurrentSession()||this.session,this.En({type:"pageview",element:n.url,value:n.title,timestamp:n.timestamp,sessionId:n.sessionId,visitorId:n.visitorId,metadata:e(e({},n),{techStack:i})}),this.emit("pageview",e(e({},n),{techStack:i})),this.config.debug}},i.prototype.use=function(t){this.Mn.has(t.name)?this.config.debug:(this.Mn.set(t.name,t),this.isInitialized&&t.init(),this.emit("module:added",t))},i.prototype.getModule=function(t){return this.Mn.get(t)||null},i.prototype.getTechnologyStack=function(){var t=this.getModule("TechnologyDetector");return t?t.getCurrentTechStack():{}},i.prototype.connectWebSocket=function(){return r(this,void 0,void 0,function(){var t;return o(this,function(i){if(!(t=this.getModule("WebSocketManager")))throw new Error("WebSocket module not initialized");return[2,t.connect()]})})},i.prototype.disconnectWebSocket=function(){var t=this.getModule("WebSocketManager");t&&t.disconnect()},i.prototype.sendWebSocketEvent=function(t,i){return r(this,arguments,void 0,function(t,i,n){var e;return void 0===n&&(n="normal"),o(this,function(r){return(e=this.getModule("WebSocketManager"))?[2,e.sendEvent(t,i,n)]:[2,!1]})})},i.prototype.getWebSocketState=function(){var t=this.getModule("WebSocketManager");return t?t.getConnectionState():null},i.prototype.getWebSocketMetrics=function(){var t=this.getModule("WebSocketManager");return t?t.getMetrics():null},i.prototype.setConsent=function(t){this.Qi.set("consent",JSON.stringify(t)),this.emit("consent:changed",t),this.config.debug},i.prototype.hasConsent=function(){if(!this.config.enableGDPR)return!0;var t=this.Qi.get("consent");if(!t)return!1;try{var i=JSON.parse(t);return i.hasConsent&&i.purposes.analytics}catch(t){return!1}},i.prototype.showConsentBanner=function(){var t=this.getModule("GDPRCompliance");t?t.showConsentBanner():this.config.debug},i.prototype.hideConsentBanner=function(){var t=this.getModule("GDPRCompliance");t?t.hideConsentBanner():this.config.debug},i.prototype.getGDPRConsent=function(){var t=this.getModule("GDPRCompliance");return t?t.getConsent():null},i.prototype.setGDPRConsent=function(t){var i=this.getModule("GDPRCompliance");i?i.setConsent(t):this.config.debug},i.prototype.withdrawConsent=function(t){var i=this.getModule("GDPRCompliance");i?i.withdrawConsent(t):this.config.debug},i.prototype.requestDataAccess=function(t){return r(this,void 0,void 0,function(){var i;return o(this,function(n){if(i=this.getModule("GDPRCompliance"))return[2,i.requestDataAccess(t)];throw new Error("GDPR Compliance module not found")})})},i.prototype.requestDataDeletion=function(t){return r(this,void 0,void 0,function(){var i;return o(this,function(n){if(i=this.getModule("GDPRCompliance"))return[2,i.requestDataDeletion(t)];throw new Error("GDPR Compliance module not found")})})},i.prototype.requestDataPortability=function(t){return r(this,void 0,void 0,function(){var i;return o(this,function(n){if(i=this.getModule("GDPRCompliance"))return[2,i.requestDataPortability(t)];throw new Error("GDPR Compliance module not found")})})},i.prototype.getPrivacySettings=function(){var t=this.getModule("GDPRCompliance");return t?t.getPrivacySettings():null},i.prototype.setPrivacySettings=function(t){var i=this.getModule("GDPRCompliance");i?i.setPrivacySettings(t):this.config.debug},i.prototype.isGDPRCompliant=function(){var t=this.getModule("GDPRCompliance");return t?t.isCompliant():!this.config.enableGDPR},i.prototype.exportUserData=function(t){return r(this,void 0,void 0,function(){var i;return o(this,function(n){if(i=this.getModule("GDPRCompliance"))return[2,i.exportUserData(t||this.session.visitorId)];throw new Error("GDPR Compliance module not found")})})},i.prototype.flush=function(){return r(this,void 0,void 0,function(){var t,i,n;return o(this,function(e){switch(e.label){case 0:if(0===this.zn.length)return[2];t=c([],a(this.zn),!1),this.zn=[],e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.qn(t)];case 2:return e.sent(),this.emit("events:sent",t),[3,4];case 3:return i=e.sent(),(n=this.zn).unshift.apply(n,c([],a(t),!1)),this.emit("events:failed",i),this.config.debug,[3,4];case 4:return[2]}})})},i.prototype.destroy=function(){this.Pi||(this.Nn&&clearInterval(this.Nn),this.flush().catch(function(){}),this.An.destroy(),this.Mn.forEach(function(t){t.destroy&&t.destroy()}),this.Mn.clear(),this.removeAllListeners(),this.Pi=!0,this.isInitialized=!1)},i.prototype.Dn=function(){return{sessionId:"",visitorId:"",startTime:0,lastActivity:0,pageViews:0,platform:"",userAgent:"",landingPage:""}},i.prototype.En=function(t){this.zn.push(t),this.zn.length>=this.config.batchSize&&this.flush().catch(function(){})},i.prototype.Rn=function(){var t=this;this.Nn&&clearInterval(this.Nn),this.Nn=window.setInterval(function(){t.zn.length>0&&t.flush().catch(function(){})},this.config.flushInterval)},i.prototype.qn=function(t){return r(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this.config.debug,[4,new Promise(function(t){return setTimeout(t,100)})];case 1:return t.sent(),[2]}})})},i.prototype.configurePerformance=function(t){var i=this.getModule("PerformanceOptimizer");i?i.configure(t):this.config.debug},i.prototype.getPerformanceMetrics=function(){var t=this.getModule("PerformanceOptimizer");return t?t.getMetrics():{loadTime:0,domReady:0,firstPaint:0,firstContentfulPaint:0,largestContentfulPaint:0,firstInputDelay:0,cumulativeLayoutShift:0,totalBlockingTime:0,timeToInteractive:0,memoryUsage:{used:0,total:0,limit:0},cpuUsage:0,networkStats:{requests:0,bytesTransferred:0,averageLatency:0},scriptPerformance:{initTime:0,executionTime:0,moduleLoadTimes:{}}}},i.prototype.getPerformanceReport=function(){var t=this.getModule("PerformanceOptimizer");return t?t.getOptimizationReport():{timestamp:Date.now(),metrics:this.getPerformanceMetrics(),thresholds:{memory:{warning:80,critical:100},cpu:{warning:70,critical:90},network:{latency:500,bandwidth:1048576},coreWebVitals:{lcp:2500,fid:100,cls:.1}},violations:[],optimizations:[],score:100,grade:"A"}},i.prototype.startPerformanceMonitoring=function(){var t=this.getModule("PerformanceOptimizer");t?t.startMonitoring():this.config.debug},i.prototype.stopPerformanceMonitoring=function(){var t=this.getModule("PerformanceOptimizer");t?t.stopMonitoring():this.config.debug},i.prototype.optimizePerformance=function(){var t=this.getModule("PerformanceOptimizer");t?t.optimizeCoreWebVitals():this.config.debug},i.prototype.preloadCriticalResources=function(){return r(this,void 0,void 0,function(){var t;return o(this,function(i){switch(i.label){case 0:return(t=this.getModule("PerformanceOptimizer"))?[4,t.preloadCriticalResources()]:[3,2];case 1:return i.sent(),[3,3];case 2:this.config.debug,i.label=3;case 3:return[2]}})})},i.prototype.enableLazyLoading=function(){var t=this.getModule("PerformanceOptimizer");t?t.configure({lazyLoading:{enabled:!0,threshold:51200,modules:[],chunkSize:102400}}):this.config.debug},i.prototype.enableCodeSplitting=function(){var t=this.getModule("PerformanceOptimizer");t?t.configure({codesplitting:{enabled:!0,splitPoints:[],dynamicImports:!0,preloadCritical:!0}}):this.config.debug},i.prototype.measureCoreWebVitals=function(){return r(this,void 0,void 0,function(){var t;return o(this,function(i){switch(i.label){case 0:return(t=this.getModule("PerformanceOptimizer"))?[4,t.measureCoreWebVitals()]:[3,2];case 1:return[2,i.sent()];case 2:return[2,{lcp:0,fid:0,cls:0,fcp:0,ttfb:0,tbt:0,tti:0}]}})})},i}(M),W=function(t){function i(i,n){var r,o,s,a,c,u;void 0===i&&(i={});var h=t.call(this)||this;return h.name="GDPRCompliance",h.Gn=null,h.Wn=null,h.K=!1,h.Un={bannerTitle:"We value your privacy",bannerDescription:"We use cookies and similar technologies to enhance your experience, analyze usage, and assist with marketing. You can manage your preferences at any time.",acceptAll:"Accept All",rejectAll:"Reject All",customize:"Customize",savePreferences:"Save Preferences",necessary:"Necessary",analytics:"Analytics",marketing:"Marketing",privacyPolicy:"Privacy Policy",cookiePolicy:"Cookie Policy"},h.I=e({enabled:!0,consentBanner:e({enabled:!0,position:"bottom",theme:"light",texts:h.Un,showOnEveryPage:!1,respectDoNotTrack:!0},i.consentBanner),cookieCategories:h.Vn(),dataRetention:e({defaultDays:730,automaticDeletion:!0},i.dataRetention),userRights:e({enableDataAccess:!0,enableDataDeletion:!0,enableDataPortability:!0,enableOptOut:!0},i.userRights),privacyByDesign:e({dataMinimization:!0,purposeLimitation:!0,storageMinimization:!0,autoAnonymization:!0},i.privacyByDesign),legalBasis:e({type:"consent",description:"User consent for data processing"},i.legalBasis)},i),h.Ln=h.I.cookieCategories||h.Vn(),h.Jn={dataMinimization:(null===(r=h.I.privacyByDesign)||void 0===r?void 0:r.dataMinimization)||!0,anonymizeIPs:!0,respectDoNotTrack:(null===(o=h.I.consentBanner)||void 0===o?void 0:o.respectDoNotTrack)||!0,cookielessTracking:!1,storageMinimization:(null===(s=h.I.privacyByDesign)||void 0===s?void 0:s.storageMinimization)||!0,automaticDeletion:(null===(a=h.I.dataRetention)||void 0===a?void 0:a.automaticDeletion)||!0,purposeLimitation:(null===(c=h.I.privacyByDesign)||void 0===c?void 0:c.purposeLimitation)||!0,dataRetentionDays:(null===(u=h.I.dataRetention)||void 0===u?void 0:u.defaultDays)||730,consentRequired:!0},h.Qi=n||(p()?localStorage:{getItem:function(){return null},setItem:function(){},removeItem:function(){},clear:function(){}}),h}return n(i,t),i.prototype.init=function(){if(this.I.enabled&&!this.K){if(this.Bn(),this.Jn.respectDoNotTrack&&this.Fn())return this.Hn(),this.K=!0,void this.emit("gdpr:initialized",this.I);this.Qn()&&this.showConsentBanner(),this.K=!0,this.emit("gdpr:initialized",this.I)}},i.prototype.showConsentBanner=function(){var t;p()&&(null===(t=this.I.consentBanner)||void 0===t?void 0:t.enabled)?(this.Xn(),this.emit("banner:shown")):this.emit("banner:shown")},i.prototype.hideConsentBanner=function(){this.Wn&&(this.Wn.remove(),this.Wn=null,this.emit("banner:hidden"))},i.prototype.getConsent=function(){return this.Gn},i.prototype.setConsent=function(t){var i=this,n=e({id:d(),hasConsent:!0,timestamp:v(),version:"1.0",method:"banner",categories:{},legalBasis:{},purposes:{analytics:!1,marketing:!1,functional:!0,advertising:!1,personalization:!1}},t);Object.keys(n.categories).forEach(function(t){if(i.Ln.find(function(i){return i.id===t})&&n.categories[t])switch(t){case"analytics":n.purposes.analytics=!0;break;case"marketing":n.purposes.marketing=!0;break;case"advertising":n.purposes.advertising=!0;break;case"personalization":n.purposes.personalization=!0}}),this.Gn=n,this.Yn(),this.hideConsentBanner(),this.emit("consent:updated",n)},i.prototype.withdrawConsent=function(t){var i=this;if(this.Gn){if(t)switch(this.Gn.categories[t]=!1,t){case"analytics":this.Gn.purposes.analytics=!1;break;case"marketing":this.Gn.purposes.marketing=!1;break;case"advertising":this.Gn.purposes.advertising=!1;break;case"personalization":this.Gn.purposes.personalization=!1}else this.Gn.hasConsent=!1,this.Gn.withdrawalDate=v(),Object.keys(this.Gn.categories).forEach(function(t){i.Gn.categories[t]=!1}),this.Gn.purposes={analytics:!1,marketing:!1,functional:!0,advertising:!1,personalization:!1};this.Yn(),this.emit("consent:withdrawn",{category:t,consent:this.Gn})}},i.prototype.renewConsent=function(){this.Gn&&(this.Gn.renewalRequired=!0,this.Yn()),this.showConsentBanner(),this.emit("consent:renewal_required")},i.prototype.getCookieCategories=function(){return this.Ln},i.prototype.setCookieCategory=function(t,i){var n=this.Ln.find(function(i){return i.id===t});n&&!n.required&&(n.enabled=i,this.Gn&&(this.Gn.categories[t]=i,this.Yn()),this.emit("cookie:category_changed",{categoryId:t,enabled:i}))},i.prototype.clearCookies=function(t){p()&&((t?this.Ln.filter(function(i){return i.id===t}):this.Ln.filter(function(t){return!t.enabled&&!t.required})).forEach(function(t){t.cookies.forEach(function(t){document.cookie="".concat(t.name,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=").concat(t.domain||window.location.hostname)})}),this.emit("cookies:cleared",{category:t}))},i.prototype.requestDataAccess=function(t){return r(this,void 0,void 0,function(){var i,n;return o(this,function(r){if(!(null===(n=this.I.userRights)||void 0===n?void 0:n.enableDataAccess))throw new Error("Data access requests are not enabled");return i=e(e({id:d(),type:"access",timestamp:v(),visitorId:this.$n()},t&&{email:t}),{status:"pending",expiresAt:v()+2592e6}),this.emit("data:access_requested",i),[2,i]})})},i.prototype.requestDataDeletion=function(t){return r(this,void 0,void 0,function(){var i,n;return o(this,function(r){if(!(null===(n=this.I.userRights)||void 0===n?void 0:n.enableDataDeletion))throw new Error("Data deletion requests are not enabled");return i=e(e({id:d(),type:"deletion",timestamp:v(),visitorId:this.$n()},t&&{email:t}),{status:"pending",expiresAt:v()+2592e6}),this.emit("data:deletion_requested",i),[2,i]})})},i.prototype.requestDataPortability=function(t){return r(this,void 0,void 0,function(){var i,n;return o(this,function(r){if(!(null===(n=this.I.userRights)||void 0===n?void 0:n.enableDataPortability))throw new Error("Data portability requests are not enabled");return i=e(e({id:d(),type:"portability",timestamp:v(),visitorId:this.$n()},t&&{email:t}),{status:"pending",expiresAt:v()+2592e6}),this.emit("data:portability_requested",i),[2,i]})})},i.prototype.getPrivacySettings=function(){return e({},this.Jn)},i.prototype.setPrivacySettings=function(t){this.Jn=e(e({},this.Jn),t),this.emit("privacy:settings_updated",this.Jn)},i.prototype.anonymizeData=function(t){if(!this.Jn.dataMinimization)return t;var i=e({},t);return this.Jn.anonymizeIPs&&i.ip&&(i.ip=this.Kn(i.ip)),["email","phone","name","address","ssn"].forEach(function(t){i[t]&&delete i[t]}),i},i.prototype.isCompliant=function(){return!this.I.enabled||!(this.Jn.consentRequired&&!this.Zn())&&!!this.te()},i.prototype.getComplianceReport=function(){var t=[],i=[],n="missing";this.Gn?this.Gn.withdrawalDate?n="withdrawn":this.ie()?(n="expired",t.push("Consent has expired and needs renewal")):n="valid":t.push("No consent record found");var e=this.te();e||(t.push("Data retention period exceeded"),i.push("Implement automatic data deletion"));var r=this.ne();return r||(t.push("Non-essential cookies active without consent"),i.push("Review cookie categorization and consent status")),{timestamp:v(),consentStatus:n,dataRetentionCompliance:e,cookieCompliance:r,privacySettingsCompliance:!0,issues:t,recommendations:i}},i.prototype.exportUserData=function(t){return r(this,void 0,void 0,function(){return o(this,function(i){return[2,{visitorId:t,exportDate:v(),sessions:[],events:[],pageViews:[],consent:this.Gn?[this.Gn]:[],format:"json"}]})})},i.prototype.deleteUserData=function(t){return r(this,void 0,void 0,function(){return o(this,function(i){try{return this.Qi.removeItem("gdpr_consent_".concat(t)),this.Qi.removeItem("visitor_session_".concat(t)),this.Gn&&(this.Gn=null),this.emit("data:deleted",{visitorId:t}),[2,!0]}catch(i){return this.emit("data:deletion_failed",{visitorId:t,error:i}),[2,!1]}return[2]})})},i.prototype.destroy=function(){this.hideConsentBanner(),this.K=!1,this.emit("gdpr:destroyed")},i.prototype.Vn=function(){return[{id:"necessary",name:"Necessary",description:"These cookies are essential for the website to function properly.",required:!0,enabled:!0,purpose:"Essential website functionality",legalBasis:{type:"legitimate_interests",description:"Necessary for website operation",legitimateInterests:"Providing requested services"},retentionPeriod:365,cookies:[{name:"session_id",purpose:"Session management",provider:"First party",expiry:"Session",type:"essential"}]},{id:"analytics",name:"Analytics",description:"These cookies help us understand how visitors interact with our website.",required:!1,enabled:!1,purpose:"Website analytics and improvement",legalBasis:{type:"consent",description:"User consent for analytics"},retentionPeriod:730,cookies:[{name:"tracking_id",purpose:"Visitor tracking",provider:"First party",expiry:"2 years",type:"analytics"}]},{id:"marketing",name:"Marketing",description:"These cookies are used to show relevant advertising and marketing content.",required:!1,enabled:!1,purpose:"Personalized advertising",legalBasis:{type:"consent",description:"User consent for marketing"},retentionPeriod:365,cookies:[{name:"marketing_id",purpose:"Marketing campaigns",provider:"Third party",expiry:"1 year",type:"marketing"}]}]},i.prototype.Bn=function(){try{var t=this.Qi.getItem("gdpr_consent");t&&(this.Gn=JSON.parse(t))}catch(t){}},i.prototype.Yn=function(){this.Gn&&this.Qi.setItem("gdpr_consent",JSON.stringify(this.Gn))},i.prototype.Qn=function(){var t,i;return!(!(null===(t=this.I.consentBanner)||void 0===t?void 0:t.enabled)||this.Zn()&&!(null===(i=this.Gn)||void 0===i?void 0:i.renewalRequired)||this.Fn()&&this.Jn.respectDoNotTrack)},i.prototype.Zn=function(){return null!==this.Gn&&this.Gn.hasConsent&&!this.Gn.withdrawalDate&&!this.ie()},i.prototype.ie=function(){if(!this.Gn)return!0;var t=this.Gn.timestamp+31536e6;return v()>t},i.prototype.Fn=function(){return!!p()&&("1"===navigator.doNotTrack||"1"===window.doNotTrack||"1"===navigator.msDoNotTrack)},i.prototype.Hn=function(){this.setConsent({hasConsent:!1,method:"implied",categories:{},purposes:{analytics:!1,marketing:!1,functional:!0,advertising:!1,personalization:!1}}),this.emit("consent:do_not_track")},i.prototype.Xn=function(){if(p()&&!this.Wn){var t=document.createElement("div");t.className="gdpr-banner",t.innerHTML=this.ee(),this.re(t),this.oe(t),document.body.appendChild(t),this.Wn=t}},i.prototype.ee=function(){var t,i=(null===(t=this.I.consentBanner)||void 0===t?void 0:t.texts)||this.Un;return'\n      <div class="gdpr-banner-content">\n        <div class="gdpr-banner-text">\n          <h3>'.concat(i.bannerTitle,"</h3>\n          <p>").concat(i.bannerDescription,'</p>\n        </div>\n        <div class="gdpr-banner-actions">\n          <button type="button" class="gdpr-btn gdpr-btn-customize">').concat(i.customize,'</button>\n          <button type="button" class="gdpr-btn gdpr-btn-reject">').concat(i.rejectAll,'</button>\n          <button type="button" class="gdpr-btn gdpr-btn-accept">').concat(i.acceptAll,"</button>\n        </div>\n      </div>\n    ")},i.prototype.re=function(t){var i,n,e,r=(null===(i=this.I.consentBanner)||void 0===i?void 0:i.position)||"bottom",o=(null===(n=this.I.consentBanner)||void 0===n?void 0:n.theme)||"light",s={position:"fixed",left:"0",right:"0",zIndex:"10000",backgroundColor:"dark"===o?"#2d3748":"#ffffff",color:"dark"===o?"#ffffff":"#2d3748",padding:"16px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",fontFamily:"-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif",fontSize:"14px",lineHeight:"1.4"};"top"===r?s.top="0":s.bottom="0",Object.assign(t.style,s,null===(e=this.I.consentBanner)||void 0===e?void 0:e.customStyles);var a=t.querySelector(".gdpr-banner-content");a&&Object.assign(a.style,{display:"flex",alignItems:"center",justifyContent:"space-between",maxWidth:"1200px",margin:"0 auto",gap:"16px"}),t.querySelectorAll(".gdpr-btn").forEach(function(t){var i=t;Object.assign(i.style,{padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",marginLeft:"8px"}),i.classList.contains("gdpr-btn-accept")?Object.assign(i.style,{backgroundColor:"#4299e1",color:"#ffffff"}):i.classList.contains("gdpr-btn-reject")?Object.assign(i.style,{backgroundColor:"transparent",color:"dark"===o?"#ffffff":"#4a5568",border:"1px solid currentColor"}):Object.assign(i.style,{backgroundColor:"transparent",color:"dark"===o?"#ffffff":"#4a5568",textDecoration:"underline"})})},i.prototype.oe=function(t){var i=this,n=t.querySelector(".gdpr-btn-accept"),e=t.querySelector(".gdpr-btn-reject"),r=t.querySelector(".gdpr-btn-customize");n&&n.addEventListener("click",function(){i.setConsent({hasConsent:!0,method:"banner",categories:Object.fromEntries(i.Ln.map(function(t){return[t.id,!t.required||t.enabled]}))})}),e&&e.addEventListener("click",function(){i.setConsent({hasConsent:!1,method:"banner",categories:Object.fromEntries(i.Ln.map(function(t){return[t.id,t.required]}))})}),r&&r.addEventListener("click",function(){i.se()})},i.prototype.se=function(){this.emit("banner:customize_requested",this.Ln)},i.prototype.te=function(){if(!this.Gn)return!0;var t=this.Jn.dataRetentionDays;return v()-this.Gn.timestamp<=24*t*60*60*1e3},i.prototype.ne=function(){var t=this;return!!this.Gn&&this.Ln.every(function(i){if(i.required)return!0;var n=t.Gn.categories[i.id];return void 0!==n?i.enabled===n:!i.enabled})},i.prototype.Kn=function(t){return t.includes(":")?t.split(":").slice(0,4).join(":")+"::":t.split(".").slice(0,3).join(".")+".0"},i.prototype.$n=function(){return"visitor_"+d()},i}(M),U=null;function V(t){return r(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return U||(U=new G),[4,U.init(t)];case 1:return i.sent(),[2,U]}})})}function L(){return U}function J(t,i){U&&U.track(t,i)}function B(t){U&&U.pageView(t)}function F(t,i){U&&U.identify(t,i)}function H(t){U&&U.setConsent(t)}function Q(t){var i=new G;return t&&t.apiUrl&&t.projectId&&i.init(t).catch(function(i){t.debug}),i}if(p()){var X=window;X.optimizelyConfig&&V(X.optimizelyConfig),X.Optimizely={init:V,getTracker:L,track:J,pageView:B,identify:F,setConsent:H,createTracker:Q,Tracker:G}}var Y={init:V,getTracker:L,track:J,pageView:B,identify:F,setConsent:H,createTracker:Q,Tracker:G};t.BehavioralTracker=C,t.EventEmitter=M,t.GDPRCompliance=W,t.SessionManager=q,t.Storage=N,t.TechnologyDetector=R,t.Tracker=G,t.UniversalPolyfills=u,t.WebSocketManager=E,t.addEventListener=function(t,i,n,e){return t.addEventListener(i,n,e),function(){return t.removeEventListener(i,n,e)}},t.anonymizeIP=function(t){return t?t.includes(":")?j(t):I(t):t},t.anonymizeIPv4=I,t.anonymizeIPv6=j,t.areCookiesEnabled=function(){if(!p())return!1;try{document.cookie="test_cookie=1";var t=-1!==document.cookie.indexOf("test_cookie=");return document.cookie="test_cookie=1; expires=Thu, 01-Jan-1970 00:00:01 GMT",t}catch(t){return!1}},t.calculateRetentionExpiry=O,t.clearAllCookies=function(t){p()&&document.cookie.split(";").forEach(function(i){var n=i.indexOf("="),e=n>-1?i.substr(0,n).trim():i.trim();if(e){document.cookie="".concat(e,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"),t&&(document.cookie="".concat(e,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=").concat(t));var r=window.location.hostname;if(r.includes(".")){var o="."+r.split(".").slice(-2).join(".");document.cookie="".concat(e,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=").concat(o)}}})},t.createTracker=Q,t.debounce=function(t,i,n){void 0===n&&(n=!1);var e=null;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var s=n&&!e;e&&clearTimeout(e),e=setTimeout(function(){e=null,n||t.apply(void 0,c([],a(r),!1))},i),s&&t.apply(void 0,c([],a(r),!1))}},t.deepMerge=P,t.default=Y,t.detectBrowser=x,t.detectPlatform=_,t.domReady=T,t.formatGDPRDate=function(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},t.generateId=d,t.generateSessionId=f,t.generateVisitorId=h,t.getCurrentTitle=b,t.getCurrentUrl=w,t.getDoNotTrackStatus=function(){return!!p()&&("1"===navigator.doNotTrack||"1"===window.doNotTrack||"1"===navigator.msDoNotTrack)},t.getLanguage=function(){return p()&&(navigator.language||navigator.userLanguage)||"en"},t.getPlatform=function(){return p()?navigator.platform:"server"},t.getReferrer=k,t.getScrollDepth=function(){if(!p())return 0;var t=window.pageYOffset||document.documentElement.scrollTop,i=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),n=window.innerHeight||document.documentElement.clientHeight;return i<=n?100:Math.round((t+n)/i*100)},t.getTimezoneOffset=function(){return p()?(new Date).getTimezoneOffset():0},t.getTracker=L,t.getUserAgent=S,t.hashSensitiveData=function(t){if(!t)return t;for(var i=0,n=0;n<t.length;n++)i=(i<<5)-i+t.charCodeAt(n),i&=i;return Math.abs(i).toString(36)},t.identify=F,t.init=V,t.isBot=function(){if(!p())return!1;var t=navigator.userAgent.toLowerCase();return["bot","crawler","spider","crawling","facebook","google","yahoo","bing","duckduckgo","baidu","yandex","twitter","whatsapp","telegram"].some(function(i){return t.includes(i)})},t.isBrowser=p,t.isConsentRequired=function(){if(!p())return!0;var t=Intl.DateTimeFormat().resolvedOptions().timeZone;return["Europe/","Atlantic/Azores","Atlantic/Madeira","Atlantic/Canary"].some(function(i){return t.startsWith(i)})},t.isDataExpired=function(t,i){var n=O(t,i);return v()>n},t.isElementVisible=function(t){if(!p())return!1;var i=t.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,e=window.innerWidth||document.documentElement.clientWidth;return i.top>=0&&i.left>=0&&i.bottom<=n&&i.right<=e},t.isProduction=function(){return"production"===process.env.NODE_ENV},t.isValidEmail=function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)},t.now=v,t.pageView=B,t.removePII=function(t){if(!t||"object"!=typeof t)return t;var i=e({},t);return["email","phone","name","firstName","lastName","fullName","address","street","city","zipCode","postalCode","ssn","socialSecurityNumber","creditCard","bankAccount","passport","driverLicense","taxId"].forEach(function(t){i[t]&&delete i[t]}),i},t.safeJsonParse=y,t.safeJsonStringify=g,t.setConsent=H,t.shouldAnonymizeIP=function(t,i){return i.anonymizeIPs&&Boolean(t)&&"127.0.0.1"!==t&&"::1"!==t},t.shouldMinimizeData=function(t){return t.dataMinimization},t.simpleHash=function(t){var i=0;if(0===t.length)return i;for(var n=0;n<t.length;n++)i=(i<<5)-i+t.charCodeAt(n),i&=i;return Math.abs(i)},t.throttle=m,t.track=J,Object.defineProperty(t,"ae",{value:!0})});
//# sourceMappingURL=tracker.min.js.map
